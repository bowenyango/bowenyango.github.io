3:I[9275,[],""]
5:I[1343,[],""]
6:I[8700,["231","static/chunks/231-42eeaa612179830e.js","113","static/chunks/113-8a0c0daa2bfc088c.js","185","static/chunks/app/layout-a7a2551425c87cc3.js"],"ThemeProviders"]
7:I[4080,["231","static/chunks/231-42eeaa612179830e.js","113","static/chunks/113-8a0c0daa2bfc088c.js","185","static/chunks/app/layout-a7a2551425c87cc3.js"],""]
8:I[9032,["231","static/chunks/231-42eeaa612179830e.js","113","static/chunks/113-8a0c0daa2bfc088c.js","185","static/chunks/app/layout-a7a2551425c87cc3.js"],"KBarSearchProvider"]
9:I[231,["231","static/chunks/231-42eeaa612179830e.js","173","static/chunks/173-af5b99c330035292.js","459","static/chunks/459-6c5dcdc51f43b997.js","797","static/chunks/app/blog/%5B...slug%5D/page-5ad4d86948f7f0f4.js"],""]
a:I[509,["231","static/chunks/231-42eeaa612179830e.js","113","static/chunks/113-8a0c0daa2bfc088c.js","185","static/chunks/app/layout-a7a2551425c87cc3.js"],"KBarButton"]
b:I[1398,["231","static/chunks/231-42eeaa612179830e.js","113","static/chunks/113-8a0c0daa2bfc088c.js","185","static/chunks/app/layout-a7a2551425c87cc3.js"],"default"]
c:I[8976,["231","static/chunks/231-42eeaa612179830e.js","113","static/chunks/113-8a0c0daa2bfc088c.js","185","static/chunks/app/layout-a7a2551425c87cc3.js"],"default"]
4:["slug","book-reading/system-design-alex-xu","c"]
0:["gPZ8ET5SZwyuIVWxpISNr",[[["",{"children":["blog",{"children":[["slug","book-reading/system-design-alex-xu","c"],{"children":["__PAGE__?{\"slug\":[\"book-reading\",\"system-design-alex-xu\"]}",{}]}]}]},"$undefined","$undefined",true],["",{"children":["blog",{"children":[["slug","book-reading/system-design-alex-xu","c"],{"children":["__PAGE__",{},[["$L1","$L2"],null],null]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$4","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/e36d2c8a31781d2e.css","precedence":"next","crossOrigin":"$undefined"}]]}],null]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}],null]},[["$","html",null,{"lang":"en-us","className":"__variable_0aa4ae scroll-smooth","suppressHydrationWarning":true,"children":[["$","link",null,{"rel":"apple-touch-icon","sizes":"76x76","href":"/static/favicons/logo-round.png"}],["$","link",null,{"rel":"icon","type":"image/png","sizes":"32x32","href":"/static/favicons/logo-round.png"}],["$","link",null,{"rel":"icon","type":"image/png","sizes":"16x16","href":"/static/favicons/logo-round.png"}],["$","link",null,{"rel":"manifest","href":"/static/favicons/site.webmanifest"}],["$","meta",null,{"name":"msapplication-TileColor","content":"#000000"}],["$","meta",null,{"name":"theme-color","media":"(prefers-color-scheme: light)","content":"#fff"}],["$","meta",null,{"name":"theme-color","media":"(prefers-color-scheme: dark)","content":"#000"}],["$","link",null,{"rel":"alternate","type":"application/rss+xml","href":"/feed.xml"}],["$","body",null,{"className":"bg-white pl-[calc(100vw-100%)] text-black antialiased dark:bg-gray-950 dark:text-white","children":["$","$L6",null,{"children":[["$undefined","$undefined","$undefined",["$","$L7",null,{"async":true,"defer":true,"data-website-id":"$undefined","src":"https://analytics.umami.is/script.js"}],"$undefined","$undefined"],["$","section",null,{"className":"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0","children":[["$","$L8",null,{"kbarConfig":{"searchDocumentsPath":"/search.json"},"children":[["$","header",null,{"className":"flex items-center w-full bg-white dark:bg-gray-950 justify-between py-10","children":[["$","$L9",null,{"className":"break-words","href":"/","aria-label":"CodeWisdom","children":["$","div",null,{"className":"flex items-center justify-between","children":[["$","div",null,{"className":"mr-3","children":["$","img",null,{"src":"/_next/static/media/logo.a3d92d8f.png","alt":"logo","className":"h-10 w-14"}]}],["$","div",null,{"className":"hidden h-6 text-2xl font-semibold sm:block","children":"CodeWisdom"}]]}]}],["$","div",null,{"className":"flex items-center space-x-4 leading-5 sm:space-x-6","children":[["$","div",null,{"className":"no-scrollbar hidden max-w-40 items-center space-x-4 overflow-x-auto sm:flex sm:space-x-6 md:max-w-72 lg:max-w-96","children":[["$","$L9",null,{"className":"block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400","href":"/blog","children":"Blog"}],["$","$L9",null,{"className":"block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400","href":"/tags","children":"Tags"}],["$","$L9",null,{"className":"block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400","href":"/projects","children":"Projects"}],["$","$L9",null,{"className":"block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400","href":"/about","children":"About"}]]}],["$","$La",null,{"aria-label":"Search","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","strokeWidth":1.5,"stroke":"currentColor","className":"h-6 w-6 text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400","children":["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}]}]}],["$","$Lb",null,{}],["$","$Lc",null,{}]]}]]}],["$","main",null,{"className":"mb-auto","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","div",null,{"className":"flex flex-col items-start justify-start md:mt-24 md:flex-row md:items-center md:justify-center md:space-x-6","children":[["$","div",null,{"className":"space-x-2 pb-8 pt-6 md:space-y-5","children":["$","h1",null,{"className":"text-6xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 md:border-r-2 md:px-6 md:text-8xl md:leading-14","children":"404"}]}],["$","div",null,{"className":"max-w-md","children":[["$","p",null,{"className":"mb-4 text-xl font-bold leading-normal md:text-2xl","children":"Sorry we couldn't find this page."}],["$","p",null,{"className":"mb-8","children":"But dont worry, you can find plenty of other things on our homepage."}],["$","$L9",null,{"className":"focus:shadow-outline-blue inline rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium leading-5 text-white shadow transition-colors duration-150 hover:bg-blue-700 focus:outline-none dark:hover:bg-blue-500","href":"/","children":"Back to homepage"}]]}]]}],"notFoundStyles":[],"styles":null}]}]]}],["$","footer",null,{"children":["$","div",null,{"className":"mt-16 flex flex-col items-center","children":["$","div",null,{"className":"mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400","children":[["$","div",null,{"children":"Bowen Y"}],["$","div",null,{"children":" • "}],["$","div",null,{"children":"© 2024"}],["$","div",null,{"children":" • "}],["$","$L9",null,{"className":"break-words","href":"/","children":"CodeWisdom"}]]}]}]}]]}]]}]}]]}],null],null],[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/5beba742ae93b864.css","precedence":"next","crossOrigin":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"/_next/static/css/f719ff1083adf929.css","precedence":"next","crossOrigin":"$undefined"}]],"$Ld"]]]]
e:I[4347,["231","static/chunks/231-42eeaa612179830e.js","173","static/chunks/173-af5b99c330035292.js","459","static/chunks/459-6c5dcdc51f43b997.js","797","static/chunks/app/blog/%5B...slug%5D/page-5ad4d86948f7f0f4.js"],"default"]
f:I[8173,["231","static/chunks/231-42eeaa612179830e.js","173","static/chunks/173-af5b99c330035292.js","459","static/chunks/459-6c5dcdc51f43b997.js","797","static/chunks/app/blog/%5B...slug%5D/page-5ad4d86948f7f0f4.js"],"Image"]
10:I[408,["231","static/chunks/231-42eeaa612179830e.js","173","static/chunks/173-af5b99c330035292.js","459","static/chunks/459-6c5dcdc51f43b997.js","797","static/chunks/app/blog/%5B...slug%5D/page-5ad4d86948f7f0f4.js"],"default"]
2:[["$","script",null,{"type":"application/ld+json","dangerouslySetInnerHTML":{"__html":"{\"@context\":\"https://schema.org\",\"@type\":\"BlogPosting\",\"headline\":\"System Design Alex Xu\",\"datePublished\":\"2024-08-15T00:00:00.000Z\",\"dateModified\":\"2024-08-15T00:00:00.000Z\",\"description\":\"Notes from the book \\\"System Design Interview by Alex Xu\\\".\",\"image\":\"/static/images/logo-round.png\",\"url\":\"https://codewisdom.io/blog/book-reading/system-design-alex-xu\",\"author\":[{\"@type\":\"Person\",\"name\":\"Bowen Y\"}]}"}}],["$","section",null,{"className":"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0","children":[["$","$Le",null,{}],["$","article",null,{"children":["$","div",null,{"className":"xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700","children":[["$","header",null,{"className":"pt-6 xl:pb-6","children":["$","div",null,{"className":"space-y-1 text-center","children":[["$","dl",null,{"className":"space-y-10","children":["$","div",null,{"children":[["$","dt",null,{"className":"sr-only","children":"Published on"}],["$","dd",null,{"className":"text-base font-medium leading-6 text-gray-500 dark:text-gray-400","children":["$","time",null,{"dateTime":"2024-08-15T00:00:00.000Z","children":"Wednesday, August 14, 2024"}]}]]}]}],["$","div",null,{"children":["$","h1",null,{"className":"text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14","children":"System Design Alex Xu"}]}]]}]}],["$","div",null,{"className":"grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0","children":[["$","dl",null,{"className":"pb-10 pt-6 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700","children":[["$","dt",null,{"className":"sr-only","children":"Authors"}],["$","dd",null,{"children":["$","ul",null,{"className":"flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8","children":[["$","li","Bowen Y",{"className":"flex items-center space-x-2","children":[["$","$Lf",null,{"src":"/static/images/pixel-avatar.png","width":38,"height":38,"alt":"avatar","className":"h-10 w-10 rounded-full"}],["$","dl",null,{"className":"whitespace-nowrap text-sm font-medium leading-5","children":[["$","dt",null,{"className":"sr-only","children":"Name"}],["$","dd",null,{"className":"text-gray-900 dark:text-gray-100","children":"Bowen Y"}],["$","dt",null,{"className":"sr-only","children":"Twitter"}],["$","dd",null,{"children":"$undefined"}]]}]]}]]}]}]]}],["$","div",null,{"className":"divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0","children":["$","div",null,{"className":"prose max-w-none pb-8 pt-10 dark:prose-invert","children":[["$","h2",null,{"className":"content-header","id":"chapter-one-scale-from-zero-to-millions-of-users","children":[["$","a",null,{"className":"break-words","href":"#chapter-one-scale-from-zero-to-millions-of-users","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Chapter One: SCALE FROM ZERO TO MILLIONS OF USERS"]}],["$","h3",null,{"className":"content-header","id":"cache-eviction-policy","children":[["$","a",null,{"className":"break-words","href":"#cache-eviction-policy","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Cache Eviction Policy"]}],["$","p",null,{"children":"Eviction Policy: Once the cache is full, any requests to add items to the cache might cause existing items to be removed. This is called cache eviction. Least-recently-used (LRU) is the most popular cache eviction policy. Other eviction policies, such as the Least Frequently Used (LFU) or First in First Out (FIFO), can be adopted to satisfy different use cases."}],["$","h4",null,{"className":"content-header","id":"todo-implementation","children":[["$","a",null,{"className":"break-words","href":"#todo-implementation","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"TODO: Implementation?"]}],["$","h3",null,{"className":"content-header","id":"dynamic-content-caching-in-cdn","children":[["$","a",null,{"className":"break-words","href":"#dynamic-content-caching-in-cdn","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Dynamic Content Caching in CDN"]}],["$","p",null,{"children":"TODO"}],["$","p",null,{"children":["$","a",null,{"className":"break-words","target":"_blank","rel":"noopener noreferrer","href":"https://aws.amazon.com/cloudfront/dynamic-content/?nc1=h_ls","children":"https://aws.amazon.com/cloudfront/dynamic-content/?nc1=h_ls"}]}],["$","h3",null,{"className":"content-header","id":"stateless-architecture-vs-stateful-architecture","children":[["$","a",null,{"className":"break-words","href":"#stateless-architecture-vs-stateful-architecture","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Stateless architecture VS Stateful architecture"]}],["$","p",null,{"children":"Stateful architecture: The issue is that every request from the same client must be routed to the same server. This can be done with sticky sessions in most load balancers."}],["$","p",null,{"children":"TODO: Is there any real-world use case using stateful server."}],["$","p",null,{"children":"Stateless architecture: In this stateless architecture, HTTP requests from users can be sent to any web servers, which fetch state data from a shared data store. State data is stored in a shared data store and kept out of web servers."}],["$","ul",null,{"children":["$","li",null,{"children":["$","strong",null,{"children":"Store Session Data in a NoSQL DB"}]}]}],["$","h4",null,{"className":"content-header","id":"question-nosql-is-easier-to-scale-than-traditional-sql","children":[["$","a",null,{"className":"break-words","href":"#question-nosql-is-easier-to-scale-than-traditional-sql","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"QUESTION: NoSQL is easier to scale than Traditional SQL?"]}],["$","h3",null,{"className":"content-header","id":"how-the-database-is-synchronized-in-different-data-center-in-different-physical-regions","children":[["$","a",null,{"className":"break-words","href":"#how-the-database-is-synchronized-in-different-data-center-in-different-physical-regions","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"How the database is synchronized in different data center in different physical regions?"]}],["$","p",null,{"children":["$","a",null,{"className":"break-words","target":"_blank","rel":"noopener noreferrer","href":"https://netflixtechblog.com/active-active-for-multi-regional-resiliency-c47719f6685b","children":"https://netflixtechblog.com/active-active-for-multi-regional-resiliency-c47719f6685b"}]}],["$","h3",null,{"className":"content-header","id":"database-sharding","children":[["$","a",null,{"className":"break-words","href":"#database-sharding","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Database Sharding"]}],["$","p",null,{"children":"Each shard shares the same schema, though the actual data on each shard is unique to the shard."}],["$","ul",null,{"children":["$","li",null,{"children":[["$","p",null,{"children":["Simple Hash Sharding: ",["$","code",null,{"children":"Hash(Partition Key) % NumOfShard -> Different Shard"}]]}],["$","p",null,{"children":"New Challenges Introduced:"}],["$","ul",null,{"children":[["$","li",null,{"children":"Resharding data: Consistent hashing"}],["$","li",null,{"children":"Celebrity problem: Some shards may be accessed more frequently than others"}],["$","li",null,{"children":"Join and de-normalization: A common workaround is to denormalize the database so that queries can be performed in a single table."}]]}]]}]}],["$","$L10",null,{"className":"language-js","children":["$","code",null,{"className":"language-js code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token property literal-property","children":"Reference"}],["$","span",null,{"className":"token operator","children":":"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token number","children":"1"}],["$","span",null,{"className":"token punctuation","children":"]"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Hypertext"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Transfer"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Protocol"}],["$","span",null,{"className":"token operator","children":":"}]," https",["$","span",null,{"className":"token operator","children":":"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token operator","children":"/"}],"en",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"wikipedia"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"org"}],["$","span",null,{"className":"token operator","children":"/"}],"wiki",["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token maybe-class-name","children":"Hypertext_Transfer_Protocol"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token number","children":"2"}],["$","span",null,{"className":"token punctuation","children":"]"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Should"}]," you go ",["$","span",null,{"className":"token maybe-class-name","children":"Beyond"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Relational"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Databases"}],["$","span",null,{"className":"token operator","children":"?"}],["$","span",null,{"className":"token operator","children":":"}]," https",["$","span",null,{"className":"token operator","children":":"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token operator","children":"/"}],"blog",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"teamtreehouse"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"com"}],["$","span",null,{"className":"token operator","children":"/"}],"should",["$","span",null,{"className":"token operator","children":"-"}],"you",["$","span",null,{"className":"token operator","children":"-"}],"go",["$","span",null,{"className":"token operator","children":"-"}],"beyond",["$","span",null,{"className":"token operator","children":"-"}],"relational",["$","span",null,{"className":"token operator","children":"-"}],"databases\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token number","children":"3"}],["$","span",null,{"className":"token punctuation","children":"]"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Replication"}],["$","span",null,{"className":"token operator","children":":"}]," https",["$","span",null,{"className":"token operator","children":":"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token operator","children":"/"}],"en",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"wikipedia"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"org"}],["$","span",null,{"className":"token operator","children":"/"}],"wiki",["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token function","children":["$","span",null,{"className":"token maybe-class-name","children":"Replication_"}]}],["$","span",null,{"className":"token punctuation","children":"("}],"computing",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token number","children":"4"}],["$","span",null,{"className":"token punctuation","children":"]"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Multi"}],["$","span",null,{"className":"token operator","children":"-"}],"master replication",["$","span",null,{"className":"token operator","children":":"}]," https",["$","span",null,{"className":"token operator","children":":"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token operator","children":"/"}],"en",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"wikipedia"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"org"}],["$","span",null,{"className":"token operator","children":"/"}],"wiki",["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token maybe-class-name","children":"Multi"}],["$","span",null,{"className":"token operator","children":"-"}],"master_replication\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token number","children":"5"}],["$","span",null,{"className":"token punctuation","children":"]"}]," ",["$","span",null,{"className":"token constant","children":"NDB"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Cluster"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Replication"}],["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Multi"}],["$","span",null,{"className":"token operator","children":"-"}],["$","span",null,{"className":"token maybe-class-name","children":"Master"}]," and ",["$","span",null,{"className":"token maybe-class-name","children":"Circular"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Replication"}],["$","span",null,{"className":"token operator","children":":"}]," https",["$","span",null,{"className":"token operator","children":":"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token operator","children":"/"}],"dev",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"mysql"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"com"}],["$","span",null,{"className":"token operator","children":"/"}],"doc",["$","span",null,{"className":"token operator","children":"/"}],"refman",["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token number","children":"5.7"}],["$","span",null,{"className":"token operator","children":"/"}],"en",["$","span",null,{"className":"token operator","children":"/"}],"mysql",["$","span",null,{"className":"token operator","children":"-"}],"cluster",["$","span",null,{"className":"token operator","children":"-"}],"replication",["$","span",null,{"className":"token operator","children":"-"}],"multi",["$","span",null,{"className":"token operator","children":"-"}],"master",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"html"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token number","children":"6"}],["$","span",null,{"className":"token punctuation","children":"]"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Caching"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Strategies"}]," and ",["$","span",null,{"className":"token maybe-class-name","children":"How"}]," to ",["$","span",null,{"className":"token maybe-class-name","children":"Choose"}]," the ",["$","span",null,{"className":"token maybe-class-name","children":"Right"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"One"}],["$","span",null,{"className":"token operator","children":":"}]," https",["$","span",null,{"className":"token operator","children":":"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token operator","children":"/"}],"codeahoy",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"com"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token number","children":"2017"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token number","children":"08"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token number","children":"11"}],["$","span",null,{"className":"token operator","children":"/"}],"caching",["$","span",null,{"className":"token operator","children":"-"}],"strategies",["$","span",null,{"className":"token operator","children":"-"}],"and",["$","span",null,{"className":"token operator","children":"-"}],"how",["$","span",null,{"className":"token operator","children":"-"}],"to",["$","span",null,{"className":"token operator","children":"-"}],"choose",["$","span",null,{"className":"token operator","children":"-"}],"the",["$","span",null,{"className":"token operator","children":"-"}],"right",["$","span",null,{"className":"token operator","children":"-"}],"one",["$","span",null,{"className":"token operator","children":"/"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token number","children":"7"}],["$","span",null,{"className":"token punctuation","children":"]"}]," ",["$","span",null,{"className":"token constant","children":"R"}],["$","span",null,{"className":"token punctuation","children":"."}]," ",["$","span",null,{"className":"token property-access","children":["$","span",null,{"className":"token maybe-class-name","children":"Nishtala"}]}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"Facebook, Scaling Memcache at,\""}]," 10th ",["$","span",null,{"className":"token constant","children":"USENIX"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Symposium"}]," on ",["$","span",null,{"className":"token maybe-class-name","children":"Networked"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Systems"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Design"}]," and ",["$","span",null,{"className":"token function","children":["$","span",null,{"className":"token maybe-class-name","children":"Implementation"}]}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token constant","children":"NSDI"}]," ’",["$","span",null,{"className":"token number","children":"13"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token number","children":"8"}],["$","span",null,{"className":"token punctuation","children":"]"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Single"}]," point ",["$","span",null,{"className":"token keyword","children":"of"}]," ",["$","span",null,{"className":"token property literal-property","children":"failure"}],["$","span",null,{"className":"token operator","children":":"}]," https",["$","span",null,{"className":"token operator","children":":"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token operator","children":"/"}],"en",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"wikipedia"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"org"}],["$","span",null,{"className":"token operator","children":"/"}],"wiki",["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token maybe-class-name","children":"Single_point_of_failure"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token number","children":"9"}],["$","span",null,{"className":"token punctuation","children":"]"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Amazon"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"CloudFront"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Dynamic"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Content"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Delivery"}],["$","span",null,{"className":"token operator","children":":"}]," https",["$","span",null,{"className":"token operator","children":":"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token operator","children":"/"}],"aws",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"amazon"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"com"}],["$","span",null,{"className":"token operator","children":"/"}],"cloudfront",["$","span",null,{"className":"token operator","children":"/"}],"dynamic",["$","span",null,{"className":"token operator","children":"-"}],"content",["$","span",null,{"className":"token operator","children":"/"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token number","children":"10"}],["$","span",null,{"className":"token punctuation","children":"]"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Configure"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Sticky"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Sessions"}]," ",["$","span",null,{"className":"token keyword control-flow","children":"for"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Your"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Classic"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Load"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Balancer"}],["$","span",null,{"className":"token operator","children":":"}]," https",["$","span",null,{"className":"token operator","children":":"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token operator","children":"/"}],"docs",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"aws"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"amazon"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"com"}],["$","span",null,{"className":"token operator","children":"/"}],"elasticloadbalancing",["$","span",null,{"className":"token operator","children":"/"}],"latest",["$","span",null,{"className":"token operator","children":"/"}],"classic",["$","span",null,{"className":"token operator","children":"/"}],"elb",["$","span",null,{"className":"token operator","children":"-"}],"sticky",["$","span",null,{"className":"token operator","children":"-"}],"sessions",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"html"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token number","children":"11"}],["$","span",null,{"className":"token punctuation","children":"]"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Active"}],["$","span",null,{"className":"token operator","children":"-"}],["$","span",null,{"className":"token maybe-class-name","children":"Active"}]," ",["$","span",null,{"className":"token keyword control-flow","children":"for"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Multi"}],["$","span",null,{"className":"token operator","children":"-"}],["$","span",null,{"className":"token maybe-class-name","children":"Regional"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Resiliency"}],["$","span",null,{"className":"token operator","children":":"}]," https",["$","span",null,{"className":"token operator","children":":"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token operator","children":"/"}],"netflixtechblog",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"com"}],["$","span",null,{"className":"token operator","children":"/"}],"active",["$","span",null,{"className":"token operator","children":"-"}],"active",["$","span",null,{"className":"token operator","children":"-"}],["$","span",null,{"className":"token keyword control-flow","children":"for"}],["$","span",null,{"className":"token operator","children":"-"}],"multi",["$","span",null,{"className":"token operator","children":"-"}],"regional",["$","span",null,{"className":"token operator","children":"-"}],"resiliency",["$","span",null,{"className":"token operator","children":"-"}],"c47719f6685b\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token number","children":"12"}],["$","span",null,{"className":"token punctuation","children":"]"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Amazon"}]," ",["$","span",null,{"className":"token constant","children":"EC2"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"High"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Memory"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Instances"}],["$","span",null,{"className":"token operator","children":":"}]," https",["$","span",null,{"className":"token operator","children":":"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token operator","children":"/"}],"aws",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"amazon"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"com"}],["$","span",null,{"className":"token operator","children":"/"}],"ec2",["$","span",null,{"className":"token operator","children":"/"}],"instance",["$","span",null,{"className":"token operator","children":"-"}],"types",["$","span",null,{"className":"token operator","children":"/"}],"high",["$","span",null,{"className":"token operator","children":"-"}],"memory",["$","span",null,{"className":"token operator","children":"/"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token number","children":"13"}],["$","span",null,{"className":"token punctuation","children":"]"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"What"}]," it takes to run ",["$","span",null,{"className":"token maybe-class-name","children":"Stack"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Overflow"}],["$","span",null,{"className":"token operator","children":":"}]," http",["$","span",null,{"className":"token operator","children":":"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token operator","children":"/"}],"nickcraver",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"com"}],["$","span",null,{"className":"token operator","children":"/"}],"blog",["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token number","children":"2013"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token number","children":"11"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token number","children":"22"}],["$","span",null,{"className":"token operator","children":"/"}],"what",["$","span",null,{"className":"token operator","children":"-"}],"it",["$","span",null,{"className":"token operator","children":"-"}],"takes",["$","span",null,{"className":"token operator","children":"-"}],"to",["$","span",null,{"className":"token operator","children":"-"}],"run",["$","span",null,{"className":"token operator","children":"-"}],"stack",["$","span",null,{"className":"token operator","children":"-"}],"overflow\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token number","children":"14"}],["$","span",null,{"className":"token punctuation","children":"]"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"What"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"The"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Heck"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Are"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"You"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Actually"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Using"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"NoSQL"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"For"}],["$","span",null,{"className":"token operator","children":":"}]," http",["$","span",null,{"className":"token operator","children":":"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token operator","children":"/"}],"highscalability",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"com"}],["$","span",null,{"className":"token operator","children":"/"}],"blog",["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token number","children":"2010"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token number","children":"12"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token number","children":"6"}],["$","span",null,{"className":"token operator","children":"/"}],"what",["$","span",null,{"className":"token operator","children":"-"}],"the",["$","span",null,{"className":"token operator","children":"-"}],"heck",["$","span",null,{"className":"token operator","children":"-"}],"are",["$","span",null,{"className":"token operator","children":"-"}],"you",["$","span",null,{"className":"token operator","children":"-"}],"actually",["$","span",null,{"className":"token operator","children":"-"}],"using",["$","span",null,{"className":"token operator","children":"-"}],"nosqlfor",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"html"}],"\n"]}]]}]}],["$","h2",null,{"className":"content-header","id":"chapter-two-back-of-the-envelope-estimation","children":[["$","a",null,{"className":"break-words","href":"#chapter-two-back-of-the-envelope-estimation","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Chapter Two: BACK-OF-THE-ENVELOPE ESTIMATION"]}],["$","h4",null,{"className":"content-header","id":"latency","children":[["$","a",null,{"className":"break-words","href":"#latency","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Latency"]}],["$","p",null,{"children":["$","img",null,{"alt":"latency-2020","src":"/assets/latency-2020.png"}]}],["$","p",null,{"children":["Reference: ",["$","a",null,{"className":"break-words","target":"_blank","rel":"noopener noreferrer","href":"https://colin-scott.github.io/personal_website/research/interactive_latency.html","children":"https://colin-scott.github.io/personal_website/research/interactive_latency.html"}]]}],["$","h4",null,{"className":"content-header","id":"service-level-agreementsla","children":[["$","a",null,{"className":"break-words","href":"#service-level-agreementsla","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Service Level Agreement(SLA)"]}],["$","p",null,{"children":["$","img",null,{"alt":"SLA","src":"/assets/SLA.png"}]}],["$","h4",null,{"className":"content-header","id":"make-clear-assumptions-during-interviews","children":[["$","a",null,{"className":"break-words","href":"#make-clear-assumptions-during-interviews","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Make Clear Assumptions during Interviews"]}],["$","ul",null,{"children":[["$","li",null,{"children":"QPS"}],["$","li",null,{"children":"peak QPS"}],["$","li",null,{"children":"storage"}],["$","li",null,{"children":"cache"}],["$","li",null,{"children":"number of servers"}]]}],["$","h2",null,{"className":"content-header","id":"chapter-3-a-framework-for-system-design-interviews","children":[["$","a",null,{"className":"break-words","href":"#chapter-3-a-framework-for-system-design-interviews","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"CHAPTER 3: A FRAMEWORK FOR SYSTEM DESIGN INTERVIEWS"]}],["$","h4",null,{"className":"content-header","id":"what-is-expected-in-a-system-design-interview","children":[["$","a",null,{"className":"break-words","href":"#what-is-expected-in-a-system-design-interview","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"What is expected in a system design interview?"]}],["$","ul",null,{"children":[["$","li",null,{"children":"Technical skills"}],["$","li",null,{"children":"The ability to cooperate"}],["$","li",null,{"children":"The ability to ask good questions"}],["$","li",null,{"children":"Real world trade-offs"}]]}],["$","h3",null,{"className":"content-header","id":"a-4-step-process-for-effective-system-design-interview","children":[["$","a",null,{"className":"break-words","href":"#a-4-step-process-for-effective-system-design-interview","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"A 4-step process for effective system design interview"]}],["$","h5",null,{"className":"content-header","id":"step-1---understand-the-problem-and-establish-design-scope","children":[["$","a",null,{"className":"break-words","href":"#step-1---understand-the-problem-and-establish-design-scope","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Step 1 - Understand the problem and establish design scope"]}],["$","ul",null,{"children":[["$","li",null,{"children":["Slow down. Think deeply and ask questions to clarify requirements and assumptions.",["$","ul",null,{"children":[["$","li",null,{"children":"What Features? -> What microservice we need + Database Schema + Data Limitation + Data Flow + API endpoints(Spec)"}],["$","li",null,{"children":"What Size? (How many users and what frequency) -> Algorithm Complexity + TPS + Storage + Latency"}],["$","li",null,{"children":"Level of Consistency? -> Weak or Strong"}],["$","li",null,{"children":"Current technology stack? -> If there is something you can leverage to simplify the design"}]]}]]}],["$","li",null,{"children":"Write down your assumptions on the whiteboard"}]]}],["$","h5",null,{"className":"content-header","id":"step-2---propose-high-level-design-and-get-buy-in","children":[["$","a",null,{"className":"break-words","href":"#step-2---propose-high-level-design-and-get-buy-in","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Step 2 - Propose high-level design and get buy-in"]}],["$","ul",null,{"children":[["$","li",null,{"children":"Come up with an initial blueprint for the design. Ask for feedback. Treat your interviewer as a teammate and work together. Many good interviewers love to talk and get involved."}],["$","li",null,{"children":["Draw ",["$","strong",null,{"children":"box diagrams"}]," with key components on the whiteboard or paper. This might include clients (mobile/web), APIs, web servers, data stores, cache, CDN, message queue, etc."]}],["$","li",null,{"children":"Do back-of-the-envelope calculations to evaluate if your blueprint fits the scale constraints. Think out loud. Communicate with your interviewer if back-of-the-envelope is necessary before diving into it."}],["$","li",null,{"children":"Go through a few concrete use cases to discover edge cases"}]]}],["$","h5",null,{"className":"content-header","id":"step-3---design-deep-dive","children":[["$","a",null,{"className":"break-words","href":"#step-3---design-deep-dive","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Step 3 - Design deep dive"]}],["$","ul",null,{"children":[["$","li",null,{"children":["You shall work with the interviewer to identify and prioritize components in the architecture. Different interviewers may have different preferences on different systems.",["$","ul",null,{"children":[["$","li",null,{"children":"For URL shortener, it is interesting to dive into the hash function design that converts a long URL to a short one."}],["$","li",null,{"children":"For a chat system, how to reduce latency and how to support online/offline status are two interesting topics."}],["$","li",null,{"children":"For an e-commerce platform, it is interesting to dive into inventory management and the order processing workflow."}],["$","li",null,{"children":"For a social media platform, how to handle real-time updates for the feed and notifications, and how to implement data partitioning and sharding are two interesting topics."}],["$","li",null,{"children":"For a video streaming service, it is interesting to dive into streaming protocols and techniques for reducing latency."}],["$","li",null,{"children":"For a ride-sharing service, how to handle real-time ride tracking and how to implement the matching algorithm and surge pricing are two interesting topics."}],["$","li",null,{"children":"For an online marketplace, it is interesting to dive into search and recommendation algorithms and fraud detection and prevention."}],["$","li",null,{"children":"For a cloud storage service, how to ensure data redundancy and replication and how to manage efficient file storage and retrieval are two interesting topics."}],["$","li",null,{"children":"For a content management system (CMS), it is interesting to dive into user roles and permissions and performance optimization for content delivery."}]]}]]}],["$","li",null,{"children":"Try not to get into unnecessary details."}]]}],["$","h5",null,{"className":"content-header","id":"step-4---wrap-up","children":[["$","a",null,{"className":"break-words","href":"#step-4---wrap-up","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Step 4 - Wrap up"]}],["$","p",null,{"children":"In this final step, the interviewer might ask you a few follow-up questions or give you the freedom to discuss other additional points."}],["$","ul",null,{"children":[["$","li",null,{"children":"The interviewer might want you to identify the system bottlenecks and discuss potential improvements."}],["$","li",null,{"children":"It could be useful to give the interviewer a recap of your design."}],["$","li",null,{"children":"Error cases (server failure, network loss, etc.) are interesting to talk about."}],["$","li",null,{"children":"Operation issues are worth mentioning. How do you monitor metrics and error logs? How to roll out the system?"}],["$","li",null,{"children":"How to handle the next scale curve is also an interesting topic."}]]}],["$","h4",null,{"className":"content-header","id":"dos","children":[["$","a",null,{"className":"break-words","href":"#dos","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Dos"]}],["$","ul",null,{"children":[["$","li",null,{"children":"Always ask for clarification. Do not assume your assumption is correct."}],["$","li",null,{"children":"Understand the requirements of the problem."}],["$","li",null,{"children":"There is neither the right answer nor the best answer. A solution designed to solve the problems of a young startup is different from that of an established company with millions of users. Make sure you understand the requirements."}],["$","li",null,{"children":"Let the interviewer know what you are thinking. Communicate with your interview."}],["$","li",null,{"children":"Suggest multiple approaches if possible."}],["$","li",null,{"children":"Once you agree with your interviewer on the blueprint, go into details on each component. Design the most critical components first."}],["$","li",null,{"children":"Bounce ideas off the interviewer. A good interviewer works with you as a teammate."}],["$","li",null,{"children":"Never give up."}]]}],["$","h4",null,{"className":"content-header","id":"donts","children":[["$","a",null,{"className":"break-words","href":"#donts","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Don'ts"]}],["$","ul",null,{"children":[["$","li",null,{"children":"Don't be unprepared for typical interview questions."}],["$","li",null,{"children":"Don’t jump into a solution without clarifying the requirements and assumptions."}],["$","li",null,{"children":"Don’t go into too much detail on a single component in the beginning. Give the high-level design first then drills down."}],["$","li",null,{"children":"If you get stuck, don't hesitate to ask for hints."}],["$","li",null,{"children":"Again, communicate. Don't think in silence."}],["$","li",null,{"children":"Don’t think your interview is done once you give the design. You are not done until your interviewer says you are done. Ask for feedback early and often."}]]}],["$","h2",null,{"className":"content-header","id":"chapter-4-design-a-rate-limiter","children":[["$","a",null,{"className":"break-words","href":"#chapter-4-design-a-rate-limiter","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"CHAPTER 4: DESIGN A RATE LIMITER"]}],["$","p",null,{"children":"The benefits of using an API rate limiter:"}],["$","ul",null,{"children":[["$","li",null,{"children":"Prevent resource starvation caused by Denial of Service (DoS) attack."}],["$","li",null,{"children":"Reduce cost. Limiting excess requests means fewer servers and allocating more resources to high priority APIs."}],["$","li",null,{"children":"Prevent servers from being overloaded."}]]}],["$","h4",null,{"className":"content-header","id":"step-1---understand-the-problem-and-establish-design-scope-1","children":[["$","a",null,{"className":"break-words","href":"#step-1---understand-the-problem-and-establish-design-scope-1","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Step 1 - Understand the problem and establish design scope"]}],["$","ul",null,{"children":[["$","li",null,{"children":"What kind of rate limiter are we going to design? Is it a client-side rate limiter (written in JS and can be bypassed by users who manipulate the code) or server-side API rate limiter?"}],["$","li",null,{"children":"Does the rate limiter throttle API requests based on IP, the user ID, or other properties?"}],["$","li",null,{"children":"What is the scale of the system? Is it built for a startup or a big company with a large user base?"}],["$","li",null,{"children":"Will the system work in a distributed environment?"}],["$","li",null,{"children":"Is the rate limiter a separate service or should it be implemented in application code?"}],["$","li",null,{"children":"Do we need to inform users who are throttled?"}]]}],["$","p",null,{"children":["$","strong",null,{"children":"Summary of the requirements:"}]}],["$","ul",null,{"children":[["$","li",null,{"children":"Accurately limit excessive requests."}],["$","li",null,{"children":"Low latency. The rate limiter should not slow down HTTP response time."}],["$","li",null,{"children":"Use as little memory as possible."}],["$","li",null,{"children":"Distributed rate limiting. The rate limiter can be shared across multiple servers or processes."}],["$","li",null,{"children":"Exception handling. Show clear exceptions to users when their requests are throttled."}],["$","li",null,{"children":"High fault tolerance. If there are any problems with the rate limiter (for example, a cache server goes offline), it does not affect the entire system."}]]}],["$","h4",null,{"className":"content-header","id":"step-2---propose-high-level-design-and-get-buy-in-1","children":[["$","a",null,{"className":"break-words","href":"#step-2---propose-high-level-design-and-get-buy-in-1","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Step 2 - Propose high-level design and get buy-in"]}],["$","ol",null,{"children":["$","li",null,{"children":"Where to implement the rate limiter:"}]}],["$","ul",null,{"children":[["$","li",null,{"children":"Client Side(not reliable)"}],["$","li",null,{"children":"Server Side(Inside API Servers)"}],["$","li",null,{"children":"Microservice in the middle: rate limiting is usually implemented within a component called API gateway"}]]}],["$","p",null,{"children":"So where should the rater limiter be implemented, on the server-side or in a gateway? There is no absolute answer."}],["$","ol",null,{"start":"2","children":["$","li",null,{"children":"What technology stacks to use:"}]}],["$","ul",null,{"children":[["$","li",null,{"children":"Cache service: Redis/Memcache"}],["$","li",null,{"children":"Rate Limiting Rules: QPS by account, IP"}],["$","li",null,{"children":["Algorithm for rate limiting:",["$","ul",null,{"children":[["$","li",null,{"children":["Token bucket",["$","ul",null,{"children":[["$","li",null,{"children":"Bucket size: the maximum number of tokens allowed in the bucket"}],["$","li",null,{"children":"Refill rate: number of tokens put into the bucket every second"}],["$","li",null,{"children":"How many buckets do we need?"}],["$","li",null,{"children":"Improvement: Lazy Refilling(Refill when receiving new requests) + Automatic Cleanup"}],["$","li",null,{"children":"Better in scenarios requiring instant responses."}],["$","li",null,{"children":["AWS API Gateway: ",["$","a",null,{"className":"break-words","target":"_blank","rel":"noopener noreferrer","href":"https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-request-throttling.html","children":"https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-request-throttling.html"}]]}],["$","li",null,{"children":["Stripe: ",["$","a",null,{"className":"break-words","target":"_blank","rel":"noopener noreferrer","href":"https://stripe.com/blog/rate-limiters","children":"https://stripe.com/blog/rate-limiters"}]]}]]}]]}],["$","li",null,{"children":["Leaking bucket",["$","ul",null,{"children":[["$","li",null,{"children":"Bucket size: it is equal to the queue size. The queue holds the requests to be processed at a fixed rate."}],["$","li",null,{"children":"Outflow rate: it defines how many requests can be processed at a fixed rate, usually in seconds."}],["$","li",null,{"children":"But the requests at the end of the queue will be delayed."}],["$","li",null,{"children":"Better in scenarios requiring predictable processing rate."}],["$","li",null,{"children":["Shopify: ",["$","a",null,{"className":"break-words","target":"_blank","rel":"noopener noreferrer","href":"https://shopify.dev/docs/api/usage/rate-limits","children":"https://shopify.dev/docs/api/usage/rate-limits"}]]}]]}]]}],["$","li",null,{"children":["Fixed window counter",["$","ul",null,{"children":[["$","li",null,{"children":"A counter used in each fixed time window(per minute, pet hour...)"}],["$","li",null,{"children":"Pros: simplicity and ease of implementation"}],["$","li",null,{"children":"Cons: uneven request distribution near the boundary of time windows."}],["$","li",null,{"children":"Widely used in a SaaS platform subscription service.(10000 API calls per month)"}],["$","li",null,{"children":"Better for time-sensitive scenarios like subscription, game, voting systems, etc."}]]}]]}],["$","li",null,{"children":["Sliding window log",["$","ul",null,{"children":[["$","li",null,{"children":"Rate limiting implemented by this algorithm is very accurate."}],["$","li",null,{"children":"Require lots of memory and computing for storing and comparing the timestamps of each request"}],["$","li",null,{"children":"So at the cost of more memory and processing power, this algorithm is used for Financial Systems, Authentication Systems, which are not high-frequency but requires accuracy."}]]}]]}],["$","li",null,{"children":["Sliding window counter",["$","ul",null,{"children":[["$","li",null,{"children":["Combination of fixed window counter and sliding window log: ",["$","code",null,{"children":"Requests in current window + requests in the previous window * overlap percentage of the rolling window and previous window"}]]}],["$","li",null,{"children":"Memory efficient and better burst resolving than fixed window counter when facing the edge of the time window issues"}],["$","li",null,{"children":"An approximation of the actual rate because it assumes requests in the previous window are evenly distributed"}],["$","li",null,{"children":"Cloudfare: 0.003% of requests are wrongly allowed or rate limited among 400 million requests"}]]}]]}]]}]]}]]}],["$","ol",null,{"start":"3","children":["$","li",null,{"children":"High-level design graph"}]}],["$","p",null,{"children":["$","img",null,{"alt":"rate-limiter-highlevel-design","src":"/assets/rate-limiter-highlevel-design.png"}]}],["$","h4",null,{"className":"content-header","id":"step-3---design-deep-dive-1","children":[["$","a",null,{"className":"break-words","href":"#step-3---design-deep-dive-1","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Step 3 - Design deep dive"]}],["$","p",null,{"children":"The high-level design(Rate limiting as the middleware using Redis as the counter storage) does not answer the following questions:"}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":"How are rate limiting rules created? Where are the rules stored?"}],["$","ul",null,{"children":[["$","li",null,{"children":["Rules are generally written in configuration files and saved on disk.",["$","$L10",null,{"className":"language-yaml","children":["$","code",null,{"className":"code-highlight language-yaml","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token atrule key","children":"domain"}],["$","span",null,{"className":"token punctuation","children":":"}]," auth\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token atrule key","children":"descriptors"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token punctuation","children":"-"}]," ",["$","span",null,{"className":"token atrule key","children":"key"}],["$","span",null,{"className":"token punctuation","children":":"}]," auth_type\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token atrule key","children":"Value"}],["$","span",null,{"className":"token punctuation","children":":"}]," login\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token atrule key","children":"rate_limit"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token atrule key","children":"unit"}],["$","span",null,{"className":"token punctuation","children":":"}]," minute\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token atrule key","children":"requests_per_unit"}],["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"5"}],"\n"]}]]}]}]]}],["$","li",null,{"children":["Afterwards, should the rules be stored in memory or in redis?",["$","ul",null,{"children":[["$","li",null,{"children":["Loading Rules into Memory:",["$","ul",null,{"children":[["$","li",null,{"children":"Environment Variables or In-Memory Storage: When your application starts, you can load the rate limit rules from the YAML file into memory (such as environment variables or a configuration object)."}],["$","li",null,{"children":"Advantage: Fast access, minimal latency, and no dependency on external services during rule evaluation."}],["$","li",null,{"children":"Disadvantage: Requires application restart to update rules."}]]}]]}],["$","li",null,{"children":["Caching Rules in Redis:",["$","ul",null,{"children":[["$","li",null,{"children":"Redis Cache: You can load the rate limit rules into Redis when your application starts. The application can then fetch these rules from Redis when needed."}],["$","li",null,{"children":"Advantage: Centralized storage for rules, making it easier to update rules without restarting the application. This is especially useful in distributed systems where multiple instances of your application need to share the same rules."}],["$","li",null,{"children":"Disadvantage: Slightly increased latency compared to in-memory access, but still very fast due to Redis's performance."}]]}]]}]]}]]}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"How to handle requests that are rate limited?"}],["$","ul",null,{"children":[["$","li",null,{"children":"In case a request is rate limited, APIs return a HTTP response code 429 (too many requests) to the client."}],["$","li",null,{"children":"Sometimes we need to keep those requests to be processed later."}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Rate limiter HTTP headers"}],["$","ul",null,{"children":[["$","li",null,{"children":"X-Ratelimit-Remaining: The remaining number of allowed requests within the window."}],["$","li",null,{"children":"X-Ratelimit-Limit: It indicates how many calls the client can make per time window."}],["$","li",null,{"children":"X-Ratelimit-Retry-After: The number of seconds to wait until you can make a request again without being throttled."}]]}]]}],["$","li",null,{"children":["$","p",null,{"children":["Detailed design: ",["$","img",null,{"alt":"rate-limiter-detailed-design","src":"/assets/rate-limiter-detailed-design.png"}]]}]}],["$","li",null,{"children":[["$","p",null,{"children":"Rate limiter in a distributed environment"}],["$","ul",null,{"children":[["$","li",null,{"children":["Race condition",["$","ul",null,{"children":[["$","li",null,{"children":"Locks are the most obvious solution for solving race condition. However, locks will significantly slow down the system."}],["$","li",null,{"children":["Two strategies are commonly used to solve the problem:",["$","ul",null,{"children":[["$","li",null,{"children":["Lua script",["$","ul",null,{"children":["$","li",null,{"children":["reference: ",["$","a",null,{"className":"break-words","target":"_blank","rel":"noopener noreferrer","href":"https://gist.github.com/ptarjan/e38f45f2dfe601419ca3af937fff574d#request-rate-limiter","children":"https://gist.github.com/ptarjan/e38f45f2dfe601419ca3af937fff574d#request-rate-limiter"}]]}]}]]}],["$","li",null,{"children":["Sorted sets data structure in Redis",["$","ul",null,{"children":["$","li",null,{"children":["reference: ",["$","a",null,{"className":"break-words","target":"_blank","rel":"noopener noreferrer","href":"https://engineering.classdojo.com/blog/2015/02/06/rolling-rate-limiter/","children":"https://engineering.classdojo.com/blog/2015/02/06/rolling-rate-limiter/"}]]}]}]]}]]}]]}]]}]]}],["$","li",null,{"children":["Synchronization issue",["$","ul",null,{"children":["$","li",null,{"children":"Use centralized data stores like Redis"}]}]]}]]}]]}]]}],["$","h4",null,{"className":"content-header","id":"step-4---wrap-up-1","children":[["$","a",null,{"className":"break-words","href":"#step-4---wrap-up-1","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Step 4 - Wrap up"]}],["$","ul",null,{"children":[["$","li",null,{"children":["Hard vs soft rate limiting",["$","ul",null,{"children":[["$","li",null,{"children":"Hard: The number of requests cannot exceed the threshold."}],["$","li",null,{"children":"Soft: Requests can exceed the threshold for a short period."}]]}]]}],["$","li",null,{"children":["Rate limiting at different levels:",["$","ul",null,{"children":[["$","li",null,{"children":"at the application level (HTTP: layer 7)."}],["$","li",null,{"children":["by IP addresses using Iptables (IP: layer 3).",["$","ul",null,{"children":["$","li",null,{"children":["Reference: ",["$","a",null,{"className":"break-words","target":"_blank","rel":"noopener noreferrer","href":"https://blog.programster.org/rate-limit-requests-with-iptables","children":"https://blog.programster.org/rate-limit-requests-with-iptables"}]]}]}]]}]]}]]}]]}],["$","h4",null,{"className":"content-header","id":"expansion","children":[["$","a",null,{"className":"break-words","href":"#expansion","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Expansion"]}],["$","p",null,{"children":"How does Redis solve the consistency issue in distributed mode?"}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":"Redis Consistency Model"}],["$","ul",null,{"children":["$","li",null,{"children":[["$","strong",null,{"children":"Eventual Consistency:"}]," Redis, by default, does not provide strong consistency. Instead, it operates under an eventual consistency model. This means that after a write operation, there might be a delay before all replicas have the same data as the master. During this period, read operations from replicas might return outdated data."]}]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Master-Slave (Primary-Replica) Replication:"}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Mechanism:"}]," In Redis, a master (primary) node handles all write operations. One or more slave (replica) nodes replicate data from the master. Replication is typically asynchronous, meaning that there is a delay before the replicas catch up with the master."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Consistency:"}]," Because replication is asynchronous, it is possible for replicas to lag behind the master, leading to a window where reads from replicas might return stale data."]}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Redis Cluster:"}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Sharding:"}]," Redis Cluster allows Redis to scale horizontally by partitioning (sharding) the dataset across multiple master nodes. Each master in the cluster is responsible for a subset of the keyspace, determined by consistent hashing."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Groups:"}]," Each shard in a Redis Cluster has one master and several replicas (slaves). This master-replica setup within each shard provides redundancy and improves fault tolerance."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Key Distribution:"}]," When a key is stored or accessed, the Redis Cluster calculates which shard (master-replica group) is responsible for that key using consistent hashing. The key is then sent to the appropriate master node within the cluster."]}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Redis Sentinel:"}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Monitoring and Failover:"}]," Redis Sentinel is responsible for monitoring the health of the master nodes. If a master node fails, Sentinel coordinates the election of a new master from one of the replicas. This process involves promoting the most up-to-date replica to the master role."]}],["$","li",null,{"children":[["$","strong",null,{"children":"High Availability:"}]," Sentinel helps to ensure high availability by automatically handling failovers, making the Redis deployment more resilient to failures."]}]]}]]}]]}],["$","h2",null,{"className":"content-header","id":"chapter-5-design-consistent-hashing","children":[["$","a",null,{"className":"break-words","href":"#chapter-5-design-consistent-hashing","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"CHAPTER 5: DESIGN CONSISTENT HASHING"]}],["$","p",null,{"children":"Consistent hashing is a special kind of hashing such that when a hash table is re-sized and consistent hashing is used, only k/n keys need to be remapped on average, where k is the number of keys, and n is the number of slots. In contrast, in most traditional hash tables, a change in the number of array slots causes nearly all keys to be remapped"}],["$","ul",null,{"children":[["$","li",null,{"children":"Traditional Hashing: hash(node_id) % node_number"}],["$","li",null,{"children":"Consistent Hashing: hash(node_id)"}],["$","li",null,{"children":["Virtual Node in Consistent Hashing: hash(node_id + str(vnode_id))",["$","ul",null,{"children":[["$","li",null,{"children":"Small Clusters (3-10 Nodes): Consider using 100-200 vnodes per node."}],["$","li",null,{"children":"Medium Clusters (10-50 Nodes): 50-150 vnodes per node are usually sufficient"}],["$","li",null,{"children":"Large Clusters (50+ Nodes): 20-100 vnodes per node might be appropriate."}],["$","li",null,{"children":"The standard deviation that measures how data are spread out is between 5% (200 virtual nodes) and 10% (100 virtual nodes) of the mean."}],["$","li",null,{"children":"However, more spaces are needed to store data about virtual nodes. This is a tradeoff, and we can tune the number of virtual nodes to fit our system requirements."}]]}]]}]]}],["$","ol",null,{"children":["$","li",null,{"children":"Find affected range"}]}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":["Add a new node onto the ring. The affected range starts from the newly added node(",["$","code",null,{"children":"current"}],") and moves ",["$","strong",null,{"children":"anticlockwise"}]," around the ring until a server is found (",["$","code",null,{"children":"previous"}],"). Thus, keys located between ",["$","code",null,{"children":"current"}]," and ",["$","code",null,{"children":"previous"}],"(which originaly belong to ",["$","code",null,{"children":"next"}],", the node ",["$","code",null,{"children":"next"}]," to ",["$","code",null,{"children":"current"}],") need to be redistributed to ",["$","code",null,{"children":"current"}],"."]}]}],["$","li",null,{"children":["$","p",null,{"children":["Remove a node from the ring. The affected range starts from the newly added node(",["$","code",null,{"children":"current"}],") and moves ",["$","strong",null,{"children":"anticlockwise"}]," around the ring until a server is found (",["$","code",null,{"children":"previous"}],"). Thus, keys located between ",["$","code",null,{"children":"current"}]," and ",["$","code",null,{"children":"previous"}],"(which originaly belong to ",["$","code",null,{"children":"current"}],") need to be redistributed to ",["$","code",null,{"children":"next"}],"."]}]}]]}],["$","ol",null,{"start":"2","children":["$","li",null,{"children":"Benefits of consistent hashing"}]}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"Minimized keys are redistributed when servers are added or removed."}]}],["$","li",null,{"children":["$","p",null,{"children":"It is easy to scale horizontally because data are more evenly distributed."}]}],["$","li",null,{"children":["$","p",null,{"children":"Mitigate hotspot key problem. Excessive access to a specific shard could cause server overload. Consistent hashing helps to mitigate the problem by distributing the data more evenly."}]}]]}],["$","h2",null,{"className":"content-header","id":"chapter-6-design-a-key-value-store","children":[["$","a",null,{"className":"break-words","href":"#chapter-6-design-a-key-value-store","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"CHAPTER 6: DESIGN A KEY-VALUE STORE"]}],["$","h4",null,{"className":"content-header","id":"1-requirements","children":[["$","a",null,{"className":"break-words","href":"#1-requirements","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"1. Requirements"]}],["$","ul",null,{"children":[["$","li",null,{"children":"The size of a key-value pair is small: less than 10 KB."}],["$","li",null,{"children":"Ability to store big data."}],["$","li",null,{"children":"High availability: The system responds quickly, even during failures."}],["$","li",null,{"children":"High scalability: The system can be scaled to support large data set."}],["$","li",null,{"children":"Automatic scaling: The addition/deletion of servers should be automatic based on traffic."}],["$","li",null,{"children":"Tunable consistency."}],["$","li",null,{"children":"Low latency."}]]}],["$","h4",null,{"className":"content-header","id":"2-what-features-are-expected-in-capap-or-cp","children":[["$","a",null,{"className":"break-words","href":"#2-what-features-are-expected-in-capap-or-cp","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"2. What features are expected in CAP(AP or CP)?"]}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":[["$","strong",null,{"children":"Consistency"}],": consistency means all clients see the same data at the same time no matter which node they connect to."]}]}],["$","li",null,{"children":["$","p",null,{"children":[["$","strong",null,{"children":"Availability"}],": availability means any client which requests data gets a response even if some of the nodes are down."]}]}],["$","li",null,{"children":["$","p",null,{"children":[["$","strong",null,{"children":"Partition Tolerance"}],": a partition indicates a communication break between two nodes. Partition tolerance means the system continues to operate despite network partitions."]}]}]]}],["$","p",null,{"children":"NOTE: Since network failure is unavoidable, a distributed system must tolerate network partition. Thus, a CA system cannot exist in real-world applications."}],["$","p",null,{"children":"CP(Strong Consistency): If we choose consistency over availability (CP system), we must block all write operations to n1 and n2 to avoid data inconsistency among these three servers when n3 is offline, which makes the system unavailable."}],["$","p",null,{"children":"Examples:"}],["$","ul",null,{"children":[["$","li",null,{"children":"Paxos"}],["$","li",null,{"children":"Raft"}],["$","li",null,{"children":"Zookeeper"}],["$","li",null,{"children":"Etcd"}]]}],["$","p",null,{"children":"AP(Eventual Consistency): If we choose availability over consistency (AP system), the system keeps accepting reads, even though it might return stale data. For writes, n1 and n2 will keep accepting writes, and data will be synced to n3 when the network partition is resolved."}],["$","p",null,{"children":"Examples:"}],["$","ul",null,{"children":[["$","li",null,{"children":"Cassandra"}],["$","li",null,{"children":"DNS (Domain Name System)"}]]}],["$","h4",null,{"className":"content-header","id":"3-system-components","children":[["$","a",null,{"className":"break-words","href":"#3-system-components","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"3. System components"]}],["$","p",null,{"children":"Core components and techniques used to build a key-value store:"}],["$","h5",null,{"className":"content-header","id":"component-1-data-partition","children":[["$","a",null,{"className":"break-words","href":"#component-1-data-partition","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Component 1: Data partition"]}],["$","ul",null,{"children":[["$","li",null,{"children":["Challenges in partitioning the data:",["$","ul",null,{"children":[["$","li",null,{"children":"Distribute data across multiple servers evenly."}],["$","li",null,{"children":"Minimize data movement when nodes are added or removed."}]]}]]}],["$","li",null,{"children":["Solution: Consistent hashing",["$","ul",null,{"children":[["$","li",null,{"children":"Automatic scaling: servers could be added and removed automatically depending on the load."}],["$","li",null,{"children":"Heterogeneity: the number of virtual nodes for a server is proportional to the server capacity."}]]}]]}]]}],["$","h5",null,{"className":"content-header","id":"component-2-data-replication","children":[["$","a",null,{"className":"break-words","href":"#component-2-data-replication","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Component 2: Data replication"]}],["$","ul",null,{"children":[["$","li",null,{"children":"To achieve high availability and reliability, data must be replicated asynchronously over N servers, where N is a configurable parameter."}],["$","li",null,{"children":"These N servers are chosen using the following logic: after a key is mapped to a position on the hash ring, walk clockwise from that position and choose the first N servers on the ring to store data copies."}],["$","li",null,{"children":"With virtual nodes, the first N nodes on the ring may be owned by fewer than N physical servers. To avoid this issue, we only choose unique servers while performing the clockwise walk logic."}]]}],["$","h5",null,{"className":"content-header","id":"component-3-consistency","children":[["$","a",null,{"className":"break-words","href":"#component-3-consistency","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Component 3: Consistency"]}],["$","ul",null,{"children":[["$","li",null,{"children":"N = The number of replicas"}],["$","li",null,{"children":"W = A write quorum of size W. When a client performs a write operation, it is sent to at least W nodes. The operation is considered successful only when at least W nodes confirm the write."}],["$","li",null,{"children":"R = A read quorum of size R. When a client reads data, it queries at least R nodes. The read operation is successful only if at least R nodes return the same version of the data."}]]}],["$","h6",null,{"className":"content-header","id":"question-how-to-configure-n-w-and-r-to-fit-our-use-cases-here-are-some-of-the-possible-setups","children":[["$","a",null,{"className":"break-words","href":"#question-how-to-configure-n-w-and-r-to-fit-our-use-cases-here-are-some-of-the-possible-setups","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Question: How to configure N, W, and R to fit our use cases? Here are some of the possible setups:"]}],["$","ul",null,{"children":[["$","li",null,{"children":["If R = 1 and W = N, the system is optimized for a fast read.",["$","ul",null,{"children":[["$","li",null,{"children":"Usage Example: Financial Transaction Processing"}],["$","li",null,{"children":"The system needs to ensure that the write operation is strongly consistent across multiple nodes to avoid issues like double spending or incorrect balances."}],["$","li",null,{"children":"TODO: Future Investigation"}]]}]]}],["$","li",null,{"children":["If W = 1 and R = N, the system is optimized for fast write.",["$","ul",null,{"children":[["$","li",null,{"children":"Usage Example: Content Delivery Network (CDN) for Static Content"}],["$","li",null,{"children":"The system can afford to have a lower W since updates are less frequent, but R needs to be high to ensure users get the most up-to-date content."}],["$","li",null,{"children":"TODO: Future Investigation"}]]}]]}],["$","li",null,{"children":"If W = N/2 + 1 and R = N/2 + 1, see Paxos and Raft."}],["$","li",null,{"children":["If W + R ",">"," N, strong consistency is guaranteed."]}],["$","li",null,{"children":["If W + R ","<="," N, strong consistency is not guaranteed."]}]]}],["$","h6",null,{"className":"content-header","id":"consistency-models","children":[["$","a",null,{"className":"break-words","href":"#consistency-models","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Consistency models"]}],["$","ul",null,{"children":[["$","li",null,{"children":"Strong consistency: any read operation returns a value corresponding to the result of the most updated write data item. A client never sees out-of-date data."}],["$","li",null,{"children":"Weak consistency: subsequent read operations may not see the most updated value."}],["$","li",null,{"children":"Eventual consistency: this is a specific form of weak consistency. Given enough time, all updates are propagated, and all replicas are consistent."}]]}],["$","h4",null,{"className":"content-header","id":"component-4-inconsistency-resolution-versioning","children":[["$","a",null,{"className":"break-words","href":"#component-4-inconsistency-resolution-versioning","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Component 4: Inconsistency resolution: Versioning"]}],["$","ul",null,{"children":[["$","li",null,{"children":["vector clock: a [server, version] pair associated with a data item",["$","ul",null,{"children":[["$","li",null,{"children":"Using vector clocks, it is easy to tell that a version X is an ancestor (i.e. no conflict) of version Y if the version counters for each participant in the vector clock of Y is greater than or equal to the ones in version X. For example, the vector clock D([s0, 1], [s1, 1])] is an ancestor of D([s0, 1], [s1, 2]). Therefore, no conflict is recorded."}],["$","li",null,{"children":"You can tell that a version X is a sibling (i.e., a conflict exists) of Y if there is any participant in Y's vector clock who has a counter that is less than its corresponding counter in X. For example, the following two vector clocks indicate there is a conflict: D([s0, 1], [s1, 2]) and D([s0, 2], [s1, 1])."}]]}]]}],["$","li",null,{"children":["Downsides:",["$","ul",null,{"children":[["$","li",null,{"children":"First, vector clocks add complexity to the client because it needs to implement conflict resolution logic."}],["$","li",null,{"children":"Second, the [server: version] pairs in the vector clock could grow rapidly. However, based on Dynamo paper, Amazon has not yet encountered this problem in production;"}]]}]]}]]}],["$","h4",null,{"className":"content-header","id":"component-5-failures","children":[["$","a",null,{"className":"break-words","href":"#component-5-failures","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Component 5: Failures"]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":"Failure detection"}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"all-to-all multicasting: Inefficient"}]}],["$","li",null,{"children":[["$","p",null,{"children":"decentralized failure detection methods: Gossip Protocol"}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"Each node keeps a list of other nodes with a heartbeat counter, which it increases periodically to show it's active."}]}],["$","li",null,{"children":["$","p",null,{"children":"Nodes randomly share their heartbeat info with a few other nodes, which then pass it on, spreading the information throughout the network."}]}],["$","li",null,{"children":["$","p",null,{"children":"When a node notices that another node's heartbeat hasn't increased for a while, it assumes that node is offline."}]}]]}],["$","h6",null,{"className":"content-header","id":"question-how-is-the-node-list-of-each-node-determined","children":[["$","a",null,{"className":"break-words","href":"#question-how-is-the-node-list-of-each-node-determined","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Question: How is the node list of each node determined?"]}],["$","h6",null,{"className":"content-header","id":"answer-in-the-gossip-protocol-the-list-of-nodes-that-each-node-communicates-with-is-typically-determined-randomly-not-manually","children":[["$","a",null,{"className":"break-words","href":"#answer-in-the-gossip-protocol-the-list-of-nodes-that-each-node-communicates-with-is-typically-determined-randomly-not-manually","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Answer: In the gossip protocol, the list of nodes that each node communicates with is typically determined randomly, not manually."]}],["$","h6",null,{"className":"content-header","id":"each-node-in-the-system-maintains-a-membership-list-of-all-other-nodes-and-when-it-needs-to-send-a-heartbeat-or-other-information-it-randomly-selects-a-small-subset-of-nodes-from-this-list-to-communicate-with-this-selection-process-is-dynamic-and-happens-automatically-at-each-communication-interval","children":[["$","a",null,{"className":"break-words","href":"#each-node-in-the-system-maintains-a-membership-list-of-all-other-nodes-and-when-it-needs-to-send-a-heartbeat-or-other-information-it-randomly-selects-a-small-subset-of-nodes-from-this-list-to-communicate-with-this-selection-process-is-dynamic-and-happens-automatically-at-each-communication-interval","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Each node in the system maintains a membership list of all other nodes, and when it needs to send a heartbeat or other information, it randomly selects a small subset of nodes from this list to communicate with. This selection process is dynamic and happens automatically at each communication interval."]}],["$","h6",null,{"className":"content-header","id":"question-is-there-any-chance-that-a-healthy-node-is-treated-as-unhealthy-by-mistake","children":[["$","a",null,{"className":"break-words","href":"#question-is-there-any-chance-that-a-healthy-node-is-treated-as-unhealthy-by-mistake","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Question: Is there any chance that a healthy node is treated as unhealthy by mistake?"]}],["$","h6",null,{"className":"content-header","id":"yes-there-is-a-possibility-albeit-a-small-one-that-a-network-partition-or-random-selection-could-lead-to-a-situation-where-a-healthy-node-is-incorrectly-marked-as-unhealthy-in-the-gossip-protocol","children":[["$","a",null,{"className":"break-words","href":"#yes-there-is-a-possibility-albeit-a-small-one-that-a-network-partition-or-random-selection-could-lead-to-a-situation-where-a-healthy-node-is-incorrectly-marked-as-unhealthy-in-the-gossip-protocol","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Yes, there is a possibility, albeit a small one, that a network partition or random selection could lead to a situation where a healthy node is incorrectly marked as unhealthy in the gossip protocol."]}]]}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Handling temporary failures: Sloppy Quorum and Hinted Handoff(The Quorum number is not changed, still W and R)"}],["$","p",null,{"children":"When some nodes are unreachable due to failures or network issues, sloppy quorum steps in to ensure operations can still proceed:"}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"Write Operations: If the required nodes for a write quorum are unavailable, the system temporarily writes the data to any available nodes, even if they are not part of the original set responsible for the data. These nodes are often referred to as “hinted” nodes."}]}],["$","li",null,{"children":["$","p",null,{"children":"Read Operations: Similarly, read operations can be satisfied by querying any subset of nodes that hold the relevant data, ensuring that the operation completes even if not all original nodes are reachable."}]}],["$","li",null,{"children":["$","p",null,{"children":"The data is stored on available nodes, and a “hint” is recorded. This hint indicates that the data should be transferred to the original responsible nodes once they become available again."}]}],["$","li",null,{"children":["$","p",null,{"children":"These hinted writes ensure that the data is not lost and will eventually reach its intended location."}]}],["$","li",null,{"children":["$","p",null,{"children":"Higher Availability: By allowing operations to proceed with any available nodes, sloppy quorum significantly improves the system’s availability during partial failures."}]}],["$","li",null,{"children":["$","p",null,{"children":"Temporary Inconsistency: The system may temporarily have inconsistencies since not all nodes are updated immediately. However, it ensures that these inconsistencies are resolved over time, maintaining eventual consistency."}]}],["$","li",null,{"children":["$","p",null,{"children":"Potential for Data Loss: If hinted nodes fail before the data can be transferred to the original nodes, there is a risk of data loss unless additional measures (e.g., replication of hints) are taken."}]}]]}],["$","p",null,{"children":[["$","strong",null,{"children":"Reference"}],": ",["$","a",null,{"className":"break-words","target":"_blank","rel":"noopener noreferrer","href":"https://www.geeksforgeeks.org/what-is-sloppy-quorum-and-hinted-handoff/","children":"https://www.geeksforgeeks.org/what-is-sloppy-quorum-and-hinted-handoff/"}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Handling permanent failures: Anti-Entropy Protocols"}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":"Merkle tree: Inconsistency Detection"}],["$","ul",null,{"children":[["$","li",null,{"children":"Tree-Like Structure: A Merkle tree is a binary tree, where each leaf node represents a hash of a block of data, and each non-leaf (or internal) node is a hash of its child nodes."}],["$","li",null,{"children":["Leaves",["$","code",null,{"children":"(Hash(data))"}],": The leaf nodes contain the hash values of the actual data blocks."]}],["$","li",null,{"children":["Non-Leaf Nodes",["$","code",null,{"children":"(Hash(Hash(Child1) + Hash(Child2)))"}],": The internal nodes are created by taking the hash of the concatenation of their child nodes' hash values. This process continues up the tree until you reach the root node."]}],["$","li",null,{"children":"It's widely used in systems where data integrity is critical, to ensure that data hasn't been tampered with or to identify which part has been modified."}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"TODO: So what's the solution to handle permanent failures? (NOT MENTIONED IN THE BOOK)"}],["$","ul",null,{"children":[["$","li",null,{"children":"Detection of Failure"}],["$","li",null,{"children":"Node Replacement"}],["$","li",null,{"children":"Data Rebalancing"}],["$","li",null,{"children":"Data Replication"}],["$","li",null,{"children":"Consensus Protocols: In some cases, consensus protocols like Raft or Paxos may be used to coordinate the recovery process, ensuring that the system agrees on the state of the data after recovery."}]]}]]}]]}]]}]]}],["$","h4",null,{"className":"content-header","id":"component-6-system-architecture-diagram","children":[["$","a",null,{"className":"break-words","href":"#component-6-system-architecture-diagram","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Component 6: System architecture diagram"]}],["$","p",null,{"children":["$","img",null,{"alt":"distributed-kvstore","src":"/assets/distributed-kvstore.png"}]}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"Clients communicate with the key-value store through simple APIs: get(key) and put(key, value)."}]}],["$","li",null,{"children":["$","p",null,{"children":"A coordinator is a node that acts as a proxy between the client and the key-value store."}]}],["$","li",null,{"children":["$","p",null,{"children":"Nodes are distributed on a ring using consistent hashing."}]}],["$","li",null,{"children":["$","p",null,{"children":"The system is completely decentralized so adding and moving nodes can be automatic."}]}],["$","li",null,{"children":["$","p",null,{"children":"Data is replicated at multiple nodes."}]}],["$","li",null,{"children":["$","p",null,{"children":"There is no single point of failure as every node has the same set of responsibilities."}]}]]}],["$","h4",null,{"className":"content-header","id":"component-7-write-path","children":[["$","a",null,{"className":"break-words","href":"#component-7-write-path","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Component 7: Write path"]}],["$","p",null,{"children":["$","img",null,{"alt":"distributed-kvstore-write-path","src":"/assets/distributed-kvstore-write-path.png"}]}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"The write request is persisted on a commit log file."}]}],["$","li",null,{"children":["$","p",null,{"children":"Data is saved in the memory cache."}]}],["$","li",null,{"children":["$","p",null,{"children":"When the memory cache is full or reaches a predefined threshold, data is flushed to SSTable on disk."}]}]]}],["$","p",null,{"children":"TODO: What is a SSTable?"}],["$","h4",null,{"className":"content-header","id":"component-8-read-path","children":[["$","a",null,{"className":"break-words","href":"#component-8-read-path","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Component 8: Read path"]}],["$","p",null,{"children":["$","img",null,{"alt":"distributed-kvstore-read-path","src":"/assets/distributed-kvstore-read-path.png"}]}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"The system first checks if data is in memory. If not, go to step 2."}]}],["$","li",null,{"children":["$","p",null,{"children":"If data is not in memory, the system checks the bloom filter. 3. The bloom filter is used to figure out which SSTables might contain the key."}]}],["$","li",null,{"children":["$","p",null,{"children":"SSTables return the result of the data set."}]}],["$","li",null,{"children":["$","p",null,{"children":"The result of the data set is returned to the client."}]}]]}],["$","h5",null,{"className":"content-header","id":"reference","children":[["$","a",null,{"className":"break-words","href":"#reference","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Reference:"]}],["$","ol",null,{"children":[["$","li",null,{"children":["Cassandra Architecture: ",["$","a",null,{"className":"break-words","target":"_blank","rel":"noopener noreferrer","href":"https://cassandra.apache.org/doc/stable/cassandra/architecture/","children":"https://cassandra.apache.org/doc/stable/cassandra/architecture/"}]]}],["$","li",null,{"children":["SStable: ",["$","a",null,{"className":"break-words","target":"_blank","rel":"noopener noreferrer","href":"https://www.igvita.com/2012/02/06/sstable-and-log-structured-storage-leveldb/","children":"https://www.igvita.com/2012/02/06/sstable-and-log-structured-storage-leveldb/"}]]}]]}],["$","h2",null,{"className":"content-header","id":"chapter-7-design-a-unique-id-generator-in-distributed-systems","children":[["$","a",null,{"className":"break-words","href":"#chapter-7-design-a-unique-id-generator-in-distributed-systems","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"CHAPTER 7: DESIGN A UNIQUE ID GENERATOR IN DISTRIBUTED SYSTEMS"]}],["$","h5",null,{"className":"content-header","id":"requirements","children":[["$","a",null,{"className":"break-words","href":"#requirements","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Requirements:"]}],["$","ul",null,{"children":[["$","li",null,{"children":"IDs must be unique."}],["$","li",null,{"children":"IDs are numerical values only."}],["$","li",null,{"children":"IDs fit into 64-bit."}],["$","li",null,{"children":"IDs are ordered by date."}],["$","li",null,{"children":"Ability to generate over 10,000 unique IDs per second."}]]}],["$","h5",null,{"className":"content-header","id":"possible-solutions","children":[["$","a",null,{"className":"break-words","href":"#possible-solutions","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Possible Solutions:"]}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"Multi-master replication Instead of increasing the next ID by 1, we increase it by k, where k is the number of database servers in use."}]}],["$","li",null,{"children":["$","p",null,{"children":"UUID No coordination required but is 128 bits long and non-numeric."}]}],["$","li",null,{"children":["$","p",null,{"children":"Ticket Server Use a centralized auto increment feature in a single database/redis server (Ticket Server)"}]}],["$","li",null,{"children":[["$","p",null,{"children":"Twitter snowflake approach"}],["$","p",null,{"children":"Divide an ID into different sections:"}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"Sign bit: 1 bit. It will always be 0. This is reserved for future uses. It can potentially be used to distinguish between signed and unsigned numbers."}]}],["$","li",null,{"children":["$","p",null,{"children":"Timestamp: 41 bits. Milliseconds since the epoch or custom epoch."}]}],["$","li",null,{"children":["$","p",null,{"children":"Datacenter ID: 5 bits, which gives us 2 ^ 5 = 32 datacenters."}]}],["$","li",null,{"children":["$","p",null,{"children":"Machine ID: 5 bits, which gives us 2 ^ 5 = 32 machines per datacenter."}]}],["$","li",null,{"children":["$","p",null,{"children":"Sequence number: 12 bits. For every ID generated on that machine/process, the sequence number is incremented by 1. The number is reset to 0 every millisecond."}]}]]}]]}],["$","li",null,{"children":["$","p",null,{"children":"Custom Algorithm with Distributed Coordination Systems(Zookeeper, etcd, etc)"}]}]]}],["$","h5",null,{"className":"content-header","id":"more-discussion","children":[["$","a",null,{"className":"break-words","href":"#more-discussion","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"More Discussion:"]}],["$","ul",null,{"children":[["$","li",null,{"children":"Clock synchronization Network Time Protocol is the most popular solution to this problem"}],["$","li",null,{"children":"TODO: All the solution listed in the books are silly and not that useful, if you have more time think of something can be used in the real world."}]]}],["$","h2",null,{"className":"content-header","id":"chapter-8-design-a-url-shortener","children":[["$","a",null,{"className":"break-words","href":"#chapter-8-design-a-url-shortener","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"CHAPTER 8: DESIGN A URL SHORTENER"]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"301 redirect"}],". A 301 redirect shows that the requested URL is “permanently” moved to the long URL. Since it is permanently redirected, the browser caches the response, and subsequent requests for the same URL will not be sent to the URL shortening service. Instead, requests are redirected to the long URL server directly."]}],["$","ul",null,{"children":["$","li",null,{"children":"Reduce the server load"}]}]]}],["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"302 redirect"}],". A 302 redirect means that the URL is “temporarily” moved to the long URL, meaning that subsequent requests for the same URL will be sent to the URL shortening service first. Then, they are redirected to the long URL server."]}],["$","ul",null,{"children":["$","li",null,{"children":"Good for analytics"}]}]]}]]}],["$","h5",null,{"className":"content-header","id":"requirements-1","children":[["$","a",null,{"className":"break-words","href":"#requirements-1","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Requirements:"]}],["$","ul",null,{"children":[["$","li",null,{"children":"Write operation: 100 million URLs are generated per day."}],["$","li",null,{"children":"Write operation per second: 100 million / 24 /3600 = 1160"}],["$","li",null,{"children":"Read operation: Assuming ratio of read operation to write operation is 10:1, read operation per second: 1160 * 10 = 11,600"}],["$","li",null,{"children":"Assuming the URL shortener service will run for 10 years, this means we must support 100 million * 365 * 10 = 365 billion records."}],["$","li",null,{"children":"Assume average URL length is 100."}],["$","li",null,{"children":"Storage requirement over 10 years: 365 billion * 100 bytes * 10 years = 365 TB"}]]}],["$","h5",null,{"className":"content-header","id":"hash-function","children":[["$","a",null,{"className":"break-words","href":"#hash-function","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Hash function:"]}],["$","p",null,{"children":"The hashValue consists of characters from [0-9, a-z, A-Z], containing 10 + 26 + 26 = 62 possible characters. To figure out the length of hashValue, find the smallest n such that 62^n ≥ 365 billion."}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":"Hash Function 1: hash + collision resolution"}],["$","ul",null,{"children":[["$","li",null,{"children":"A straightforward solution is to use well-known hash functions like CRC32, MD5, or SHA-1."}],["$","li",null,{"children":"Even the shortest hash value (from CRC32) is too long (more than 7 characters). How can we make it shorter?"}],["$","li",null,{"children":"The first approach is to collect the first 7 characters of a hash value; however, this method can lead to hash collisions."}],["$","li",null,{"children":"To resolve hash collisions, we can recursively append a new predefined string until no more collision is discovered"}],["$","li",null,{"children":"Can use bloom filter + Redis to accelarate DB searching"}]]}],["$","p",null,{"children":["$","img",null,{"alt":"url-shortener-hash-1","src":"/assets/url-shortener-hash-1.png"}]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Hash Function 2: base 62 conversion"}],["$","ul",null,{"children":[["$","li",null,{"children":"Use a unique incremental ID generator"}],["$","li",null,{"children":"Convert the decimal int to base 62"}],["$","li",null,{"children":"People can guess the URL path, so it has potential security issues"}]]}]]}]]}],["$","h2",null,{"className":"content-header","id":"chapter-9-design-a-web-crawler","children":[["$","a",null,{"className":"break-words","href":"#chapter-9-design-a-web-crawler","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"CHAPTER 9: DESIGN A WEB CRAWLER"]}],["$","p",null,{"children":"A crawler is used for many purposes:"}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":[["$","strong",null,{"children":"Search engine indexing"}],": This is the most common use case. A crawler collects web pages to create a local index for search engines. For example, Googlebot is the web crawler behind the Google search engine."]}]}],["$","li",null,{"children":["$","p",null,{"children":[["$","strong",null,{"children":"Web archiving"}],": This is the process of collecting information from the web to preserve data for future uses. For instance, many national libraries run crawlers to archive web sites. Notable examples are the US Library of Congress and the EU web archive."]}]}],["$","li",null,{"children":["$","p",null,{"children":[["$","strong",null,{"children":"Web mining:"}]," The explosive growth of the web presents an unprecedented opportunity for data mining. Web mining helps to discover useful knowledge from the internet. For example, top financial firms use crawlers to download shareholder meetings and annual reports to learn key company initiatives."]}]}],["$","li",null,{"children":["$","p",null,{"children":[["$","strong",null,{"children":"Web monitoring"}],": The crawlers help to monitor copyright and trademark infringements over the Internet. For example, Digimarc utilizes crawlers to discover pirated works and reports."]}]}]]}],["$","h4",null,{"className":"content-header","id":"the-basic-algorithm-of-a-web-crawler-is-simple","children":[["$","a",null,{"className":"break-words","href":"#the-basic-algorithm-of-a-web-crawler-is-simple","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"The basic algorithm of a web crawler is simple"]}],["$","ol",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"Given a set of URLs, download all the web pages addressed by the URLs."}]}],["$","li",null,{"children":["$","p",null,{"children":"Extract URLs from these web pages"}]}],["$","li",null,{"children":["$","p",null,{"children":"Add new URLs to the list of URLs to be downloaded. Repeat these 3 steps."}]}]]}],["$","h4",null,{"className":"content-header","id":"ask-questions","children":[["$","a",null,{"className":"break-words","href":"#ask-questions","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Ask Questions:"]}],["$","ol",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":"What is the main purpose of the crawler? Is it used for search engine indexing, data mining, or something else?"}],["$","p",null,{"children":"Requirement: Search engine indexing."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"How many web pages does the web crawler collect per month?"}],["$","p",null,{"children":"Requirement: 1 billion pages."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"What content types are included? HTML only or other content types such as PDFs and images as well?"}],["$","p",null,{"children":"Requirement: HTML only."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Shall we consider newly added or edited web pages?"}],["$","p",null,{"children":"Requirement: Yes, we should consider the newly added or edited web pages."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Do we need to store HTML pages crawled from the web?"}],["$","p",null,{"children":"Requirement: Yes, up to 5 years"}]]}],["$","li",null,{"children":[["$","p",null,{"children":"How do we handle web pages with duplicate content?"}],["$","p",null,{"children":"Requirement: Pages with duplicate content should be ignored."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Characteristics of the system:"}],["$","ul",null,{"children":[["$","li",null,{"children":"Scalability: Web crawling should be extremely efficient using parallelization."}],["$","li",null,{"children":"Robustness: Bad HTML, unresponsive servers, crashes, malicious links. The crawler must handle all those edge cases."}],["$","li",null,{"children":"Politeness: The crawler should not make too many requests to a website within a short time interval."}],["$","li",null,{"children":"Extensibility: The system is flexible so that minimal changes are needed to support new content types. For example, if we want to crawl image files in the future, we should not need to redesign the entire system."}]]}]]}]]}],["$","h4",null,{"className":"content-header","id":"scale-estimation","children":[["$","a",null,{"className":"break-words","href":"#scale-estimation","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Scale Estimation"]}],["$","ul",null,{"children":[["$","li",null,{"children":"QPS: 1,000,000,000 / 30 days / 24 hours / 3600 seconds = ~400 pages per second."}],["$","li",null,{"children":"Assume the average web page size is 2000k."}],["$","li",null,{"children":"1-billion-page x 2000k = 2 PB storage per month."}],["$","li",null,{"children":"Assuming data are stored for five years, 2 PB * 12 months * 5 years = 120 PB. A 120 PB storage is needed to store five-year content."}]]}],["$","h4",null,{"className":"content-header","id":"initial-design","children":[["$","a",null,{"className":"break-words","href":"#initial-design","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Initial Design"]}],["$","p",null,{"children":["$","img",null,{"alt":"crawler-initial-design","src":"/assets/crawler-initial-design.png"}]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":"Seed URLs"}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"A web crawler uses seed URLs as a starting point for the crawl process."}]}],["$","li",null,{"children":["$","p",null,{"children":"To crawl the entire web, we need to be creative in selecting seed URLs. A good seed URL serves as a good starting point that a crawler can utilize to traverse as many links as possible."}]}],["$","li",null,{"children":["$","p",null,{"children":"The general strategy is to divide the entire URL space into smaller ones. The first proposed approach is based on locality as different countries may have different popular websites. Another way is to choose seed URLs based on topics."}]}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"URL Frontier"}],["$","p",null,{"children":"Most modern web crawlers split the crawl state into two: to be downloaded and already downloaded. The component that stores URLs to be downloaded is called the URL Frontier. You can refer to this as a First-in-First-out (FIFO) queue."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"HTML Downloader"}],["$","p",null,{"children":"The HTML downloader downloads web pages from the internet. Those URLs are provided by the URL Frontier."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"DNS Resolver(But we don't need to design this right)"}],["$","p",null,{"children":"To download a web page, a URL must be translated into an IP address. The HTML Downloader calls the DNS Resolver to get the corresponding IP address for the URL."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Content Parser"}],["$","p",null,{"children":"After a web page is downloaded, it must be parsed and validated because malformed web pages could provoke problems and waste storage space. Implementing a content parser in a crawl server will slow down the crawling process. Thus, the content parser is a separate component."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Content Duplicate Checker"}],["$","p",null,{"children":"An efficient way to accomplish this task is to compare the hash values of the two web pages."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Content Storage"}],["$","p",null,{"children":"It is a storage system for storing HTML content."}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"Most of the content is stored on disk because the data set is too big to fit in memory."}]}],["$","li",null,{"children":["$","p",null,{"children":"Popular content is kept in memory to reduce latency."}]}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"URL Extractor"}],["$","p",null,{"children":"URL Extractor parses and extracts links from HTML pages. Figure below shows an example of a link extraction process. Relative paths are converted to absolute URLs by adding a prefix."}],["$","p",null,{"children":["$","img",null,{"alt":"crawler-url-extractor","src":"/assets/crawler-url-extractor.png"}]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"URL Filter"}],["$","p",null,{"children":"The URL filter excludes certain content types, file extensions, error links and URLs in “blacklisted” sites."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"URL Duplicate Checker"}],["$","p",null,{"children":"It helps to avoid adding the same URL multiple times as this can increase server load and cause potential infinite loops."}],["$","p",null,{"children":"Bloom filter and hash table are common techniques to implement the Deplicate Checker component."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"URL Storage"}],["$","p",null,{"children":"URL Storage stores already visited URLs."}]]}]]}],["$","h4",null,{"className":"content-header","id":"web-crawler-workflow","children":[["$","a",null,{"className":"break-words","href":"#web-crawler-workflow","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Web crawler workflow"]}],["$","p",null,{"children":["$","img",null,{"alt":"crawler-workflow","src":"/assets/crawler-workflow.png"}]}],["$","h4",null,{"className":"content-header","id":"design-deep-dive","children":[["$","a",null,{"className":"break-words","href":"#design-deep-dive","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Design deep dive"]}],["$","h5",null,{"className":"content-header","id":"dfs-vs-bfs","children":[["$","a",null,{"className":"break-words","href":"#dfs-vs-bfs","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"DFS vs BFS"]}],["$","p",null,{"children":"You can think of the web as a directed graph where web pages serve as nodes and hyperlinks (URLs) as edges. The crawl process can be seen as traversing a directed graph from one web page to others. Two common graph traversal algorithms are DFS and BFS. However, DFS is usually not a good choice because the depth of DFS can be very deep."}],["$","p",null,{"children":"BFS is commonly used by web crawlers and is implemented by a first-in-first-out (FIFO) queue. In a FIFO queue, URLs are dequeued in the order they are enqueued. However, this implementation has two problems:"}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"Impoliteness: Most links from the same web page are linked back to the same host. When the crawler tries to download web pages in parallel, servers will be flooded with requests. This is considered as “impolite”."}]}],["$","li",null,{"children":["$","p",null,{"children":"Standard BFS does not take the priority of a URL into consideration. The web is large and not every page has the same level of quality and importance. Therefore, we may want to prioritize URLs according to their page ranks, web traffic, update frequency, etc."}]}]]}],["$","h5",null,{"className":"content-header","id":"url-frontier","children":[["$","a",null,{"className":"break-words","href":"#url-frontier","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"URL frontier"]}],["$","p",null,{"children":"URL frontier helps to address these problems. A URL frontier is a data structure that stores URLs to be downloaded. The URL frontier is an important component to ensure politeness, URL prioritization, and freshness."}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":"Politeness"}],["$","p",null,{"children":"The general idea of enforcing politeness is to download one page at a time from the same host. A delay can be added between two download tasks. The politeness constraint is implemented by maintain a mapping from website hostnames to download (worker) threads."}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":["In the book, author introduces a method which requires a ",["$","code",null,{"children":"separate queue containing URLs from a single host"}]," for each hostname. It also requires ",["$","code",null,{"children":"One Worker per Queue"}],". But I think this method is inefficient with resources."]}]}],["$","li",null,{"children":[["$","p",null,{"children":"Possible Improvements:"}],["$","ul",null,{"children":[["$","li",null,{"children":"Worker Pool"}],["$","li",null,{"children":"Custom DelayedQueue"}]]}]]}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Priority"}],["$","p",null,{"children":"Prioritize URLs based on usefulness, which can be measured by PageRank, website traffic, update frequency, etc. “Prioritizer” is the component that handles URL prioritization."}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"Prioritizer: It takes URLs as input and computes the priorities."}]}],["$","li",null,{"children":["$","p",null,{"children":"Queue f1 to fn: Each queue has an assigned priority. Queues with high priority are selected with higher probability."}]}],["$","li",null,{"children":["$","p",null,{"children":"Queue selector: Randomly choose a queue with a bias towards queues with higher priority."}]}]]}],["$","p",null,{"children":["$","img",null,{"alt":"crawler-two-queues","src":"/assets/crawler-two-queues.png"}]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Freshness"}],["$","ul",null,{"children":[["$","li",null,{"children":"Recrawl based on web pages’ update history."}],["$","li",null,{"children":"Prioritize URLs and recrawl important pages first and more frequently."}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Storage for URL Frontier"}],["$","ul",null,{"children":[["$","li",null,{"children":"The majority of URLs are stored on disk"}],["$","li",null,{"children":"Maintain buffers in memory for enqueue/dequeue operations. Data in the buffer is periodically written to the disk."}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":["Robots Exclusion Protocol The ",["$","code",null,{"children":"Robots Exclusion Protocol (REP)"}],", commonly referred to as the ",["$","code",null,{"children":"robots.txt"}]," file, is a standard used by websites to communicate with web crawlers and other automated agents about which parts of the site should or should not be accessed. It is a way for site owners to control how search engines and other web crawlers interact with their site."]}],["$","ul",null,{"children":[["$","li",null,{"children":["Disallow Directive: The ",["$","code",null,{"children":"Disallow"}]," directive specifies which parts of the site crawlers should not access."]}],["$","li",null,{"children":["Allow Directive: The ",["$","code",null,{"children":"Allow"}]," directive specifies parts of the site that crawlers are allowed to access."]}],["$","li",null,{"children":["Sitemap Directive: The ",["$","code",null,{"children":"robots.txt"}]," file can also include a link to the site's XML sitemap, which helps crawlers understand the structure of the site and locate the most important pages for indexing."]}],["$","li",null,{"children":["No Enforcement Mechanism: It’s important to note that the Robots Exclusion Protocol is purely advisory. Compliant crawlers (such as search engines like Google or Bing) follow the rules, but non-compliant crawlers, such as some malicious bots, can ignore the ",["$","code",null,{"children":"robots.txt"}]," file and crawl the site anyway."]}],["$","li",null,{"children":["No Indexing Control: The ",["$","code",null,{"children":"robots.txt"}]," file only controls crawling, not indexing. Pages that are disallowed in the ",["$","code",null,{"children":"robots.txt"}]," file may still be indexed if they are linked to from other sites."]}]]}],["$","$L10",null,{"className":"language-js","children":["$","code",null,{"className":"language-js code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token maybe-class-name","children":"User"}],["$","span",null,{"className":"token operator","children":"-"}],"agent",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token operator","children":"*"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token property literal-property","children":"Disallow"}],["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token regex","children":[["$","span",null,{"className":"token regex-delimiter","children":"/"}],["$","span",null,{"className":"token language-regex regex-source","children":"private"}],["$","span",null,{"className":"token regex-delimiter","children":"/"}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token property literal-property","children":"Allow"}],["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token regex","children":[["$","span",null,{"className":"token regex-delimiter","children":"/"}],["$","span",null,{"className":"token language-regex regex-source","children":"public"}],["$","span",null,{"className":"token regex-delimiter","children":"/"}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token property literal-property","children":"Sitemap"}],["$","span",null,{"className":"token operator","children":":"}]," https",["$","span",null,{"className":"token operator","children":":"}],["$","span",null,{"className":"token operator","children":"/"}],["$","span",null,{"className":"token operator","children":"/"}],"www",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"example"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"com"}],["$","span",null,{"className":"token operator","children":"/"}],"sitemap",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"xml"}],"\n"]}]]}]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Performance optimization"}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"Distributed crawl"}]}],["$","li",null,{"children":[["$","p",null,{"children":"Cache DNS Resolver"}],["$","p",null,{"children":"DNS Resolver is a bottleneck for crawlers because DNS requests might take time due to the synchronous nature of many DNS interfaces. DNS response time ranges from 10ms to 200ms. Once a request to DNS is carried out by a crawler thread, other threads are blocked until the first request is completed. Our DNS cache keeps the domain name to IP address mapping and is updated periodically by cron jobs."}],["$","h6",null,{"className":"content-header","id":"why-are-dns-requests-synchronous","children":[["$","a",null,{"className":"break-words","href":"#why-are-dns-requests-synchronous","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Why Are DNS Requests Synchronous?"]}],["$","blockquote",null,{"children":[["$","p",null,{"children":"Historically, many DNS interfaces were implemented synchronously for simplicity. Early DNS libraries and network protocols often operated in a blocking, synchronous fashion because that was how many networking systems were designed. Some reasons include:"}],["$","ol",null,{"children":[["$","li",null,{"children":"Legacy Design: Synchronous operations are easier to implement, especially in systems where concurrency and non-blocking I/O were less emphasized."}],["$","li",null,{"children":"Blocking I/O: DNS resolution was typically done through blocking I/O calls, meaning the program would wait until the DNS response came back before moving forward."}],["$","li",null,{"children":"Single Request-Response Nature: DNS queries are usually simple request-response pairs, so they were often implemented as blocking calls, with the assumption that the response would be relatively fast."}]]}]]}],["$","h6",null,{"className":"content-header","id":"modern-asynchronous-dns-services","children":[["$","a",null,{"className":"break-words","href":"#modern-asynchronous-dns-services","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Modern Asynchronous DNS Services"]}],["$","blockquote",null,{"children":["$","ol",null,{"children":[["$","li",null,{"children":["Java: Uses the ",["$","code",null,{"children":"InetAddress"}]," class for synchronous DNS and libraries like DNSJava for more advanced queries. Asynchronous options include ",["$","code",null,{"children":"Netty DNS Resolver"}]," and ",["$","code",null,{"children":"Vert.x"}],"."]}],["$","li",null,{"children":["Python: Supports DNS resolution through the socket module for synchronous calls and libraries like ",["$","code",null,{"children":"dnspython"}]," for advanced queries. Asynchronous options include ",["$","code",null,{"children":"aiohttp"}]," and ",["$","code",null,{"children":"aiodns"}],"."]}],["$","li",null,{"children":["Go: Has the ",["$","code",null,{"children":"net"}]," package for synchronous DNS resolution and advanced libraries like ",["$","code",null,{"children":"miekg/dns"}],". Asynchronous DNS can be handled using goroutines."]}]]}]}]]}],["$","li",null,{"children":["$","p",null,{"children":"Locality"}]}],["$","li",null,{"children":["$","p",null,{"children":"Short timeout"}]}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Robustness"}],["$","p",null,{"children":"Besides performance optimization, robustness is also an important consideration. We present a few approaches to improve the system robustness:"}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"Consistent hashing: This helps to distribute loads among downloaders."}]}],["$","li",null,{"children":["$","p",null,{"children":"Save crawl states and data: To guard against failures, crawl states and data are written to a storage system. A disrupted crawl can be restarted easily by loading saved states and data."}]}],["$","li",null,{"children":["$","p",null,{"children":"Exception handling: Errors are inevitable and common in a large-scale system. The crawler must handle exceptions gracefully without crashing the system."}]}],["$","li",null,{"children":["$","p",null,{"children":"Data validation: This is an important measure to prevent system errors."}]}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Extensibility"}],["$","ul",null,{"children":[["$","li",null,{"children":"PNG Downloader module: it is plugged-in to download PNG files."}],["$","li",null,{"children":"Web Monitor module: prevent copyright and trademark infringements."}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Detect and avoid problematic content"}],["$","ul",null,{"children":[["$","li",null,{"children":"Redundant content"}],["$","li",null,{"children":["Spider traps",["$","blockquote",null,{"children":["$","p",null,{"children":["A spider trap is a web page that causes a crawler in an infinite loop. For instance, an infinite deep directory structure is listed as follows: ",["$","a",null,{"className":"break-words","target":"_blank","rel":"noopener noreferrer","href":"http://www.spidertrapexample.com/foo/bar/foo/bar/foo/bar/%E2%80%A6","children":"www.spidertrapexample.com/foo/bar/foo/bar/foo/bar/…"}]," Such spider traps can be avoided by setting a maximal length for URLs. However, no onesize-fits-all solution exists to detect spider traps. Websites containing spider traps are easy to identify due to an unusually large number of web pages discovered on such websites. It is hard to develop automatic algorithms to avoid spider traps; however, a user can manually verify and identify a spider trap, and either exclude those websites from the crawler or apply some customized URL filters."]}]}]]}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Expansion"}],["$","ul",null,{"children":["$","li",null,{"children":"Server-side rendering: Numerous websites use scripts like JavaScript, AJAX, etc to generate links on the fly. If we download and parse web pages directly, we will not be able to retrieve dynamically generated links. To solve this problem, we perform server-side rendering (also called dynamic rendering) first before parsing a page"}]}]]}]]}],["$","h2",null,{"className":"content-header","id":"chapter-10-design-a-notification-system","children":[["$","a",null,{"className":"break-words","href":"#chapter-10-design-a-notification-system","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"CHAPTER 10: DESIGN A NOTIFICATION SYSTEM"]}],["$","h4",null,{"className":"content-header","id":"ask-questions-first","children":[["$","a",null,{"className":"break-words","href":"#ask-questions-first","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Ask questions first:"]}],["$","p",null,{"children":"Ask questions first:"}],["$","ol",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":"Is it a real-time system?"}],["$","p",null,{"children":"Requirements: It is a soft real-time system. We want a user to receive notifications as soon as possible. However, if the system is under a high workload, a slight delay is acceptable."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"What triggers notifications?"}],["$","p",null,{"children":"Requirements: Notifications can be triggered by client applications. They can also be scheduled on the server-side."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Will users be able to opt-out?"}],["$","p",null,{"children":"Requirements: Yes, users who choose to opt-out will no longer receive notifications."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"How many notifications are sent out each day?"}],["$","p",null,{"children":"Requirements: 10 million mobile push notifications, 1 million SMS messages, and 5 million emails."}]]}]]}],["$","h4",null,{"className":"content-header","id":"high-level-design","children":[["$","a",null,{"className":"break-words","href":"#high-level-design","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"High-level design"]}],["$","p",null,{"children":"It is structured as follows:"}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"Different types of notifications"}]}],["$","li",null,{"children":["$","p",null,{"children":"Contact info gathering flow"}]}],["$","li",null,{"children":["$","p",null,{"children":"Notification sending/receiving flow"}]}]]}],["$","h5",null,{"className":"content-header","id":"different-types-of-notifications","children":[["$","a",null,{"className":"break-words","href":"#different-types-of-notifications","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Different types of notifications"]}],["$","ol",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":"iOS push notification"}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":"Provider A provider builds and sends notification requests to Apple Push Notification Service (APNS). To construct a push notification, the provider provides the following data:"}],["$","ul",null,{"children":[["$","li",null,{"children":"Device token: This is a unique identifier used for sending push notifications."}],["$","li",null,{"children":"Payload: This is a JSON dictionary that contains a notification’s payload."}]]}],["$","$L10",null,{"className":"language-js","children":["$","code",null,{"className":"language-js code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token property string-property","children":"\"aps\""}],["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token property string-property","children":"\"alert\""}],["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["            ",["$","span",null,{"className":"token property string-property","children":"\"title\""}],["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"Game Request\""}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["            ",["$","span",null,{"className":"token property string-property","children":"\"body\""}],["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"Bob wants to play chess\""}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["            ",["$","span",null,{"className":"token property string-property","children":"\"action-loc-key\""}],["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"PLAY\""}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token property string-property","children":"\"badge\""}],["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token number","children":"5"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}]]}],["$","li",null,{"children":["$","p",null,{"children":"APNS: This is a remote service provided by Apple to propagate push notifications to iOS devices."}]}],["$","li",null,{"children":["$","p",null,{"children":"iOS Device: It is the end client, which receives push notifications."}]}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Android push notification"}],["$","p",null,{"children":"Instead of using APNs, Firebase Cloud Messaging (FCM) is commonly used to send push notifications to android devices."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"SMS message"}],["$","p",null,{"children":"For SMS messages, third party SMS services like Twilio [1], Nexmo [2], and many others are commonly used."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Email"}],["$","p",null,{"children":"Although companies can set up their own email servers, many of them opt for commercial email services. Sendgrid and Mailchimp are among the most popular email services, which offer a better delivery rate and data analytics."}]]}]]}],["$","h5",null,{"className":"content-header","id":"contact-info-gathering-flow","children":[["$","a",null,{"className":"break-words","href":"#contact-info-gathering-flow","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Contact info gathering flow"]}],["$","p",null,{"children":"To send notifications, we need to gather mobile device tokens, phone numbers, or email addresses. When a user installs our app or signs up for the first time, API servers collect user contact info and store it in the database."}],["$","h5",null,{"className":"content-header","id":"notification-sendingreceiving-flow","children":[["$","a",null,{"className":"break-words","href":"#notification-sendingreceiving-flow","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Notification sending/receiving flow"]}],["$","p",null,{"children":["$","img",null,{"alt":"notification-highlevel-design","src":"/assets/notification-highlevel-design.png"}]}],["$","ol",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":"Service 1 to N"}],["$","p",null,{"children":"They represent different services that send notifications via APIs provided by notification servers."}]]}],["$","li",null,{"children":["$","p",null,{"children":"Notification servers"}]}]]}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"Provide APIs for services to send notifications. Those APIs are only accessible internally or by verified clients to prevent spams."}]}],["$","li",null,{"children":["$","p",null,{"children":"Carry out basic validations to verify emails, phone numbers, etc."}]}],["$","li",null,{"children":["$","p",null,{"children":"Query the database or cache to fetch data needed to render a notification."}]}],["$","li",null,{"children":["$","p",null,{"children":"Put notification data to message queues for parallel processing."}]}]]}],["$","h4",null,{"className":"content-header","id":"deep-dive","children":[["$","a",null,{"className":"break-words","href":"#deep-dive","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Deep Dive"]}],["$","h5",null,{"className":"content-header","id":"reliability","children":[["$","a",null,{"className":"break-words","href":"#reliability","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Reliability"]}],["$","ol",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":"How to prevent data loss?"}],["$","p",null,{"children":"One of the most important requirements in a notification system is that it cannot lose data. Notifications can usually be delayed or re-ordered, but never lost. To satisfy this requirement, the notification system persists notification data in a database and implements a retry mechanism. The notification log database is included for data persistence"}],["$","p",null,{"children":["$","img",null,{"alt":"notification-reliability","src":"/assets/notification-reliability.png"}]}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Will recipients receive a notification exactly once?"}],["$","p",null,{"children":"The short answer is no. Although notification is delivered exactly once most of the time, the distributed nature could result in duplicate notifications. To reduce the duplication occurrence, we introduce a dedupe mechanism and handle each failure case carefully. Here is a simple dedupe logic:"}],["$","p",null,{"children":"When a notification event first arrives, we check if it is seen before by checking the event ID. If it is seen before, it is discarded. Otherwise, we will send out the notification."}],["$","p",null,{"children":["Reference: ",["$","a",null,{"className":"break-words","target":"_blank","rel":"noopener noreferrer","href":"https://bravenewgeek.com/you-cannot-have-exactly-once-delivery/","children":"https://bravenewgeek.com/you-cannot-have-exactly-once-delivery/"}]]}]]}]]}],["$","h5",null,{"className":"content-header","id":"additional-components-and-considerations","children":[["$","a",null,{"className":"break-words","href":"#additional-components-and-considerations","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Additional components and considerations"]}],["$","ol",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":"Notification setting"}],["$","p",null,{"children":"Many websites and apps give users fine-grained control over notification settings."}]]}],["$","li",null,{"children":["$","p",null,{"children":"Rate limiting"}]}],["$","li",null,{"children":[["$","p",null,{"children":"Retry mechanism"}],["$","p",null,{"children":"When a third-party service fails to send a notification, the notification will be added to the message queue for retrying. If the problem persists, an alert will be sent out to developers."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Security in push notifications"}],["$","p",null,{"children":"For iOS or Android apps, appKey and appSecret are used to secure push notification APIs. Only authenticated or verified clients are allowed to send push notifications using our APIs."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Monitor queued notifications"}],["$","p",null,{"children":"A key metric to monitor is the total number of queued notifications. If the number is large, the notification events are not processed fast enough by workers. To avoid delay in the notification delivery, more workers are needed."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Events tracking"}],["$","p",null,{"children":"TODO: How to trigger an event when a user view a notification but didn't do other operations?"}]]}]]}],["$","p",null,{"children":["$","img",null,{"alt":"notification-improved","src":"/assets/notification-improved.png"}]}],["$","h2",null,{"className":"content-header","id":"chapter-11-design-a-news-feed-system","children":[["$","a",null,{"className":"break-words","href":"#chapter-11-design-a-news-feed-system","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"CHAPTER 11: DESIGN A NEWS FEED SYSTEM"]}],["$","h3",null,{"className":"content-header","id":"ask-questions-first-1","children":[["$","a",null,{"className":"break-words","href":"#ask-questions-first-1","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Ask Questions First"]}],["$","ol",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":"Is this a mobile app? Or a web app? Or both?"}],["$","p",null,{"children":"Requirements: Both"}]]}],["$","li",null,{"children":[["$","p",null,{"children":"What are the important features?"}],["$","p",null,{"children":"Requirements: A user can publish a post and see her friends’ posts on the news feed page."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Is the news feed sorted by reverse chronological order or any particular order such as topic scores?"}],["$","p",null,{"children":"Requirements: To keep things simple, let us assume the feed is sorted by reverse chronological order."}]]}],["$","li",null,{"children":[["$","p",null,{"children":"How many friends can a user have?"}],["$","p",null,{"children":"Requirements: 5000"}]]}],["$","li",null,{"children":[["$","p",null,{"children":"What is the traffic volume?"}],["$","p",null,{"children":"Requirements: 10 million DAU"}]]}],["$","li",null,{"children":[["$","p",null,{"children":"Can feed contain images, videos, or just text?"}],["$","p",null,{"children":"Requriements: It can contain media files, including both images and videos."}]]}]]}],["$","h3",null,{"className":"content-header","id":"high-level-design-1","children":[["$","a",null,{"className":"break-words","href":"#high-level-design-1","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"High Level Design"]}],["$","p",null,{"children":"The design is divided into two flows: feed publishing and news feed building."}],["$","ul",null,{"children":[["$","li",null,{"children":"Feed publishing: when a user publishes a post, corresponding data is written into cache and database. A post is populated to her friends’ news feed."}],["$","li",null,{"children":"Newsfeed building: for simplicity, let us assume the news feed is built by aggregating friends’ posts in reverse chronological order."}]]}],["$","ol",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":"Newsfeed APIs"}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":["Feed publishing API To publish a post, a HTTP POST request will be sent to the server: ",["$","code",null,{"children":"POST /v1/me/feed"}]]}],["$","ul",null,{"children":[["$","li",null,{"children":"content: content is the text of the post."}],["$","li",null,{"children":"auth_token: used to authenticate API requests."}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":["Newsfeed retrieval API The API to retrieve news feed: ",["$","code",null,{"children":"GET /v1/me/feed"}]]}],["$","ul",null,{"children":["$","li",null,{"children":"auth_token: used to authenticate API requests."}]}]]}]]}]]}],["$","li",null,{"children":["$","p",null,{"children":"Feed publishing"}]}]]}],["$","p",null,{"children":["$","img",null,{"alt":"feed-system-highlevel-design","src":"/assets/feed-system-highlevel-design.png"}]}],["$","ul",null,{"children":[["$","li",null,{"children":"Post service: persist post in the database and cache."}],["$","li",null,{"children":"Fanout service: push new content to friends’ news feed. Newsfeed data is stored in the cache for fast retrieval."}],["$","li",null,{"children":"Notification service: inform friends that new content is available and send out push notifications."}]]}],["$","ol",null,{"start":"3","children":["$","li",null,{"children":["Newsfeed building ",["$","img",null,{"alt":"feed-system-newsfeed","src":"/assets/feed-system-newsfeed.png"}]]}]}],["$","ul",null,{"children":[["$","li",null,{"children":"Newsfeed service: news feed service fetches news feed from the cache."}],["$","li",null,{"children":"Newsfeed cache: store news feed IDs needed to render the news feed."}]]}],["$","h3",null,{"className":"content-header","id":"deep-dive-1","children":[["$","a",null,{"className":"break-words","href":"#deep-dive-1","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Deep Dive"]}],["$","p",null,{"children":["$","img",null,{"alt":"feed-system-deepdive","src":"/assets/feed-system-deepdive.png"}]}],["$","h4",null,{"className":"content-header","id":"feed-publishing","children":[["$","a",null,{"className":"break-words","href":"#feed-publishing","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Feed publishing"]}],["$","h5",null,{"className":"content-header","id":"fanout-service","children":[["$","a",null,{"className":"break-words","href":"#fanout-service","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Fanout service:"]}],["$","p",null,{"children":"Fanout is the process of delivering a post to all friends. Two types of fanout models are: fanout on write (also called push model) and fanout on read (also called pull model)."}],["$","p",null,{"children":[["$","strong",null,{"children":"Fanout on write"}],". With this approach, news feed is pre-computed during write time. A new post is delivered to friends’ cache immediately after it is published."]}],["$","p",null,{"children":"Pros:"}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"The news feed is generated in real-time and can be pushed to friends immediately."}]}],["$","li",null,{"children":["$","p",null,{"children":"Fetching news feed is fast because the news feed is pre-computed during write time."}]}]]}],["$","p",null,{"children":"Cons:"}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"If a user has many friends, fetching the friend list and generating news feeds for all of them are slow and time consuming. It is called hotkey problem."}]}],["$","li",null,{"children":["$","p",null,{"children":"For inactive users or those rarely log in, pre-computing news feeds waste computing resources."}]}]]}],["$","p",null,{"children":[["$","strong",null,{"children":"Fanout on read"}],". The news feed is generated during read time. This is an on-demand model. Recent posts are pulled when a user loads her home page."]}],["$","p",null,{"children":"Pros:"}],["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"For inactive users or those who rarely log in, fanout on read works better because it will not waste computing resources on them."}]}],["$","li",null,{"children":["$","p",null,{"children":"Data is not pushed to friends so there is no hotkey problem."}]}]]}],["$","p",null,{"children":"Cons:"}],["$","ul",null,{"children":["$","li",null,{"children":"Fetching the news feed is slow as the news feed is not pre-computed."}]}],["$","blockquote",null,{"children":[["$","h2",null,{"className":"content-header","id":"difference-between-a-notification-system-and-a-content-feeding-system","children":[["$","a",null,{"className":"break-words","href":"#difference-between-a-notification-system-and-a-content-feeding-system","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Difference between a notification system and a content feeding system"]}],["$","h3",null,{"className":"content-header","id":"1-primary-purpose","children":[["$","a",null,{"className":"break-words","href":"#1-primary-purpose","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"1. ",["$","strong",null,{"children":"Primary Purpose"}]]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"Notification System"}],":"]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Goal"}],": Alert users in real-time about events such as new posts, interactions (likes, comments, retweets), or updates."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Example"}],": Sending a push notification when a celebrity posts a new tweet, even if the user is not actively using the app."]}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"Content Feeding System"}],":"]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Goal"}],": Serve users with the actual content they want to see, such as posts from people they follow, organized in a timeline or feed."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Example"}],": Loading and displaying a user’s news feed when they open the app."]}]]}]]}]]}],["$","h3",null,{"className":"content-header","id":"2-mechanism","children":[["$","a",null,{"className":"break-words","href":"#2-mechanism","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"2. ",["$","strong",null,{"children":"Mechanism"}]]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"Notification System"}],":"]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Push-Based"}],": Notifications are sent from the server directly to the user's device as soon as an event happens, regardless of whether the app is running or not."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Real-Time"}],": Designed to deliver immediate alerts and updates, triggering device notifications (e.g., banner, sound) to get the user’s attention."]}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"Content Feeding System"}],":"]}],["$","ul",null,{"children":["$","li",null,{"children":[["$","strong",null,{"children":"Hybrid (Push/Pull) Model"}],":",["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Push Model (Fanout on Write)"}],": Pre-computes and stores content in the user’s feed at the time of the post, so it's ready when they open the app."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Pull Model (Fanout on Read)"}],": Retrieves content on demand when the user opens the app, fetching recent posts dynamically."]}]]}]]}]}]]}]]}],["$","h3",null,{"className":"content-header","id":"3-resource-usage","children":[["$","a",null,{"className":"break-words","href":"#3-resource-usage","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"3. ",["$","strong",null,{"children":"Resource Usage"}]]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"Notification System"}],":"]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Lightweight"}],": Only metadata about the event (e.g., \"User X posted a new tweet\") is sent, which consumes minimal resources and bandwidth."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Low Latency"}],": Focuses on real-time delivery with minimal delay to ensure users receive alerts promptly."]}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"Content Feeding System"}],":"]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Heavier"}],": Involves delivering large amounts of content (e.g., posts, images, videos), requiring more storage, bandwidth, and processing power, especially if it pre-computes and caches the content for users."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Latency Can Vary"}],": Latency depends on whether content is pushed and precomputed (fast retrieval) or pulled on demand (slower due to real-time fetching)."]}]]}]]}]]}],["$","h3",null,{"className":"content-header","id":"4-user-interaction","children":[["$","a",null,{"className":"break-words","href":"#4-user-interaction","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"4. ",["$","strong",null,{"children":"User Interaction"}]]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"Notification System"}],":"]}],["$","ul",null,{"children":["$","li",null,{"children":[["$","strong",null,{"children":"Passive Engagement"}],": Users are alerted to new content or interactions without needing to open the app first. They can decide whether to open the app and engage with the content based on the notification."]}]}]]}],["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"Content Feeding System"}],":"]}],["$","ul",null,{"children":["$","li",null,{"children":[["$","strong",null,{"children":"Active Engagement"}],": Users must open the app and interact with the feed to view and consume the content. The system is designed to deliver a seamless experience when the user engages directly with the app."]}]}]]}]]}],["$","h3",null,{"className":"content-header","id":"5-independence","children":[["$","a",null,{"className":"break-words","href":"#5-independence","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"5. ",["$","strong",null,{"children":"Independence"}]]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"Notification System"}],":"]}],["$","ul",null,{"children":["$","li",null,{"children":[["$","strong",null,{"children":"Independent of Content Loading"}],": The notification system operates separately from the content feeding system, meaning notifications are delivered even if the content itself is not yet loaded or fetched."]}]}]]}],["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"Content Feeding System"}],":"]}],["$","ul",null,{"children":["$","li",null,{"children":[["$","strong",null,{"children":"Dependent on Feed Model"}],": The way content is delivered depends on whether the system uses a push or pull model, influencing how quickly and efficiently content is loaded when the user interacts with the feed."]}]}]]}]]}],["$","h3",null,{"className":"content-header","id":"6-examples","children":[["$","a",null,{"className":"break-words","href":"#6-examples","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"6. ",["$","strong",null,{"children":"Examples"}]]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"Notification System"}],":"]}],["$","ul",null,{"children":["$","li",null,{"children":"Push notifications for new posts, comments, or likes that pop up on your phone even if the app is closed."}]}]]}],["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"Content Feeding System"}],":"]}],["$","ul",null,{"children":["$","li",null,{"children":"The posts you see in your timeline when you open apps like Twitter, Instagram, or Facebook, either pre-computed and ready to view or fetched on demand."}]}]]}]]}],["$","h3",null,{"className":"content-header","id":"summary","children":[["$","a",null,{"className":"break-words","href":"#summary","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Summary:"]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Notification System"}],": Push-based, real-time, lightweight alerts sent to users regardless of whether the app is open or closed."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Content Feeding System"}],": Responsible for delivering and rendering the actual content in a user’s feed, using either a push model (precomputed) or a pull model (on-demand)."]}]]}]]}],["$","p",null,{"children":"We adopt a hybrid approach to get benefits of both approaches and avoid pitfalls in them. Since fetching the news feed fast is crucial, we use a push model for the majority of users. For celebrities or users who have many friends/followers, we let followers pull news content on-demand to avoid system overload. Consistent hashing is a useful technique to mitigate the hotkey problem as it helps to distribute requests/data more evenly."}],["$","blockquote",null,{"children":[["$","h3",null,{"className":"content-header","id":"1-pushing-content-to-others-news-feeds","children":[["$","a",null,{"className":"break-words","href":"#1-pushing-content-to-others-news-feeds","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"1. ",["$","strong",null,{"children":"Pushing Content to Others' News Feeds:"}]]}],["$","ul",null,{"children":[["$","li",null,{"children":["In social media applications, each user typically has a ",["$","strong",null,{"children":"personal news feed list"}],", which contains posts from the accounts they follow. When you \"push content\" to a follower’s feed, it means that when a user creates a post, that post is immediately ",["$","strong",null,{"children":"inserted into the news feed lists of all their followers"}],"."]}],["$","li",null,{"children":["These personal news feed lists are usually stored in a ",["$","strong",null,{"children":"database"}]," or ",["$","strong",null,{"children":"cache"}]," (e.g., Redis) and are retrieved whenever the user requests their feed. For example, if Alice posts something, the system inserts Alice's post into the personal feeds of Bob, Carol, and all her other followers."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Do feeds grow infinitely?"}]," Not usually. These lists are ",["$","strong",null,{"children":"not stored infinitely"}],"; instead, social media platforms implement mechanisms to ",["$","strong",null,{"children":"expire older content"}]," from the cache or database to avoid excessive storage growth. For example:",["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"TTL (Time to Live):"}]," Older posts might be automatically removed after a certain time period, such as after 30 days."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Fixed-size lists:"}]," Only the ",["$","strong",null,{"children":"most recent posts"}]," are kept in the user's feed (e.g., the last 100 posts), and older ones are deleted."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Archival:"}]," Older content may be archived to cheaper, slower storage for long-term access but is not kept in the active cache."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Cleanup policies:"}]," Periodic cleanup processes may be scheduled to remove inactive or outdated posts from news feeds."]}]]}]]}]]}],["$","h3",null,{"className":"content-header","id":"2-does-fanout-on-write-require-users-to-log-in","children":[["$","a",null,{"className":"break-words","href":"#2-does-fanout-on-write-require-users-to-log-in","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"2. ",["$","strong",null,{"children":"Does Fanout on Write Require Users to Log In?"}]]}],["$","ul",null,{"children":[["$","li",null,{"children":["No, ",["$","strong",null,{"children":"Fanout on Write does not require users to log in"}]," to receive new posts in their feed. When a user creates a post, the system pushes that post to their followers’ news feed ",["$","strong",null,{"children":"whether they are logged in or not"}],"."]}],["$","li",null,{"children":"The primary benefit of this approach is that when users do log in, their news feeds are already pre-populated with the latest posts. This makes fetching the feed instantaneous, as the posts are already sitting in the cache or database."}]]}],["$","p",null,{"children":["$","strong",null,{"children":"Why not trigger a fetch request when users log in?"}]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Pre-computation Advantage:"}]," Fanout on Write pre-computes the feed during the post creation process (write time), so users experience ",["$","strong",null,{"children":"minimal latency"}]," when loading their feed. If you were to trigger a fetch request upon login (which is closer to a ",["$","strong",null,{"children":"Fanout on Read"}]," model), the system would need to retrieve posts from all the accounts the user follows, sort them, and then render the feed in real-time, which introduces ",["$","strong",null,{"children":"higher latency"}],"."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Instant Experience:"}]," Fanout on Write is designed for a ",["$","strong",null,{"children":"real-time, instant experience"}],", ensuring that even if a user has many followers or follows many people, their news feed is ready and waiting as soon as they log in."]}]]}]]}],["$","h4",null,{"className":"content-header","id":"fanout-workers-in-detail","children":[["$","a",null,{"className":"break-words","href":"#fanout-workers-in-detail","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Fanout Workers in Detail"]}],["$","p",null,{"children":"Fanout workers play a crucial role in distributing posts to users' news feeds. They act as the processing layer between the message queue and the news feed cache. Here's a step-by-step breakdown of how they work:"}],["$","h4",null,{"className":"content-header","id":"1-receiving-the-task","children":[["$","a",null,{"className":"break-words","href":"#1-receiving-the-task","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"1. ",["$","strong",null,{"children":"Receiving the Task"}]]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Fanout workers"}]," are subscribed to a ",["$","strong",null,{"children":"message queue"}]," (e.g., RabbitMQ, Kafka). After a new post is published, the list of friends (or followers) and the post ID are sent to the message queue."]}],["$","li",null,{"children":["The workers ",["$","strong",null,{"children":"fetch the task"}]," from the queue, which typically includes the ",["$","strong",null,{"children":"post ID"}]," and a list of ",["$","strong",null,{"children":"user IDs"}]," (friends or followers)."]}]]}],["$","h4",null,{"className":"content-header","id":"2-processing-the-fanout","children":[["$","a",null,{"className":"break-words","href":"#2-processing-the-fanout","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"2. ",["$","strong",null,{"children":"Processing the Fanout"}]]}],["$","ul",null,{"children":[["$","li",null,{"children":"The fanout worker processes each task by iterating through the list of user IDs."}],["$","li",null,{"children":["For each user ID, the worker creates an ",["$","strong",null,{"children":"entry in the news feed cache"}]," linking the post to that user. This is usually stored as a ",["$","code",null,{"children":"<post_id, user_id>"}]," pair, which acts as a reference to the post rather than storing the full content (to save memory)."]}]]}],["$","h4",null,{"className":"content-header","id":"3-efficient-storage","children":[["$","a",null,{"className":"break-words","href":"#3-efficient-storage","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"3. ",["$","strong",null,{"children":"Efficient Storage"}]]}],["$","ul",null,{"children":[["$","li",null,{"children":["Instead of storing the complete post object and user object, ",["$","strong",null,{"children":"only IDs"}]," are stored in the cache. This drastically reduces memory usage. The actual post data (e.g., text, images) is retrieved later from a separate data store when a user views the post."]}],["$","li",null,{"children":["The worker appends the new ",["$","code",null,{"children":"<post_id, user_id>"}]," pair to the news feed cache for each follower of the original poster."]}]]}],["$","h4",null,{"className":"content-header","id":"4-cache-management","children":[["$","a",null,{"className":"break-words","href":"#4-cache-management","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"4. ",["$","strong",null,{"children":"Cache Management"}]]}],["$","ul",null,{"children":[["$","li",null,{"children":["To manage memory usage, the news feed cache is typically ",["$","strong",null,{"children":"bounded"}]," by a configurable limit. For example, each user's feed might store only the ",["$","strong",null,{"children":"most recent 100 posts"}],". Older posts may be ",["$","strong",null,{"children":"removed or archived"}]," to prevent excessive memory consumption."]}],["$","li",null,{"children":["The workers ensure that the cache maintains a fixed size by either removing the ",["$","strong",null,{"children":"oldest posts"}]," when new ones are added or by setting a ",["$","strong",null,{"children":"time-to-live (TTL)"}]," policy for how long posts are kept."]}]]}],["$","h4",null,{"className":"content-header","id":"5-parallel-processing","children":[["$","a",null,{"className":"break-words","href":"#5-parallel-processing","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"5. ",["$","strong",null,{"children":"Parallel Processing"}]]}],["$","ul",null,{"children":[["$","li",null,{"children":["In large-scale systems, there may be ",["$","strong",null,{"children":"multiple fanout workers"}]," operating in parallel. This allows the system to handle large volumes of posts efficiently, even if the poster has millions of followers."]}],["$","li",null,{"children":["Tasks are typically ",["$","strong",null,{"children":"distributed across the workers"}],", allowing them to independently process different batches of followers, which speeds up the fanout process."]}]]}],["$","h4",null,{"className":"content-header","id":"6-fault-tolerance","children":[["$","a",null,{"className":"break-words","href":"#6-fault-tolerance","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"6. ",["$","strong",null,{"children":"Fault Tolerance"}]]}],["$","ul",null,{"children":[["$","li",null,{"children":["Fanout workers are designed to be ",["$","strong",null,{"children":"fault-tolerant"}],". If a worker fails during the task, the message queue can ",["$","strong",null,{"children":"reassign the task to another worker"}]," to ensure that no posts are lost."]}],["$","li",null,{"children":"This ensures that all followers eventually receive the post, even if a worker fails."}]]}],["$","h4",null,{"className":"content-header","id":"summary-1","children":[["$","a",null,{"className":"break-words","href":"#summary-1","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Summary"]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Fanout workers"}]," take the list of user IDs and post ID from the message queue."]}],["$","li",null,{"children":["They efficiently ",["$","strong",null,{"children":"store only the IDs"}]," in the cache to keep memory usage low."]}],["$","li",null,{"children":["They maintain the news feed cache within a ",["$","strong",null,{"children":"fixed size"}]," and ",["$","strong",null,{"children":"process tasks in parallel"}]," to handle scale."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Fault tolerance mechanisms"}]," ensure that tasks are completed even if individual workers fail."]}]]}],["$","h3",null,{"className":"content-header","id":"newsfeed-retrieval","children":[["$","a",null,{"className":"break-words","href":"#newsfeed-retrieval","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Newsfeed retrieval"]}],["$","p",null,{"children":["$","img",null,{"alt":"feed-system-news-retrieval","src":"/assets/feed-system-news-retrieval.png"}]}],["$","ol",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":"A user sends a request to retrieve her news feed. The request looks like this: /v1/me/feed"}]}],["$","li",null,{"children":["$","p",null,{"children":"The load balancer redistributes requests to web servers."}]}],["$","li",null,{"children":["$","p",null,{"children":"Web servers call the news feed service to fetch news feeds."}]}],["$","li",null,{"children":["$","p",null,{"children":"News feed service gets a list post IDs from the news feed cache."}]}],["$","li",null,{"children":["$","p",null,{"children":"A user’s news feed is more than just a list of feed IDs. It contains username, profile picture, post content, post image, etc. Thus, the news feed service fetches the complete user and post objects from caches (user cache and post cache) to construct the fully hydrated news feed."}]}],["$","li",null,{"children":["$","p",null,{"children":"The fully hydrated news feed is returned in JSON format back to the client for rendering."}]}]]}],["$","h4",null,{"className":"content-header","id":"expansion-1","children":[["$","a",null,{"className":"break-words","href":"#expansion-1","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Expansion"]}],["$","h5",null,{"className":"content-header","id":"1-are-posts-strictly-chronological","children":[["$","a",null,{"className":"break-words","href":"#1-are-posts-strictly-chronological","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"1. ",["$","strong",null,{"children":"Are Posts Strictly Chronological?"}]]}],["$","ul",null,{"children":["$","li",null,{"children":["No, the posts that a user receives on platforms like Twitter and Instagram are ",["$","strong",null,{"children":"not always strictly chronological"}],". These platforms often use algorithms to determine the order in which posts are presented. Factors such as ",["$","strong",null,{"children":"engagement"}],", ",["$","strong",null,{"children":"relevance"}],", and ",["$","strong",null,{"children":"user interactions"}]," are prioritized over strict time order. While some real-time posts (like from close friends) might appear in a timely manner, other posts (like from less engaged accounts or celebrities) may be pulled and shown based on what the platform considers most relevant to the user."]}]}],["$","h5",null,{"className":"content-header","id":"2-when-should-you-trigger-fanout-on-read","children":[["$","a",null,{"className":"break-words","href":"#2-when-should-you-trigger-fanout-on-read","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"2. ",["$","strong",null,{"children":"When Should You Trigger Fanout on Read?"}]]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Triggering Fanout on Read"}],": In a hybrid model, fanout on read should be triggered when the user ",["$","strong",null,{"children":"logs in"}]," and requests their feed but the cache contains only partial data from fanout on write."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Return Fanout on Write Data First vs. Combining Data"}],":",["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Option 1: Return Fanout on Write Data First"}],": You could return the ",["$","strong",null,{"children":"fanout on write data"}]," (e.g., posts from close friends) immediately to reduce latency and allow users to see some content right away. Meanwhile, you would trigger fanout on read in the background and fetch additional posts (e.g., from celebrities) asynchronously. Once the additional posts are retrieved, you could either update the feed in real-time or load more content as the user scrolls."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Option 2: Wait and Combine Data"}],": Alternatively, you could ",["$","strong",null,{"children":"wait until both fanout on write and fanout on read"}]," data are combined before sending the complete feed to the user. This ensures a more seamless experience but could introduce additional latency, as the user will have to wait until all data has been fetched and merged."]}]]}]]}]]}],["$","p",null,{"children":["The choice depends on your ",["$","strong",null,{"children":"user experience goals"}],". If you prioritize ",["$","strong",null,{"children":"instant loading"}],", returning fanout on write data first is preferable. If you want a ",["$","strong",null,{"children":"more complete feed from the start"}],", you may opt to wait for fanout on read."]}],["$","h5",null,{"className":"content-header","id":"3-how-should-the-server-retrieve-missing-data-not-in-the-fanout-on-write-cache-or-db","children":[["$","a",null,{"className":"break-words","href":"#3-how-should-the-server-retrieve-missing-data-not-in-the-fanout-on-write-cache-or-db","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"3. ",["$","strong",null,{"children":"How Should the Server Retrieve Missing Data Not in the Fanout on Write Cache or DB?"}]]}],["$","ul",null,{"children":["$","li",null,{"children":["When the server detects that certain posts are missing from the ",["$","strong",null,{"children":"fanout on write cache"}],", it needs to ",["$","strong",null,{"children":"run a fanout on read operation"}],". Here’s how it can retrieve the missing data:",["$","ol",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Identify Missing Posts"}],": The server first determines which posts are missing. This can be done by checking the ",["$","strong",null,{"children":"last post timestamp"}]," or ",["$","strong",null,{"children":"post sequence numbers"}]," to identify gaps in the feed. If certain posts are not found in the cache, they are flagged for retrieval."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Query the Primary Data Store"}],": For posts that were not cached during fanout on write, the server queries the ",["$","strong",null,{"children":"primary database"}]," (where all posts are stored) to fetch recent posts from the accounts the user follows (e.g., celebrities or distant connections)."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Merge with Cache Data"}],": Once the missing posts are retrieved from the database, they are ",["$","strong",null,{"children":"merged with the cached data"}]," from fanout on write, ensuring that the final feed includes all relevant posts."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Return Data to the User"}],": Depending on the system design, this data can either be returned immediately once complete or loaded incrementally as the user scrolls through their feed."]}]]}]]}]}],["$","h5",null,{"className":"content-header","id":"4-how-can-we-know-what-data-should-be-retrieved-during-the-fanout-on-read-phase","children":[["$","a",null,{"className":"break-words","href":"#4-how-can-we-know-what-data-should-be-retrieved-during-the-fanout-on-read-phase","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"4. How Can We Know What Data Should Be Retrieved During the Fanout on Read Phase?"]}],["$","p",null,{"children":["To effectively retrieve the missing data during the ",["$","strong",null,{"children":"fanout on read"}]," phase, the system can follow these steps:"]}],["$","ol",null,{"children":[["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"Tracking Gaps in the Cache"}],":"]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Cache Metadata"}],": The system can store metadata in the user’s feed cache, such as ",["$","strong",null,{"children":"last update timestamps"}],", ",["$","strong",null,{"children":"post sequence numbers"}],", or ",["$","strong",null,{"children":"content source tags"}]," (e.g., marking whether a post was retrieved via fanout on write or fanout on read)."]}],["$","li",null,{"children":["This metadata can be used to track which posts were ",["$","strong",null,{"children":"pushed during fanout on write"}]," and identify the content that was ",["$","strong",null,{"children":"not included"}]," (such as posts from high-volume users or celebrities)."]}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"Querying the Relevant Data Sources"}],":"]}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Identify Followed Accounts Excluded from Fanout on Write"}],": During the fanout on read phase, the system checks the list of followed accounts that were ",["$","strong",null,{"children":"excluded from fanout on write"}]," (e.g., celebrities, users with a large following). These accounts are flagged as requiring additional retrieval."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Time-Based Queries"}],": Using the ",["$","strong",null,{"children":"last update timestamp"}]," or ",["$","strong",null,{"children":"post sequence number"}],", the system queries the database or a specialized data store to retrieve any ",["$","strong",null,{"children":"new posts"}]," from these excluded accounts that were published after the user’s cache was last updated."]}]]}]]}],["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"Dynamic Post Retrieval"}],":"]}],["$","ul",null,{"children":["$","li",null,{"children":["The system performs a ",["$","strong",null,{"children":"dynamic retrieval"}]," of posts from these accounts (via ",["$","strong",null,{"children":"fanout on read"}],") and integrates them into the user’s feed. This process ensures that the user receives both the ",["$","strong",null,{"children":"real-time posts"}]," from close friends and the ",["$","strong",null,{"children":"on-demand posts"}]," from celebrities or high-volume users."]}]}]]}],["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"Pagination and Infinite Scrolling"}],":"]}],["$","ul",null,{"children":["$","li",null,{"children":["Since many social media platforms use ",["$","strong",null,{"children":"pagination"}]," or ",["$","strong",null,{"children":"infinite scrolling"}],", the fanout on read phase can be executed incrementally as the user scrolls down their feed. As new data is needed, the system fetches the next batch of posts from the users excluded from fanout on write, ensuring a continuous and seamless user experience."]}]}]]}],["$","li",null,{"children":[["$","p",null,{"children":[["$","strong",null,{"children":"Prioritization and Filtering"}],":"]}],["$","ul",null,{"children":[["$","li",null,{"children":["During fanout on read, the system can prioritize fetching the ",["$","strong",null,{"children":"most recent"}]," or ",["$","strong",null,{"children":"most relevant"}]," posts from these excluded accounts, based on factors like engagement or user interest."]}],["$","li",null,{"children":"Filtering mechanisms can be used to ensure that only the most relevant posts are pulled into the user’s feed, avoiding information overload."}]]}]]}]]}],["$","h2",null,{"className":"content-header","id":"chapter-12-design-a-chat-system","children":[["$","a",null,{"className":"break-words","href":"#chapter-12-design-a-chat-system","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"CHAPTER 12: DESIGN A CHAT SYSTEM"]}]]}]}],["$","footer",null,{"children":[["$","div",null,{"className":"divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y","children":[["$","div",null,{"className":"py-4 xl:py-8","children":[["$","h2",null,{"className":"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400","children":"Tags"}],["$","div",null,{"className":"flex flex-wrap","children":[["$","$L9",null,{"href":"/tags/system-design","className":"mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400","children":"system-design"}],["$","$L9",null,{"href":"/tags/book-reading","className":"mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400","children":"book-reading"}]]}]]}],["$","div",null,{"className":"flex justify-between py-4 xl:block xl:space-y-8 xl:py-8","children":[["$","div",null,{"children":[["$","h2",null,{"className":"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400","children":"Previous Article"}],["$","div",null,{"className":"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400","children":["$","$L9",null,{"className":"break-words","href":"/blog/web-development/backend-techs/nginx/file-upload","children":"Nginx File Upload"}]}]]}],["$","div",null,{"children":[["$","h2",null,{"className":"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400","children":"Next Article"}],["$","div",null,{"className":"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400","children":["$","$L9",null,{"className":"break-words","href":"/blog/programming-basic/programming-languages/go/common-issues/loop-variable-in-goroutine","children":"Loop Variable Capturing Issue in Goroutines Closure"}]}]]}]]}]]}],["$","div",null,{"className":"pt-4 xl:pt-8","children":["$","$L9",null,{"className":"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400","href":"/blog","aria-label":"Back to the projects","children":"← Back to the projects"}]}]]}]]}]]}]}]]}]]
d:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"System Design Alex Xu | CodeWisdom"}],["$","meta","3",{"name":"description","content":"Notes from the book \"System Design Interview by Alex Xu\"."}],["$","meta","4",{"name":"robots","content":"index, follow"}],["$","meta","5",{"name":"googlebot","content":"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"}],["$","link","6",{"rel":"canonical","href":"https://codewisdom.io/blog/book-reading/system-design-alex-xu"}],["$","link","7",{"rel":"alternate","type":"application/rss+xml","href":"https://codewisdom.io/feed.xml"}],["$","meta","8",{"property":"og:title","content":"System Design Alex Xu"}],["$","meta","9",{"property":"og:description","content":"Notes from the book \"System Design Interview by Alex Xu\"."}],["$","meta","10",{"property":"og:url","content":"https://codewisdom.io/blog/book-reading/system-design-alex-xu"}],["$","meta","11",{"property":"og:site_name","content":"CodeWisdom"}],["$","meta","12",{"property":"og:locale","content":"en_US"}],["$","meta","13",{"property":"og:image","content":"https://codewisdom.io/static/images/logo-round.png"}],["$","meta","14",{"property":"og:type","content":"article"}],["$","meta","15",{"property":"article:published_time","content":"2024-08-15T00:00:00.000Z"}],["$","meta","16",{"property":"article:modified_time","content":"2024-08-15T00:00:00.000Z"}],["$","meta","17",{"property":"article:author","content":"Bowen Y"}],["$","meta","18",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","19",{"name":"twitter:title","content":"System Design Alex Xu"}],["$","meta","20",{"name":"twitter:description","content":"Notes from the book \"System Design Interview by Alex Xu\"."}],["$","meta","21",{"name":"twitter:image","content":"https://codewisdom.io/static/images/logo-round.png"}],["$","meta","22",{"name":"next-size-adjust"}]]
1:null
