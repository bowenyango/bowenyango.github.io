<!DOCTYPE html><html lang="en-us" class="__variable_0aa4ae scroll-smooth"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/2d141e1a38819612-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="/_next/static/media/logo.a3d92d8f.png"/><link rel="stylesheet" href="/_next/static/css/5beba742ae93b864.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/f719ff1083adf929.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/e36d2c8a31781d2e.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-8a3a6504f64badee.js"/><script src="/_next/static/chunks/fd9d1056-7b6151dbf9b37af2.js" async=""></script><script src="/_next/static/chunks/23-ba11cb3b863464a4.js" async=""></script><script src="/_next/static/chunks/main-app-4250bb735c1c7796.js" async=""></script><script src="/_next/static/chunks/231-42eeaa612179830e.js" async=""></script><script src="/_next/static/chunks/113-8a0c0daa2bfc088c.js" async=""></script><script src="/_next/static/chunks/app/layout-a7a2551425c87cc3.js" async=""></script><script src="/_next/static/chunks/173-af5b99c330035292.js" async=""></script><script src="/_next/static/chunks/459-6c5dcdc51f43b997.js" async=""></script><script src="/_next/static/chunks/app/blog/%5B...slug%5D/page-5ad4d86948f7f0f4.js" async=""></script><link rel="preload" href="https://analytics.umami.is/script.js" as="script"/><title>GFS | CodeWisdom</title><meta name="description" content="Explores the GFS."/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://codewisdom.io/blog/distributed-systems/systems/GFS"/><link rel="alternate" type="application/rss+xml" href="https://codewisdom.io/feed.xml"/><meta property="og:title" content="GFS"/><meta property="og:description" content="Explores the GFS."/><meta property="og:url" content="https://codewisdom.io/blog/distributed-systems/systems/GFS"/><meta property="og:site_name" content="CodeWisdom"/><meta property="og:locale" content="en_US"/><meta property="og:image" content="https://codewisdom.io/static/images/logo-round.png"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2024-10-31T00:00:00.000Z"/><meta property="article:modified_time" content="2024-10-31T00:00:00.000Z"/><meta property="article:author" content="Bowen Y"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="GFS"/><meta name="twitter:description" content="Explores the GFS."/><meta name="twitter:image" content="https://codewisdom.io/static/images/logo-round.png"/><meta name="next-size-adjust"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/logo-round.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/logo-round.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/logo-round.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="bg-white pl-[calc(100vw-100%)] text-black antialiased dark:bg-gray-950 dark:text-white"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><header class="flex items-center w-full bg-white dark:bg-gray-950 justify-between py-10"><a class="break-words" aria-label="CodeWisdom" href="/"><div class="flex items-center justify-between"><div class="mr-3"><img src="/_next/static/media/logo.a3d92d8f.png" alt="logo" class="h-10 w-14"/></div><div class="hidden h-6 text-2xl font-semibold sm:block">CodeWisdom</div></div></a><div class="flex items-center space-x-4 leading-5 sm:space-x-6"><div class="no-scrollbar hidden max-w-40 items-center space-x-4 overflow-x-auto sm:flex sm:space-x-6 md:max-w-72 lg:max-w-96"><a class="block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400" href="/blog">Blog</a><a class="block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400" href="/tags">Tags</a><a class="block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400" href="/projects">Projects</a><a class="block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400" href="/about">About</a></div><button aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg></button><div class="mr-5 flex items-center"><div class="relative inline-block text-left" data-headlessui-state=""><div class="flex items-center justify-center hover:text-primary-500 dark:hover:text-primary-400"><button aria-label="Theme switcher" id="headlessui-menu-button-:Rn6jaba:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><svg class="h-6 w-6"></svg></button></div></div></div><button aria-label="Toggle Menu" class="sm:hidden"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-8 w-8 text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div hidden="" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></div></div></header><main class="mb-auto"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"GFS","datePublished":"2024-10-31T00:00:00.000Z","dateModified":"2024-10-31T00:00:00.000Z","description":"Explores the GFS.","image":"/static/images/logo-round.png","url":"https://codewisdom.io/blog/distributed-systems/systems/GFS","author":[{"@type":"Person","name":"Bowen Y"}]}</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed bottom-8 right-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2024-10-31T00:00:00.000Z">Wednesday, October 30, 2024</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">GFS</h1></div></div></header><div class="grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0"><dl class="pb-10 pt-6 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img alt="avatar" loading="lazy" width="38" height="38" decoding="async" data-nimg="1" class="h-10 w-10 rounded-full" style="color:transparent" src="/static/images/pixel-avatar.png"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Bowen Y</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pb-8 pt-10 dark:prose-invert"><h2 class="content-header" id="gfs"><a class="break-words" href="#gfs" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>GFS</h2><h3 class="content-header" id="key-features"><a class="break-words" href="#key-features" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Key Features</h3><ul><li>The primary checks to see if appending the record to the current chunk would cause the chunk to exceed the maximum size (64 MB). If so, it pads the chunk to the maximum size</li><li>Record append is restricted to be at most one-fourth of the maximum chunk size</li><li>GFS does not guarantee that all replicas are bytewise identical. It only guarantees that the data is written at least once as an atomic unit.</li><li>Like AFS, GFS uses standard copy-on-write techniques to implement snapshots. The newly created snapshot ﬁles point to the same chunks as the source ﬁles until clients send new write requests.</li><li>Each master operation acquires a set of locks before it runs. Typically, if it involves <code>/d1/d2/.../dn/leaf</code>, it will acquire read-locks on the directory names <code>/d1</code>, <code>/d1/d2</code>, ..., <code>/d1/d2/.../dn</code>, and either a read lock or a write lock on the full pathname <code>/d1/d2/.../dn/leaf</code>.</li><li>After a ﬁle is deleted, GFS does not immediately reclaim the available physical storage. It does so only lazily during regular garbage collection at both the ﬁle and chunk levels.</li><li>Instead of reclaiming resources immediately, the ﬁle is just renamed to a hidden name that includes the deletion timestamp.</li><li>In a similar regular scan of the chunk namespace, the master identiﬁes orphaned chunks (i.e., those not reachable from any ﬁle) and erases the metadata for those chunks.</li><li>Each chunkserver uses checksumming to detect corruption of stored data.</li></ul><h3 class="content-header" id="metadata-stored-on-the-master-node"><a class="break-words" href="#metadata-stored-on-the-master-node" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>Metadata Stored on the Master Node</strong></h3><ol><li><p><strong>File-to-Chunk Mapping (Namespace):</strong></p><ul><li>The <strong>file namespace</strong> in GFS is similar to a traditional file system’s directory structure. Files are identified by their full pathnames.</li><li>For each file, the master stores a mapping of the file name to an <strong>array of chunk handles</strong>. Each chunk handle corresponds to a 64 MB chunk of the file.<ul><li><strong>Example:</strong><ul><li>A file like <code>/data/logs/logfile.txt</code> could map to chunk handles [chunkHandle1, chunkHandle2, chunkHandle3], where each handle represents a 64 MB chunk of the file.</li></ul></li></ul></li><li>This structure allows the master to keep track of which file corresponds to which chunks, facilitating data location and retrieval.</li></ul></li><li><p><strong>Chunk Handle Information:</strong></p><ul><li>Each chunk handle in the array contains several key pieces of metadata that describe the state and location of the chunk in the system:<ol><li><strong>List of Chunkservers:</strong><ul><li>The master keeps a list of <strong>chunkservers</strong> that store replicas of the chunk. This list allows the master to direct clients to specific chunkservers for reading or writing.</li></ul></li><li><strong>Chunk Version Number:</strong><ul><li>The <strong>version number</strong> of the chunk is critical for ensuring data consistency. If a chunkserver goes down and misses some updates (mutations), its version number will lag behind the up-to-date replicas. When the chunkserver comes back online, the master uses the version number to detect if the chunk is <strong>stale</strong> and to prevent stale data from being used.</li><li>The master increments the version number whenever a new lease is granted for the chunk to ensure all replicas are synchronized.</li></ul></li><li><strong>Primary Chunkserver:</strong><ul><li>For each chunk, the master identifies which <strong>chunkserver is the primary</strong> for mutation (write) operations. The primary is responsible for ordering writes and ensuring consistency across replicas.</li><li>The <strong>primary</strong> is selected when a client writes to the chunk, and this information is cached by the client to avoid repeated interactions with the master.</li></ul></li><li><strong>Lease Expiration Time:</strong><ul><li>The master grants a <strong>lease</strong> to one of the chunk replicas (the primary) for coordinating writes. The lease ensures that all mutations to the chunk are ordered consistently. Leases typically last for <strong>60 seconds</strong>, but they can be extended as long as the chunk is being actively written.</li><li>The master tracks the <strong>lease expiration</strong> time, and if the lease expires or needs to be revoked (e.g., for a snapshot operation), the master will update the lease information.</li></ul></li></ol></li></ul></li><li><p><strong>Replication Information:</strong></p><ul><li>For each chunk, the master stores information about the <strong>replication level</strong> (default is three replicas) and the <strong>current locations of the replicas</strong> (the chunkservers storing them). This allows the master to:<ul><li>Ensure that the correct number of replicas are maintained.</li><li>Respond to client requests by directing them to the appropriate chunkservers holding valid replicas of a chunk.</li></ul></li><li>If a chunk becomes under-replicated (due to a chunkserver failure), the master initiates a <strong>re-replication process</strong> by copying the chunk to other chunkservers.</li></ul></li><li><p><strong>Chunk Placement and Load Balancing:</strong></p><ul><li>The master keeps track of how chunks are distributed across chunkservers. It uses this information to make <strong>chunk placement decisions</strong> (e.g., when creating a new chunk) to ensure that chunks are evenly spread across different machines and racks for both performance and reliability.</li><li>The master periodically <strong>rebalances</strong> chunk replicas if it detects that some chunkservers are overloaded or underutilized.</li></ul></li><li><p><strong>Operation Log:</strong></p><ul><li>The master maintains an <strong>operation log</strong> of all critical metadata updates (file creations, deletions, chunk allocations, etc.). This log is <strong>persisted</strong> on the master’s local disk and <strong>replicated</strong> on remote machines for fault tolerance.</li><li>The operation log serves as the <strong>only persistent record</strong> of metadata. In case of a failure, the master can recover by replaying the log.</li></ul></li><li><p><strong>Chunk Garbage Collection and Orphaned Chunks:</strong></p><ul><li>The master keeps track of <strong>orphaned chunks</strong>—chunks that are no longer associated with any files (due to file deletions) and need to be garbage collected.</li><li>Orphaned chunks are identified through periodic <strong>namespace scans</strong>, and the master informs chunkservers to delete them when they are no longer needed.</li></ul></li><li><p><strong>Checkpointing for Faster Recovery:</strong></p><ul><li>To avoid replaying the entire operation log after a failure, the master periodically creates <strong>checkpoints</strong> of its in-memory metadata. These checkpoints are stored on disk and contain the latest version of the file namespace and chunk mapping.</li></ul></li></ol><h3 class="content-header" id="how-the-master-uses-metadata"><a class="break-words" href="#how-the-master-uses-metadata" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>How the Master Uses Metadata</strong></h3><ol><li><strong>File Operations:</strong><ul><li>When a client performs an operation like opening a file, the master consults its <strong>file-to-chunk mapping</strong> to find the relevant chunk handles.</li><li>For each chunk handle, the master retrieves the <strong>list of chunkservers</strong> storing replicas of the chunk and returns this information to the client.</li><li>The master may update the metadata if new chunks are created or if the file is renamed or deleted.</li></ul></li><li><strong>Reading Data:</strong><ul><li>The client first asks the master for the <strong>chunk locations</strong> corresponding to the file. The master retrieves the <strong>list of chunkservers</strong> storing the chunk replicas and directs the client to one of the chunkservers (typically the closest one based on network proximity).</li><li>After this initial request, the client caches the chunk locations, reducing the load on the master for subsequent reads.</li></ul></li><li><strong>Writing Data (Mutation Order):</strong><ul><li>For writes or record appends, the client requests the <strong>lease</strong> for the relevant chunk from the master. The master grants a lease to one of the replicas, making it the <strong>primary chunkserver</strong>.</li><li>The <strong>primary chunkserver</strong> is responsible for serializing write operations, and it replicates the writes to other chunkservers in the order it receives them, ensuring that all replicas remain consistent.</li><li>The master keeps track of the <strong>lease expiration</strong> and <strong>primary status</strong> for each chunk, ensuring orderly writes and preventing conflicting operations.</li></ul></li><li><strong>Fault Detection and Recovery:</strong><ul><li>The master uses <strong>heartbeat messages</strong> to continuously monitor the health of chunkservers. If a chunkserver becomes unavailable or reports a <strong>stale chunk</strong>, the master uses the <strong>version number</strong> to detect which replicas are up-to-date and to initiate the necessary <strong>re-replication</strong> to restore the required number of replicas.</li><li>The master handles <strong>garbage collection</strong> by marking chunks that are no longer referenced in the namespace for deletion.</li></ul></li></ol><h3 class="content-header" id="master-recovery-mechanisms"><a class="break-words" href="#master-recovery-mechanisms" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>Master Recovery Mechanisms</strong></h3><h4 class="content-header" id="1-operation-log-and-checkpointing"><a class="break-words" href="#1-operation-log-and-checkpointing" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>1. Operation Log and Checkpointing</strong></h4><p><strong>Operation Log:</strong></p><p>The <strong>operation log</strong> is a sequential record of all critical metadata changes in the system. Each entry records an operation that modifies the file system&#x27;s state. The log entries might include operations like file creation, deletion, chunk creation, and replica updates.</p><p><strong>Example of Operation Log Entries:</strong></p><p>Imagine the master node&#x27;s operation log contains entries like the following (simplified for illustration):</p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token punctuation">[</span><span class="token atrule key">Timestamp</span><span class="token punctuation">:</span> <span class="token number datetime">2023-10-17 10:00:00</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token atrule key">Operation</span><span class="token punctuation">:</span> Create File
</span><span class="code-line"><span class="token atrule key">File Path</span><span class="token punctuation">:</span> /data/logs/logfile.txt
</span><span class="code-line"><span class="token atrule key">Assigned Chunk Handles</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>CHUNK_001<span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">[</span><span class="token atrule key">Timestamp</span><span class="token punctuation">:</span> <span class="token number datetime">2023-10-17 10:05:00</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token atrule key">Operation</span><span class="token punctuation">:</span> Create Chunk
</span><span class="code-line"><span class="token atrule key">Chunk Handle</span><span class="token punctuation">:</span> CHUNK_001
</span><span class="code-line"><span class="token atrule key">Replica Locations</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>ChunkServer1<span class="token punctuation">,</span> ChunkServer2<span class="token punctuation">,</span> ChunkServer3<span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">[</span><span class="token atrule key">Timestamp</span><span class="token punctuation">:</span> <span class="token number datetime">2023-10-17 10:10:00</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token atrule key">Operation</span><span class="token punctuation">:</span> Append Data
</span><span class="code-line"><span class="token atrule key">File Path</span><span class="token punctuation">:</span> /data/logs/logfile.txt
</span><span class="code-line"><span class="token atrule key">Chunk Handle</span><span class="token punctuation">:</span> CHUNK_001
</span><span class="code-line"><span class="token atrule key">Data Size</span><span class="token punctuation">:</span> 64 MB
</span><span class="code-line"><span class="token atrule key">Client ID</span><span class="token punctuation">:</span> Client_123A
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">[</span><span class="token atrule key">Timestamp</span><span class="token punctuation">:</span> <span class="token number datetime">2023-10-17 10:15:00</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token atrule key">Operation</span><span class="token punctuation">:</span> Create Chunk
</span><span class="code-line"><span class="token atrule key">Chunk Handle</span><span class="token punctuation">:</span> CHUNK_002
</span><span class="code-line"><span class="token atrule key">Replica Locations</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>ChunkServer2<span class="token punctuation">,</span> ChunkServer3<span class="token punctuation">,</span> ChunkServer4<span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">[</span><span class="token atrule key">Timestamp</span><span class="token punctuation">:</span> <span class="token number datetime">2023-10-17 10:20:00</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token atrule key">Operation</span><span class="token punctuation">:</span> Delete File
</span><span class="code-line"><span class="token atrule key">File Path</span><span class="token punctuation">:</span> /data/logs/oldlog.txt
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">[</span><span class="token atrule key">Timestamp</span><span class="token punctuation">:</span> <span class="token number datetime">2023-10-17 10:25:00</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token atrule key">Operation</span><span class="token punctuation">:</span> Lease Granted
</span><span class="code-line"><span class="token atrule key">Chunk Handle</span><span class="token punctuation">:</span> CHUNK_002
</span><span class="code-line"><span class="token atrule key">Primary ChunkServer</span><span class="token punctuation">:</span> ChunkServer2
</span><span class="code-line"><span class="token atrule key">Lease Expiration</span><span class="token punctuation">:</span> <span class="token number datetime">2023-10-17 10:30:00</span>
</span></code></pre></div><p>In this example:</p><ul><li>The master logs the creation of a new file and assigns it a chunk handle.</li><li>It records the creation of chunks and their replica locations.</li><li>Append operations are logged with details like file path, chunk handle, data size, and client ID.</li><li>Deletions and lease grants are also recorded with relevant details.</li></ul><p><strong>Checkpointing:</strong></p><p>A <strong>checkpoint</strong> is a snapshot of the master node&#x27;s in-memory metadata at a specific point in time. It includes the current state of the file system namespace, the mapping of files to chunks, chunk version numbers, lease information, and other necessary metadata.</p><p><strong>Example of a Checkpoint Content:</strong></p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token atrule key">Checkpoint Timestamp</span><span class="token punctuation">:</span> <span class="token number datetime">2023-10-17 10:30:00</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token atrule key">File Namespace</span><span class="token punctuation">:</span>
</span><span class="code-line"><span class="token punctuation">-</span> /data/logs/logfile.txt
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">Chunks</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>CHUNK_001<span class="token punctuation">,</span> CHUNK_002<span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">-</span> /data/logs/oldlog.txt (marked for deletion)
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">Chunks</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>CHUNK_000<span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token atrule key">Chunk Information</span><span class="token punctuation">:</span>
</span><span class="code-line"><span class="token punctuation">-</span> CHUNK_000
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">Replica Locations</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>ChunkServer1<span class="token punctuation">,</span> ChunkServer2<span class="token punctuation">,</span> ChunkServer3<span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">Version</span><span class="token punctuation">:</span> <span class="token number">2</span>
</span><span class="code-line"><span class="token punctuation">-</span> CHUNK_001
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">Replica Locations</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>ChunkServer1<span class="token punctuation">,</span> ChunkServer2<span class="token punctuation">,</span> ChunkServer3<span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">Version</span><span class="token punctuation">:</span> <span class="token number">1</span>
</span><span class="code-line"><span class="token punctuation">-</span> CHUNK_002
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">Replica Locations</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>ChunkServer2<span class="token punctuation">,</span> ChunkServer3<span class="token punctuation">,</span> ChunkServer4<span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">Version</span><span class="token punctuation">:</span> <span class="token number">1</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">Lease Info</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">Primary</span><span class="token punctuation">:</span> ChunkServer2
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">Lease Expiration</span><span class="token punctuation">:</span> <span class="token number datetime">2023-10-17 10:30:00</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token atrule key">Deleted Files</span><span class="token punctuation">:</span>
</span><span class="code-line"><span class="token punctuation">-</span> /data/logs/oldlog.txt
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">Deletion Timestamp</span><span class="token punctuation">:</span> <span class="token number datetime">2023-10-17 10:20:00</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">Pending Deletion after</span><span class="token punctuation">:</span> 3 days (garbage collection)
</span><span class="code-line">
</span><span class="code-line"><span class="token atrule key">Additional Metadata</span><span class="token punctuation">:</span>
</span><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">Next Chunk Handle ID</span><span class="token punctuation">:</span> CHUNK_003
</span><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">Active Leases</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token punctuation">-</span> CHUNK_002
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">Primary</span><span class="token punctuation">:</span> ChunkServer2
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">Lease Expiration</span><span class="token punctuation">:</span> <span class="token number datetime">2023-10-17 10:30:00</span>
</span></code></pre></div><p>The checkpoint captures:</p><ul><li>The file namespace and mappings to chunks.</li><li>Chunk information, including replica locations and version numbers.</li><li>Lease information for chunks with active leases.</li><li>Metadata about deleted files pending garbage collection.</li><li>A record of the next available chunk handle ID.</li></ul><p><strong>Master Recovery Using Operation Log and Checkpoint:</strong></p><p>When the master node needs to recover (e.g., after a failure), it performs the following steps:</p><ol><li><strong>Load the Most Recent Checkpoint</strong></li><li><strong>Replay the Operation Log</strong></li><li><strong>Re-initialize State</strong></li></ol><h4 class="content-header" id="2-replication-of-master-metadata"><a class="break-words" href="#2-replication-of-master-metadata" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>2. Replication of Master Metadata</strong></h4><p>To ensure durability and availability, the master replicates its operation log and checkpoints to multiple remote machines.</p><p><strong>Example of Replication Process:</strong></p><ul><li><p><strong>Operation Log Replication:</strong></p><p>Each time the master appends a new entry to the operation log, it writes the entry to its local disk and sends it to multiple remote replicas.</p><div class="relative"><pre><code class="code-highlight language-markdown"><span class="code-line">Operation Log Entry Replication:
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation list">-</span> Local Write: Append new log entry to local operation log file.
</span><span class="code-line"><span class="token punctuation list">-</span> Remote Replication:
</span><span class="code-line">  <span class="token punctuation list">-</span> Send log entry to ReplicaServer1.
</span><span class="code-line">  <span class="token punctuation list">-</span> Send log entry to ReplicaServer2.
</span><span class="code-line"><span class="token punctuation list">-</span> Confirmation: Wait for acknowledgments from replicas before considering the operation committed.
</span></code></pre></div></li><li><p><strong>Checkpoint Replication:</strong></p><p>When the master creates a new checkpoint, it saves it locally and sends copies to replica servers.</p><div class="relative"><pre><code class="code-highlight language-markdown"><span class="code-line">Checkpoint Replication:
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation list">-</span> Local Save: Write checkpoint file to local disk.
</span><span class="code-line"><span class="token punctuation list">-</span> Remote Replication:
</span><span class="code-line">  <span class="token punctuation list">-</span> Send checkpoint file to ReplicaServer1.
</span><span class="code-line">  <span class="token punctuation list">-</span> Send checkpoint file to ReplicaServer2.
</span><span class="code-line"><span class="token punctuation list">-</span> Confirmation: Verify successful receipt at replicas.
</span></code></pre></div></li></ul><p>This replication ensures that if the master node&#x27;s local storage fails, a new master can be started using the replicated logs and checkpoints.</p><h4 class="content-header" id="3-fast-recovery-of-the-master-node"><a class="break-words" href="#3-fast-recovery-of-the-master-node" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>3. Fast Recovery of the Master Node</strong></h4><p><strong>Example of Master Recovery Steps:</strong></p><p>Suppose the master node crashes at 10:35:00. Upon detection, the system initiates recovery:</p><ol><li><strong>Startup:</strong><ul><li>A new master process is started on the same or a different machine.</li></ul></li><li><strong>Load Checkpoint:</strong><ul><li>The master loads the last checkpoint created at 10:30:00.</li></ul></li><li><strong>Replay Operation Log:</strong><ul><li><p>The master reads the operation log entries from 10:30:00 to 10:35:00.</p></li><li><p>Example of entries to replay:</p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token punctuation">[</span><span class="token atrule key">Timestamp</span><span class="token punctuation">:</span> <span class="token number datetime">2023-10-17 10:31:00</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token atrule key">Operation</span><span class="token punctuation">:</span> Append Data
</span><span class="code-line"><span class="token atrule key">File Path</span><span class="token punctuation">:</span> /data/logs/logfile.txt
</span><span class="code-line"><span class="token atrule key">Chunk Handle</span><span class="token punctuation">:</span> CHUNK_002
</span><span class="code-line"><span class="token atrule key">Data Size</span><span class="token punctuation">:</span> 32 MB
</span><span class="code-line"><span class="token atrule key">Client ID</span><span class="token punctuation">:</span> Client_124
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">[</span><span class="token atrule key">Timestamp</span><span class="token punctuation">:</span> <span class="token number datetime">2023-10-17 10:33:00</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token atrule key">Operation</span><span class="token punctuation">:</span> Lease Renewal
</span><span class="code-line"><span class="token atrule key">Chunk Handle</span><span class="token punctuation">:</span> CHUNK_002
</span><span class="code-line"><span class="token atrule key">Lease Expiration</span><span class="token punctuation">:</span> <span class="token number datetime">2023-10-17 10:38:00</span>
</span></code></pre></div></li><li><p>The master applies these operations to update the in-memory metadata:</p><ul><li>Update chunk data for <code>CHUNK_002</code>.</li><li>Extend the lease expiration for <code>CHUNK_002</code>.</li></ul></li></ul></li><li><strong>Communicate with Chunkservers:</strong><ul><li>The master sends heartbeat messages to all chunkservers to collect the latest state of chunk replicas.</li><li>Chunkservers respond with their current chunk inventory, including any updates that occurred during the master&#x27;s downtime.</li></ul></li><li><strong>Update Chunk Replica Locations:</strong><ul><li>The master updates its metadata with the current locations of chunk replicas as reported by the chunkservers.</li></ul></li><li><strong>Resume Operations:</strong><ul><li>The master is now ready to handle client requests.</li></ul></li></ol><h4 class="content-header" id="4-shadow-masters-for-read-only-access"><a class="break-words" href="#4-shadow-masters-for-read-only-access" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>4. Shadow Masters for Read-Only Access</strong></h4><p>While the primary master is recovering, <strong>shadow masters</strong> can provide read-only access to clients.</p><p><strong>Example of Shadow Master Functionality:</strong></p><ul><li>The shadow master maintains a copy of the metadata by:<ul><li>Periodically reading the replicated operation log and checkpoints.</li><li>Applying updates to its in-memory metadata structures.</li></ul></li><li>During master downtime:<ul><li>Clients can send read requests to the shadow master.</li><li>The shadow master uses its metadata to direct clients to chunkservers holding the requested data.</li></ul></li><li><strong>Limitation:</strong><ul><li>Shadow masters cannot process metadata mutations (e.g., file creations, deletions, or writes) since they are not authorized to modify the file system state.</li></ul></li></ul><h4 class="content-header" id="5-client-resilience-to-master-failures"><a class="break-words" href="#5-client-resilience-to-master-failures" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>5. Client Resilience to Master Failures</strong></h4><p>Clients are designed to handle temporary master unavailability gracefully.</p><p><strong>Example of Client Behavior:</strong></p><ul><li><strong>Caching Metadata:</strong><ul><li>Clients cache file-to-chunk mappings and chunk replica locations.</li></ul></li><li><strong>Handling Master Unavailability:</strong><ul><li>If the master is unavailable when a client needs to access metadata:<ul><li>The client waits and retries the request after a short delay.</li><li>For read operations, if the client has cached metadata, it can continue accessing data directly from chunkservers.</li></ul></li></ul></li><li><strong>Example Scenario:</strong><ul><li>A client wants to read from <code>/data/logs/logfile.txt</code>.</li><li>The client has cached that <code>CHUNK_002</code> is part of the file and knows the locations of its replicas.</li><li>The client sends a read request directly to one of the chunkservers holding <code>CHUNK_002</code>.</li><li>If the client&#x27;s cached metadata expires or is invalid (e.g., due to a chunkserver failure), and the master is down, the client waits until the master is back online to refresh the metadata.</li></ul></li></ul><h4 class="content-header" id="6-fault-detection-and-monitoring"><a class="break-words" href="#6-fault-detection-and-monitoring" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>6. Fault Detection and Monitoring</strong></h4><p>External monitoring systems detect master failures and initiate recovery.</p><p><strong>Example of Monitoring Process:</strong></p><ul><li><strong>Heartbeat Monitoring:</strong><ul><li>A monitoring service periodically sends heartbeat messages to the master.</li><li>If the master does not respond within a specified timeout, it is considered down.</li></ul></li><li><strong>Automated Recovery Actions:</strong><ul><li>The monitoring system starts a new master process on the same or a different machine.</li><li>Updates the system&#x27;s configuration or DNS entries to point clients to the new master.</li></ul></li><li><strong>Notification:</strong><ul><li>Administrators are notified of the master failure and recovery actions taken.</li></ul></li></ul><h3 class="content-header" id="question-what-will-happen-when-a-user-sends-a-write-operation-to-the-gfs-and-the-server-receives-the-request-but-hasnt-executed-it-yet"><a class="break-words" href="#question-what-will-happen-when-a-user-sends-a-write-operation-to-the-gfs-and-the-server-receives-the-request-but-hasnt-executed-it-yet" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Question: What will happen when a user sends a <strong>write operation</strong> to the GFS and the server <strong>receives the request but hasn&#x27;t executed it yet?</strong></h3><p>In GFS, write operations go through multiple stages before they are committed. The steps typically include:</p><ol><li><strong>Client sends a write request</strong> to the master to identify which chunkservers hold replicas of the relevant chunk.</li><li>The <strong>master grants a lease</strong> to one of the chunk replicas, designating it as the <strong>primary chunkserver</strong> for that chunk.</li><li>The <strong>primary chunkserver orders the writes</strong> and forwards them to other replicas.</li><li><strong>Replicas acknowledge the write</strong>, and once the primary receives acknowledgments from all replicas, the write is considered complete.</li><li>After the primary receives all the acknowledgments from the secondaries, <strong>it sends a success confirmation directly to the client</strong>.</li></ol><blockquote><p>IMPORTANT: In <strong>Google File System (GFS)</strong>, the primary chunkserver does not send a confirmation message back to the <strong>master node</strong> after it receives acknowledgment from the other replicas for a write operation.</p></blockquote><p>The master is not involved in the step 5. The master’s role is limited to granting the lease and informing the client of the chunkservers that hold the replicas.</p><blockquote></blockquote><h3 class="content-header" id="question-what-happens-if-the-master-node-fails-between-step-1-and-step-2"><a class="break-words" href="#question-what-happens-if-the-master-node-fails-between-step-1-and-step-2" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Question: What happens if the <strong>master node fails</strong> between <strong>step 1</strong> and <strong>step 2</strong></h3><p>If the <strong>master node fails</strong> after the client has received the chunk locations and lease information (Step 1), but <strong>before the client sends data to the chunkservers</strong> (Step 2), the following key points apply:</p><h4 class="content-header" id="1-the-master-is-no-longer-involved-in-the-write-operation"><a class="break-words" href="#1-the-master-is-no-longer-involved-in-the-write-operation" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>1. <strong>The Master Is No Longer Involved in the Write Operation:</strong></h4><ul><li>After the client has received the chunkserver locations and the lease information, <strong>the master node&#x27;s job is done</strong> for this particular write request. The client already knows:<ul><li>Which chunkserver is the <strong>primary</strong>.</li><li>Which chunkservers are holding the <strong>replicas</strong>.</li></ul></li><li>The <strong>write operation</strong> itself does not require further communication with the master at this point, as the client directly communicates with the chunkservers.</li></ul><p><strong>Effect:</strong></p><p>The failure of the master node will not immediately impact the write operation, as the client has all the information it needs to proceed.</p><h4 class="content-header" id="2-client-sends-data-to-chunkservers-as-usual"><a class="break-words" href="#2-client-sends-data-to-chunkservers-as-usual" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>2. <strong>Client Sends Data to Chunkservers as Usual:</strong></h4><ul><li>The client will proceed with <strong>Step 2</strong>, which involves sending the data to the <strong>primary chunkserver</strong> and the secondary replicas.</li><li>The <strong>primary chunkserver</strong> will still coordinate the write operation and forward it to the secondaries. Once the primary receives acknowledgments from the replicas, it will send a confirmation back to the client.</li></ul><p><strong>Effect:</strong></p><p>The write operation can still proceed normally without the master being online, provided that the lease is still valid and the chunkservers involved in the write are functional.</p><h4 class="content-header" id="3-lease-expiration-and-the-role-of-the-master"><a class="break-words" href="#3-lease-expiration-and-the-role-of-the-master" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>3. <strong>Lease Expiration and the Role of the Master:</strong></h4><ul><li>The lease granted by the master to the <strong>primary chunkserver</strong> has a <strong>limited duration</strong> (typically 60 seconds). During this period, the primary chunkserver is authorized to handle writes for that chunk.</li><li>Since the master node is down, the lease cannot be <strong>renewed</strong> if it expires, and the master won&#x27;t be able to <strong>grant new leases</strong> for subsequent writes to that chunk until it recovers.</li></ul><p><strong>Effect:</strong></p><ul><li>The current write can proceed as long as the lease is valid and hasn&#x27;t expired.</li><li>If the lease expires during or after the write, any subsequent write requests to the same chunk will fail until the master node recovers and can issue a new lease.</li></ul><h4 class="content-header" id="4-client-side-impact-if-the-write-completes-successfully"><a class="break-words" href="#4-client-side-impact-if-the-write-completes-successfully" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>4. <strong>Client-Side Impact If the Write Completes Successfully:</strong></h4><ul><li>If the write completes successfully (i.e., the primary chunkserver receives acknowledgments from all secondary replicas), the <strong>client receives a confirmation</strong> directly from the primary.</li><li>The master is not needed to confirm that the write was successful, so the client will not experience an issue unless there is a further problem (e.g., a failure of the primary chunkserver).</li></ul><p><strong>Effect:</strong></p><p>The client will receive a confirmation of success even though the master is down, assuming the write completes before the lease expires.</p><h4 class="content-header" id="5-what-if-the-write-fails-chunkserver-failure-or-lease-expiry"><a class="break-words" href="#5-what-if-the-write-fails-chunkserver-failure-or-lease-expiry" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>5. <strong>What If the Write Fails (Chunkserver Failure or Lease Expiry)?</strong></h4><ul><li>If, during the process, the <strong>primary chunkserver</strong> or one of the <strong>secondary replicas</strong> fails, the client will not receive a confirmation that the write succeeded.</li><li>If the <strong>lease expires</strong> while the master is down, the write will not be retried by the client automatically, as the lease would need to be renewed by the master.</li><li>In these cases, the client may retry the write after a timeout, but the write will not succeed until the master node is back online to handle lease management.</li></ul><p><strong>Effect:</strong></p><p>If any failures occur in the chunkservers or the lease expires, the client’s write operation will fail. The client will have to retry after the master recovers and issues a new lease.</p><h4 class="content-header" id="conclusion"><a class="break-words" href="#conclusion" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Conclusion</h4><ul><li><strong>The write operation can proceed</strong> even if the master node fails, as the client already has the necessary lease and chunkserver information to complete the write.</li><li><strong>The master is not involved in the actual write operation</strong>, so its failure does not immediately affect the success of the write, as long as the lease is still valid.</li><li>If the <strong>lease expires</strong> or a <strong>chunkserver failure</strong> occurs before the write completes, the client will need to retry the operation after the master recovers.</li><li>Once the master recovers, it will reestablish leases, check for stale replicas, and allow any failed operations to be retried.</li></ul><h3 class="content-header" id="question-does-masternode-track-content-changes-in-chunkservers"><a class="break-words" href="#question-does-masternode-track-content-changes-in-chunkservers" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Question: Does masternode track content changes in chunkservers?</h3><p>No, the <strong>master node</strong> in <strong>Google File System (GFS)</strong> does <strong>not track the actual content changes</strong> to a file or directly log every modification made by clients. Instead, the master’s role is primarily focused on <strong>metadata management</strong>, which includes tasks such as maintaining the file-to-chunk mappings, granting leases for write operations, and managing chunk replication.</p><h3 class="content-header" id="question-but-the-masternode-has-append-data-logs-are-they-write-operations-that-masternode-stored"><a class="break-words" href="#question-but-the-masternode-has-append-data-logs-are-they-write-operations-that-masternode-stored" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Question: But the masternode has <code>Append Data</code> logs, are they write operations that masternode stored?</h3><p><strong>Append Data</strong> is indeed a <strong>write operation</strong>, but there&#x27;s a key distinction in how <strong>append</strong> operations are handled by the <strong>master node</strong> in GFS compared to regular writes.</p><p>The append process involves several key steps that include the master node, but the role of the master is limited to <strong>metadata management</strong>, not tracking the exact data being written.</p><h4 class="content-header" id="step-1-client-requests-the-chunk-locations"><a class="break-words" href="#step-1-client-requests-the-chunk-locations" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>Step 1: Client Requests the Chunk Locations</strong></h4><ul><li>When a client initiates an append operation, it sends a request to the <strong>master node</strong> for the location of the <strong>last chunk</strong> in the file.</li><li>The master responds with the list of chunkservers that hold replicas of the last chunk.</li></ul><h4 class="content-header" id="step-2-check-for-chunk-space"><a class="break-words" href="#step-2-check-for-chunk-space" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>Step 2: Check for Chunk Space</strong></h4><ul><li>The <strong>primary chunkserver</strong> (for the last chunk) checks if there is enough space in the chunk to accommodate the append operation.<ul><li>If there <strong>is space</strong>, the primary handles the append, and the data is written.</li><li>If there is <strong>no space</strong> (because GFS chunks are fixed-size, typically 64MB), the client will need to request a new chunk from the master.</li></ul></li></ul><h4 class="content-header" id="step-3-new-chunk-allocation-if-necessary"><a class="break-words" href="#step-3-new-chunk-allocation-if-necessary" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>Step 3: New Chunk Allocation (If Necessary)</strong></h4><ul><li>If a new chunk is required, the client asks the <strong>master</strong> to allocate a new chunk.<ul><li>The master logs the creation of the new chunk and updates the file&#x27;s chunk list in its metadata.</li></ul></li></ul><h4 class="content-header" id="step-4-append-to-the-chunk"><a class="break-words" href="#step-4-append-to-the-chunk" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>Step 4: Append to the Chunk</strong></h4><ul><li>The client sends the data to the chunkservers, and the <strong>primary chunkserver</strong> assigns a serial order to the write and forwards the data to the <strong>secondary replicas</strong>.</li><li>Once all replicas have acknowledged the append, the primary confirms the success of the operation to the client.</li></ul><h3 class="content-header" id="question-what-happens-if-the-master-node-is-down-when-the-client-needs-a-new-chunk"><a class="break-words" href="#question-what-happens-if-the-master-node-is-down-when-the-client-needs-a-new-chunk" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Question: What Happens If the Master Node Is Down When the Client Needs a New Chunk?</h3><ul><li><strong>The client cannot create a new chunk without the master node</strong> because the master is responsible for allocating chunks and assigning chunkservers to store replicas.</li><li>If the master node is down, the client’s request to create a new chunk will fail, and the client will <strong>retry</strong> the operation until the master node recovers.</li><li>The system will be in a <strong>blocked state</strong> for any new chunk creation or append operations that require additional space until the master node is back online and able to process chunk allocation requests.</li></ul><h3 class="content-header" id="question-what-happens-if-the-primary-chunkserver-fails-after-step-1"><a class="break-words" href="#question-what-happens-if-the-primary-chunkserver-fails-after-step-1" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Question: What Happens If the Primary Chunkserver Fails after Step 1</h3><ol><li><strong>Client Tries to Write to the Primary</strong>:<ul><li>The client attempts to send the write or append operation to the <strong>primary chunkserver</strong>, but since the primary is down, the client will not receive an acknowledgment from the primary or the secondary replicas.</li><li>After a <strong>timeout period</strong>, the client will retry the write operation.</li></ul></li><li><strong>Client Recognizes the Primary Is Unresponsive</strong>:<ul><li>The client will attempt to communicate with the primary chunkserver multiple times, but if it detects that the <strong>primary is unresponsive</strong> (e.g., after retrying a few times or after the network connection fails), it recognizes that the write cannot proceed.</li></ul></li><li><strong>Client Recontacts the Master</strong>:<ul><li>Once the client detects that the <strong>primary chunkserver is down</strong>, it contacts the <strong>master node</strong> to report the failure.</li><li>The client essentially asks the master to check the lease and potentially designate a new primary chunkserver.</li></ul></li><li><strong>Master Node Detects Primary Failure</strong>:<ul><li>The <strong>master node</strong>, through its regular <strong>heartbeat messages</strong> with the chunkservers, will likely have already detected that the <strong>primary chunkserver has failed</strong>.</li><li>Once the failure is confirmed, the master <strong>revokes the lease</strong> from the failed primary.</li></ul></li><li><strong>Master Reassigns a New Primary</strong>:<ul><li>The master node selects one of the <strong>secondary replicas</strong> and assigns it as the new <strong>primary chunkserver</strong>.</li><li>The master then notifies the client of the new primary chunkserver and updates the lease information.</li></ul></li><li><strong>Client Retries the Write with the New Primary</strong>:<ul><li>After receiving the information about the <strong>new primary chunkserver</strong>, the client <strong>retries the write operation</strong>.</li><li>The new primary chunkserver takes over the responsibility of ordering the writes and coordinating with the other replicas to ensure consistency.</li></ul></li></ol><h3 class="content-header" id="question-what-happens-if-the-primary-chunkserver-fails-between-step-3-and-step-4"><a class="break-words" href="#question-what-happens-if-the-primary-chunkserver-fails-between-step-3-and-step-4" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>Question: What Happens If the Primary Chunkserver Fails Between Step 3 and Step 4?</strong></h3><p>If the <strong>primary chunkserver</strong> fails after it has ordered the write and forwarded it to the secondaries (Step 3) but <strong>before receiving acknowledgments</strong> from all secondary chunkservers (Step 4), the system will follow a well-defined failure recovery process.</p><p>Here’s what happens in detail:</p><h4 class="content-header" id="1-secondary-chunkservers-are-waiting-for-confirmation"><a class="break-words" href="#1-secondary-chunkservers-are-waiting-for-confirmation" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>1. Secondary Chunkservers Are Waiting for Confirmation</strong></h4><ul><li>After the <strong>primary chunkserver</strong> forwards the write to the secondary chunkservers, the secondaries apply the write and send back an acknowledgment to the primary.</li><li>However, in this scenario, the <strong>primary chunkserver fails</strong> before receiving acknowledgments from the secondaries.</li></ul><h4 class="content-header" id="2-secondary-chunkservers-cannot-confirm-write-completion"><a class="break-words" href="#2-secondary-chunkservers-cannot-confirm-write-completion" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>2. Secondary Chunkservers Cannot Confirm Write Completion</strong></h4><ul><li>Since the primary chunkserver has failed, the <strong>secondary chunkservers</strong> are unable to confirm the successful completion of the write. They can apply the write to their local data, but the final confirmation to the client cannot be sent, as this requires coordination from the primary.</li></ul><h4 class="content-header" id="3-client-does-not-receive-write-confirmation"><a class="break-words" href="#3-client-does-not-receive-write-confirmation" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>3. Client Does Not Receive Write Confirmation</strong></h4><ul><li>The <strong>client</strong> is waiting for a confirmation from the primary chunkserver that the write was successful. Since the primary chunkserver has failed and cannot send this confirmation, the client will <strong>timeout</strong> after waiting for a response.</li><li>Once the client <strong>times out</strong>, it will retry the write operation, but before retrying, it will need to verify the state of the primary chunkserver and ensure that it is communicating with the correct chunkserver.</li></ul><h4 class="content-header" id="4-master-node-detects-primary-failure"><a class="break-words" href="#4-master-node-detects-primary-failure" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>4. Master Node Detects Primary Failure</strong></h4><ul><li>The <strong>master node</strong> detects the failure of the primary chunkserver through its <strong>heartbeat mechanism</strong>. The master sends periodic heartbeats to all chunkservers to ensure they are alive.</li><li>Upon detecting the failure, the master will <strong>revoke the lease</strong> from the failed primary chunkserver and <strong>assign a new primary</strong> from the remaining secondary replicas.</li></ul><h4 class="content-header" id="5-master-assigns-a-new-primary-chunkserver"><a class="break-words" href="#5-master-assigns-a-new-primary-chunkserver" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>5. Master Assigns a New Primary Chunkserver</strong></h4><ul><li>The master promotes one of the <strong>secondary chunkservers</strong> (which already has the data) to the role of the <strong>new primary</strong> chunkserver.</li><li>The master also updates the <strong>lease information</strong> to reflect the new primary and informs the client about the new primary chunkserver.</li></ul><h4 class="content-header" id="6-client-retries-the-write-operation-with-the-new-primary"><a class="break-words" href="#6-client-retries-the-write-operation-with-the-new-primary" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>6. Client Retries the Write Operation with the New Primary</strong></h4><ul><li>Once the client is aware that the <strong>primary has changed</strong>, it will <strong>retry the write operation</strong> with the new primary chunkserver.</li><li>Since the secondaries already have the data (from Step 3), the new primary will ensure that any partially applied write data is completed and that all replicas remain consistent.</li></ul><h4 class="content-header" id="7-consistency-and-data-recovery"><a class="break-words" href="#7-consistency-and-data-recovery" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>7. Consistency and Data Recovery</strong></h4><h5 class="content-header" id="handling-incomplete-writes"><a class="break-words" href="#handling-incomplete-writes" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>Handling Incomplete Writes</strong>:</h5><ul><li><p><strong>Version Numbers</strong>: GFS uses <strong>version numbers</strong> for each chunk to track consistency between replicas. When a write operation is initiated, the primary increments the chunk’s version number. If the new primary chunkserver detects that one of the replicas has an older version of the chunk (because it didn’t complete the write), the system will flag that replica as <strong>stale</strong> and initiate re-replication.</p><p><strong>Example:</strong></p><ul><li>The failed primary sent the write to all secondaries, but one of the secondaries failed to fully apply the write.</li><li>The new primary will check the version numbers of the replicas and detect if any of the replicas have a <strong>stale version</strong> of the chunk.</li><li>The master initiates <strong>re-replication</strong> to bring all replicas up to the current version of the chunk.</li></ul></li></ul><h5 class="content-header" id="atomicity-of-writes"><a class="break-words" href="#atomicity-of-writes" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>Atomicity of Writes</strong>:</h5><ul><li>If the write operation was not fully completed by the time the primary failed, the system ensures <strong>atomicity</strong>. That is, the write is either fully completed across all replicas or it is discarded, and the client retries the operation.</li><li>The new primary ensures that the operation is applied correctly and that no incomplete or inconsistent data remains.</li></ul><h3 class="content-header" id="primary-election-procedure-during-write-request"><a class="break-words" href="#primary-election-procedure-during-write-request" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Primary Election procedure during write request</h3><ol><li>No primary</li><li>Find the most up-to-date replicas → Compare the version number in the chunk handler(on master) with the version number of each chunk server → Wait until find a up-to-date replica</li><li>Pick new replicas as primary, secondary chunk servers</li><li>Master Increment Version Number → Chunk servers store new Version Number</li><li>Master gives the lease to the primary</li><li>Master write the Version Number to the disk</li></ol><h3 class="content-header" id="question-how-to-ensure-that-the-system-time-on-all-the-chunk-server-are-the-same-if-not-how-can-we-make-sure-there-is-no-two-primary-which-both-hold-the-lease-and-think-that-they-are-both-the-primary-servers"><a class="break-words" href="#question-how-to-ensure-that-the-system-time-on-all-the-chunk-server-are-the-same-if-not-how-can-we-make-sure-there-is-no-two-primary-which-both-hold-the-lease-and-think-that-they-are-both-the-primary-servers" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Question: How to ensure that the system time on all the chunk server are the same? If not, how can we make sure there is no two primary which both hold the lease and think that they are both the primary servers?</h3><p>That&#x27;s the key safeguard in <strong>Google File System (GFS)</strong>—the <strong>primary chunkserver</strong> (A in this case) doesn’t act alone. Whenever a client sends a write request to the primary, the primary chunkserver (A) must replicate that write to the <strong>secondary chunkservers</strong>. This replication process plays a crucial role in preventing conflicting primary chunkservers, especially in scenarios like <strong>time skew</strong>.</p><p>So even though, there might be a time period that both chunk server A and B are thinking that they are all the primary chunk servers, however, when the old primary A sends write requests to the secondary servers, A will realize the lease has already expired.</p><h3 class="content-header" id="question-will-the-new-primary-chunk-server-b-latest-data-at-offset-100-ask-other-secondary-chunk-servers-latest-data-at-offset-200-to-overwrite-inconsistent-data-at-offset-100"><a class="break-words" href="#question-will-the-new-primary-chunk-server-b-latest-data-at-offset-100-ask-other-secondary-chunk-servers-latest-data-at-offset-200-to-overwrite-inconsistent-data-at-offset-100" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Question: Will the new primary chunk server B (latest data at offset 100) ask other secondary chunk servers (latest data at offset 200) to overwrite inconsistent data at offset 100?</h3><p>I think Yes. (Not sure, it is not explained in the paper)</p><ul><li>Before <strong>chunkserver B</strong> (the new primary) starts writing data, it communicates with all the <strong>secondary replicas</strong> (including chunkserver A) to ensure the system is in a <strong>consistent state</strong>.</li><li>This process involves verifying the current <strong>chunk version number</strong> and the <strong>offset</strong> at which the most recent successful write occurred.</li><li><strong>Chunkserver A</strong>, as a secondary now, would report the state of the data it holds. If A had previously written data at offset 100, this information would be part of the state verification.</li><li>If chunkserver A had written data at offset 100 but it wasn’t fully replicated and acknowledged before its lease expired, that data is considered <strong>uncommitted</strong> and effectively invalid.</li><li>When <strong>chunkserver B</strong> takes over and starts writing from offset 50, the data at offset 100 on chunkserver A is <strong>ignored</strong> and treated as <strong>stale</strong>.</li><li><strong>Chunkserver A</strong> will overwrite its stale data at offset 100 with new data as soon as chunkserver B reaches and writes to that offset.</li></ul><h3 class="content-header" id="question-how-does-gfs-chunk-server-handle-write-failure"><a class="break-words" href="#question-how-does-gfs-chunk-server-handle-write-failure" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Question: How does GFS chunk server handle write failure?</h3><h4 class="content-header" id="duplicated-data-in-gfs"><a class="break-words" href="#duplicated-data-in-gfs" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Duplicated Data in GFS:</h4><ul><li>In <strong>GFS</strong>, the system is designed to handle potential <strong>partial writes</strong> or <strong>write failures</strong>. If a write request is interrupted (e.g., due to a network issue or client failure) after some data has already been written to the chunk, but before the client receives confirmation, the client may retry the write.</li><li>This retry could result in <strong>duplicate data</strong> being written to the chunk, but GFS is designed to <strong>append</strong> data rather than overwrite it. So even if the same data is written again, it will be added to the end of the chunk, leading to <strong>duplicated writes</strong> at different positions.</li></ul><h4 class="content-header" id="handling-duplicate-writes"><a class="break-words" href="#handling-duplicate-writes" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Handling Duplicate Writes:</h4><ul><li>GFS doesn&#x27;t automatically remove duplicate data because the file system is optimized for <strong>sequential appends</strong> rather than overwrites.</li><li>If duplication occurs, the client application or higher-level systems typically need to handle detecting and eliminating duplicates during data processing or reading.</li></ul><h4 class="content-header" id="frequency-of-duplicated-writes"><a class="break-words" href="#frequency-of-duplicated-writes" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Frequency of Duplicated Writes:</h4><ul><li>This situation is relatively uncommon in normal operation but can occur when there are <strong>network failures</strong> or <strong>timeouts</strong> during the writing process, causing the client to resend the write request. GFS ensures that, in case of failure, the system remains consistent, but the possibility of redundant data still exists due to retries.</li></ul><h3 class="content-header" id="question-how-does-gfs-handle-duplicated-data-or-padding"><a class="break-words" href="#question-how-does-gfs-handle-duplicated-data-or-padding" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Question: How does GFS handle duplicated data or padding?</h3><p>In <strong>Google File System (GFS)</strong>, the handling of <strong>duplicated data</strong> generated by failed write requests involves several key behaviors, but <strong>GFS itself does not automatically detect or mark duplicated data</strong> at the chunk server level. Here&#x27;s how the process generally works:</p><h4 class="content-header" id="1-client-or-library-awareness-of-duplicates"><a class="break-words" href="#1-client-or-library-awareness-of-duplicates" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>1. Client or Library Awareness of Duplicates:</h4><ul><li><strong>GFS clients or libraries are responsible</strong> for tracking the success of write requests.</li><li>If a write fails and the client retries, the <strong>client does not automatically know</strong> if the previous data was already successfully written to the chunk server. The client typically resends the write request, potentially causing duplicated data.</li><li>The GFS system is optimized for append operations, meaning that even if the same data is written twice, it will be appended rather than overwritten. Therefore, GFS itself <strong>does not recognize or remove</strong> duplicates within the chunk.</li></ul><h4 class="content-header" id="2-marking-duplicated-or-invalid-data"><a class="break-words" href="#2-marking-duplicated-or-invalid-data" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>2. Marking Duplicated or Invalid Data:</h4><ul><li>The <strong>chunk server does not explicitly mark duplicated or invalid data</strong> resulting from failed write requests.</li><li>GFS stores data in a <strong>sequential, append-only manner</strong>, meaning that even if a failed write results in duplicated data, it’s just written again without any indication in the chunk metadata that it is a duplicate.</li><li><strong>Duplicate data will exist as valid entries</strong> in the chunk unless explicitly removed or filtered by higher-level systems.</li></ul><h4 class="content-header" id="3-reading-data-from-the-chunk-server"><a class="break-words" href="#3-reading-data-from-the-chunk-server" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>3. Reading Data from the Chunk Server:</h4><ul><li>When the client reads data from a chunk, <strong>the chunk server sends back all the data</strong> in that chunk, including any duplicates caused by failed writes.</li><li>It is up to the <strong>client or application</strong> to manage and filter out duplicate data, if necessary, after retrieving it.</li><li>GFS itself <strong>does not differentiate</strong> between valid and duplicated data during the reading process. The chunk server treats all written data as valid unless explicitly deleted.</li></ul><h4 class="content-header" id="handling-duplicates-in-applications"><a class="break-words" href="#handling-duplicates-in-applications" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Handling Duplicates in Applications:</h4><ul><li>Many applications built on top of GFS are designed to work with <strong>append-only logs</strong>, where duplicates might not cause major issues. For applications where duplicated data could be problematic, the application layer must implement logic to:<ul><li><strong>Detect and filter duplicates</strong>.</li><li><strong>Validate data integrity</strong> using mechanisms like checksums, timestamps, or version numbers.</li></ul></li></ul><h3 class="content-header" id="question-how-does-the-gfs-handle-outdated-chunks"><a class="break-words" href="#question-how-does-the-gfs-handle-outdated-chunks" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Question: How does the GFS handle outdated chunks?</h3><h4 class="content-header" id="1-handling-stale-chunks"><a class="break-words" href="#1-handling-stale-chunks" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>1. <strong>Handling Stale Chunks</strong>:</h4><ul><li><strong>Stale chunks are not directly updated</strong>. Instead, the master treats stale replicas as <strong>invalid</strong> and <strong>ignores them</strong>. The master does not attempt to synchronize them with the latest version.</li><li>The master considers the stale replica to be non-existent during normal operations. It will not instruct clients to read from or write to stale replicas.</li></ul><h4 class="content-header" id="2-re-replication"><a class="break-words" href="#2-re-replication" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>2. <strong>Re-replication</strong>:</h4><ul><li>Once a stale replica is detected, the master triggers a <strong>re-replication process</strong> to ensure that the required number of valid replicas are available.</li><li>The master instructs a <strong>valid chunkserver</strong> (i.e., one with an up-to-date replica) to <strong>clone</strong> its chunk to another chunkserver.</li><li>This cloning creates a <strong>new, valid replica</strong> on a different chunkserver, bringing the number of replicas back to the desired replication level.</li></ul><h4 class="content-header" id="3-garbage-collection-of-stale-replicas"><a class="break-words" href="#3-garbage-collection-of-stale-replicas" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>3. <strong>Garbage Collection of Stale Replicas</strong>:</h4><ul><li>The master <strong>periodically removes stale replicas</strong> during <strong>garbage collection</strong>. These stale replicas are eventually deleted from the chunkservers to free up space.</li><li>Before garbage collection, the master effectively treats stale replicas as if they do not exist, meaning they are not part of the active replication set for any chunk.</li></ul><h3 class="content-header" id="question-what-does-incrementally-update-the-checksum-mean-how-does-the-checksum-work"><a class="break-words" href="#question-what-does-incrementally-update-the-checksum-mean-how-does-the-checksum-work" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Question: What Does &quot;Incrementally Update the Checksum&quot; Mean? How does the checksum work?</h3><p>When you <strong>append data</strong> to a chunk, the existing chunk may have a <strong>partial block</strong> at the end (a block that hasn&#x27;t been completely filled). Instead of recalculating the checksum for the entire block from scratch, GFS <strong>updates the existing checksum</strong> by processing only the <strong>newly appended data</strong>.</p><ul><li>GFS <strong>divides the data</strong> in each chunk into <strong>checksum blocks</strong> (typically 64 KB each).</li><li>Each checksum block has its own <strong>checksum value</strong>, which is stored separately from the data. When the data in a block changes, GFS updates the checksum for that specific block.</li><li>If you append data to a chunk, it will only affect the checksum of the <strong>last partial checksum block</strong> (if there is one) or create new checksum blocks for newly added data.</li><li><code>new checksum=func(old checksum,new data)</code></li></ul><h3 class="content-header" id="paper-reading"><a class="break-words" href="#paper-reading" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Paper reading:</h3><p><a class="break-words" href="/assets/gfs.pdf">GFS</a></p></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/distributed-systems">distributed-systems</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/systems">systems</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a class="break-words" href="/blog/programming-basic/programming-languages/late-static-binding">Late Static Binding</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a class="break-words" href="/blog/distributed-systems/algorithms/mapreduce">MapReduce</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" aria-label="Back to the projects" href="/blog">← Back to the projects</a></div></footer></div></div></article></section></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Bowen Y</div><div> • </div><div>© 2024</div><div> • </div><a class="break-words" href="/">CodeWisdom</a></div></div></footer></section><script src="/_next/static/chunks/webpack-8a3a6504f64badee.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/2d141e1a38819612-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/5beba742ae93b864.css\",\"style\"]\n3:HL[\"/_next/static/css/f719ff1083adf929.css\",\"style\"]\n4:HL[\"/_next/static/css/e36d2c8a31781d2e.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"5:I[5751,[],\"\"]\n8:I[9275,[],\"\"]\na:I[1343,[],\"\"]\nb:I[8700,[\"231\",\"static/chunks/231-42eeaa612179830e.js\",\"113\",\"static/chunks/113-8a0c0daa2bfc088c.js\",\"185\",\"static/chunks/app/layout-a7a2551425c87cc3.js\"],\"ThemeProviders\"]\nc:I[4080,[\"231\",\"static/chunks/231-42eeaa612179830e.js\",\"113\",\"static/chunks/113-8a0c0daa2bfc088c.js\",\"185\",\"static/chunks/app/layout-a7a2551425c87cc3.js\"],\"\"]\nd:I[9032,[\"231\",\"static/chunks/231-42eeaa612179830e.js\",\"113\",\"static/chunks/113-8a0c0daa2bfc088c.js\",\"185\",\"static/chunks/app/layout-a7a2551425c87cc3.js\"],\"KBarSearchProvider\"]\ne:I[231,[\"231\",\"static/chunks/231-42eeaa612179830e.js\",\"173\",\"static/chunks/173-af5b99c330035292.js\",\"459\",\"static/chunks/459-6c5dcdc51f43b997.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-5ad4d86948f7f0f4.js\"],\"\"]\nf:I[509,[\"231\",\"static/chunks/231-42eeaa612179830e.js\",\"113\",\"static/chunks/113-8a0c0daa2bfc088c.js\",\"185\",\"static/chunks/app/layout-a7a2551425c87cc3.js\"],\"KBarButton\"]\n10:I[1398,[\"231\",\"static/chunks/231-42eeaa612179830e.js\",\"113\",\"static/chunks/113-8a0c0daa2bfc088c.js\",\"185\",\"static/chunks/app/layout-a7a2551425c87cc3.js\"],\"default\"]\n11:I[8976,[\"231\",\"static/chunks/231-42eeaa612179830e.js\",\"113\",\"static/chunks/113-8a0c0daa2bfc088c.js\",\"185\",\"static/chunks/app/layout-a7a2551425c87cc3.js\"],\"default\"]\n13:I[6130,[],\"\"]\n9:[\"slug\",\"distributed-systems/systems/GFS\",\"c\"]\n14:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/5beba742ae93b864.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f719ff1083adf929.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"gPZ8ET5SZwyuIVWxpISNr\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/distributed-systems/systems/GFS\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"distributed-systems/systems/GFS\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"distributed-systems\\\",\\\"systems\\\",\\\"GFS\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"distributed-systems/systems/GFS\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L6\",\"$L7\"],null],null]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/e36d2c8a31781d2e.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]}],null]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"en-us\",\"className\":\"__variable_0aa4ae scroll-smooth\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"76x76\",\"href\":\"/static/favicons/logo-round.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/static/favicons/logo-round.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/static/favicons/logo-round.png\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/static/favicons/site.webmanifest\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#000000\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: light)\",\"content\":\"#fff\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: dark)\",\"content\":\"#000\"}],[\"$\",\"link\",null,{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"/feed.xml\"}],[\"$\",\"body\",null,{\"className\":\"bg-white pl-[calc(100vw-100%)] text-black antialiased dark:bg-gray-950 dark:text-white\",\"children\":[\"$\",\"$Lb\",null,{\"children\":[[\"$undefined\",\"$undefined\",\"$undefined\",[\"$\",\"$Lc\",null,{\"async\":true,\"defer\":true,\"data-website-id\":\"$undefined\",\"src\":\"https://analytics.umami.is/script.js\"}],\"$undefined\",\"$undefined\"],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[[\"$\",\"$Ld\",null,{\"kbarConfig\":{\"searchDocumentsPath\":\"/search.json\"},\"children\":[[\"$\",\"header\",null,{\"className\":\"flex items-center w-full bg-white dark:bg-gray-950 justify-between py-10\",\"children\":[[\"$\",\"$Le\",null,{\"className\":\"break-words\",\"href\":\"/\",\"aria-label\":\"CodeWisdom\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mr-3\",\"children\":[\"$\",\"img\",null,{\"src\":\"/_next/static/media/logo.a3d92d8f.png\",\"alt\":\"logo\",\"className\":\"h-10 w-14\"}]}],[\"$\",\"div\",null,{\"className\":\"hidden h-6 text-2xl font-semibold sm:block\",\"children\":\"CodeWisdom\"}]]}]}],[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-4 leading-5 sm:space-x-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"no-scrollbar hidden max-w-40 items-center space-x-4 overflow-x-auto sm:flex sm:space-x-6 md:max-w-72 lg:max-w-96\",\"children\":[[\"$\",\"$Le\",null,{\"className\":\"block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400\",\"href\":\"/blog\",\"children\":\"Blog\"}],[\"$\",\"$Le\",null,{\"className\":\"block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400\",\"href\":\"/tags\",\"children\":\"Tags\"}],[\"$\",\"$Le\",null,{\"className\":\"block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400\",\"href\":\"/projects\",\"children\":\"Projects\"}],[\"$\",\"$Le\",null,{\"className\":\"block font-medium text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400\",\"href\":\"/about\",\"children\":\"About\"}]]}],[\"$\",\"$Lf\",null,{\"aria-label\":\"Search\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"fill\":\"none\",\"viewBox\":\"0 0 24 24\",\"strokeWidth\":1.5,\"stroke\":\"currentColor\",\"className\":\"h-6 w-6 text-gray-900 hover:text-primary-500 dark:text-gray-100 dark:hover:text-primary-400\",\"children\":[\"$\",\"path\",null,{\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"d\":\"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z\"}]}]}],[\"$\",\"$L10\",null,{}],[\"$\",\"$L11\",null,{}]]}]]}],[\"$\",\"main\",null,{\"className\":\"mb-auto\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-start justify-start md:mt-24 md:flex-row md:items-center md:justify-center md:space-x-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"space-x-2 pb-8 pt-6 md:space-y-5\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-6xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 md:border-r-2 md:px-6 md:text-8xl md:leading-14\",\"children\":\"404\"}]}],[\"$\",\"div\",null,{\"className\":\"max-w-md\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-4 text-xl font-bold leading-normal md:text-2xl\",\"children\":\"Sorry we couldn't find this page.\"}],[\"$\",\"p\",null,{\"className\":\"mb-8\",\"children\":\"But dont worry, you can find plenty of other things on our homepage.\"}],[\"$\",\"$Le\",null,{\"className\":\"focus:shadow-outline-blue inline rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium leading-5 text-white shadow transition-colors duration-150 hover:bg-blue-700 focus:outline-none dark:hover:bg-blue-500\",\"href\":\"/\",\"children\":\"Back to homepage\"}]]}]]}],\"notFoundStyles\":[],\"styles\":null}]}]]}],[\"$\",\"footer\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"mt-16 flex flex-col items-center\",\"children\":[\"$\",\"div\",null,{\"className\":\"mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400\",\"children\":[[\"$\",\"div\",null,{\"children\":\"Bowen Y\"}],[\"$\",\"div\",null,{\"children\":\" • \"}],[\"$\",\"div\",null,{\"children\":\"© 2024\"}],[\"$\",\"div\",null,{\"children\":\" • \"}],[\"$\",\"$Le\",null,{\"className\":\"break-words\",\"href\":\"/\",\"children\":\"CodeWisdom\"}]]}]}]}]]}]]}]}]]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$L12\"],\"globalErrorComponent\":\"$13\",\"missingSlots\":\"$W14\"}]]\n"])</script><script>self.__next_f.push([1,"15:I[4347,[\"231\",\"static/chunks/231-42eeaa612179830e.js\",\"173\",\"static/chunks/173-af5b99c330035292.js\",\"459\",\"static/chunks/459-6c5dcdc51f43b997.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-5ad4d86948f7f0f4.js\"],\"default\"]\n16:I[8173,[\"231\",\"static/chunks/231-42eeaa612179830e.js\",\"173\",\"static/chunks/173-af5b99c330035292.js\",\"459\",\"static/chunks/459-6c5dcdc51f43b997.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-5ad4d86948f7f0f4.js\"],\"Image\"]\n17:I[408,[\"231\",\"static/chunks/231-42eeaa612179830e.js\",\"173\",\"static/chunks/173-af5b99c330035292.js\",\"459\",\"static/chunks/459-6c5dcdc51f43b997.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-5ad4d86948f7f0f4.js\"],\"default\"]\n"])</script><script>self.__next_f.push([1,"7:[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"GFS\\\",\\\"datePublished\\\":\\\"2024-10-31T00:00:00.000Z\\\",\\\"dateModified\\\":\\\"2024-10-31T00:00:00.000Z\\\",\\\"description\\\":\\\"Explores the GFS.\\\",\\\"image\\\":\\\"/static/images/logo-round.png\\\",\\\"url\\\":\\\"https://codewisdom.io/blog/distributed-systems/systems/GFS\\\",\\\"author\\\":[{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Bowen Y\\\"}]}\"}}],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[[\"$\",\"$L15\",null,{}],[\"$\",\"article\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700\",\"children\":[[\"$\",\"header\",null,{\"className\":\"pt-6 xl:pb-6\",\"children\":[\"$\",\"div\",null,{\"className\":\"space-y-1 text-center\",\"children\":[[\"$\",\"dl\",null,{\"className\":\"space-y-10\",\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Published on\"}],[\"$\",\"dd\",null,{\"className\":\"text-base font-medium leading-6 text-gray-500 dark:text-gray-400\",\"children\":[\"$\",\"time\",null,{\"dateTime\":\"2024-10-31T00:00:00.000Z\",\"children\":\"Wednesday, October 30, 2024\"}]}]]}]}],[\"$\",\"div\",null,{\"children\":[\"$\",\"h1\",null,{\"className\":\"text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14\",\"children\":\"GFS\"}]}]]}]}],[\"$\",\"div\",null,{\"className\":\"grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0\",\"children\":[[\"$\",\"dl\",null,{\"className\":\"pb-10 pt-6 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700\",\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Authors\"}],[\"$\",\"dd\",null,{\"children\":[\"$\",\"ul\",null,{\"className\":\"flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8\",\"children\":[[\"$\",\"li\",\"Bowen Y\",{\"className\":\"flex items-center space-x-2\",\"children\":[[\"$\",\"$L16\",null,{\"src\":\"/static/images/pixel-avatar.png\",\"width\":38,\"height\":38,\"alt\":\"avatar\",\"className\":\"h-10 w-10 rounded-full\"}],[\"$\",\"dl\",null,{\"className\":\"whitespace-nowrap text-sm font-medium leading-5\",\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Name\"}],[\"$\",\"dd\",null,{\"className\":\"text-gray-900 dark:text-gray-100\",\"children\":\"Bowen Y\"}],[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Twitter\"}],[\"$\",\"dd\",null,{\"children\":\"$undefined\"}]]}]]}]]}]}]]}],[\"$\",\"div\",null,{\"className\":\"divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0\",\"children\":[\"$\",\"div\",null,{\"className\":\"prose max-w-none pb-8 pt-10 dark:prose-invert\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"gfs\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#gfs\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"GFS\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"key-features\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#key-features\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Key Features\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"The primary checks to see if appending the record to the current chunk would cause the chunk to exceed the maximum size (64 MB). If so, it pads the chunk to the maximum size\"}],[\"$\",\"li\",null,{\"children\":\"Record append is restricted to be at most one-fourth of the maximum chunk size\"}],[\"$\",\"li\",null,{\"children\":\"GFS does not guarantee that all replicas are bytewise identical. It only guarantees that the data is written at least once as an atomic unit.\"}],[\"$\",\"li\",null,{\"children\":\"Like AFS, GFS uses standard copy-on-write techniques to implement snapshots. The newly created snapshot ﬁles point to the same chunks as the source ﬁles until clients send new write requests.\"}],[\"$\",\"li\",null,{\"children\":[\"Each master operation acquires a set of locks before it runs. Typically, if it involves \",[\"$\",\"code\",null,{\"children\":\"/d1/d2/.../dn/leaf\"}],\", it will acquire read-locks on the directory names \",[\"$\",\"code\",null,{\"children\":\"/d1\"}],\", \",[\"$\",\"code\",null,{\"children\":\"/d1/d2\"}],\", ..., \",[\"$\",\"code\",null,{\"children\":\"/d1/d2/.../dn\"}],\", and either a read lock or a write lock on the full pathname \",[\"$\",\"code\",null,{\"children\":\"/d1/d2/.../dn/leaf\"}],\".\"]}],[\"$\",\"li\",null,{\"children\":\"After a ﬁle is deleted, GFS does not immediately reclaim the available physical storage. It does so only lazily during regular garbage collection at both the ﬁle and chunk levels.\"}],[\"$\",\"li\",null,{\"children\":\"Instead of reclaiming resources immediately, the ﬁle is just renamed to a hidden name that includes the deletion timestamp.\"}],[\"$\",\"li\",null,{\"children\":\"In a similar regular scan of the chunk namespace, the master identiﬁes orphaned chunks (i.e., those not reachable from any ﬁle) and erases the metadata for those chunks.\"}],[\"$\",\"li\",null,{\"children\":\"Each chunkserver uses checksumming to detect corruption of stored data.\"}]]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"metadata-stored-on-the-master-node\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#metadata-stored-on-the-master-node\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"Metadata Stored on the Master Node\"}]]}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"File-to-Chunk Mapping (Namespace):\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The \",[\"$\",\"strong\",null,{\"children\":\"file namespace\"}],\" in GFS is similar to a traditional file system’s directory structure. Files are identified by their full pathnames.\"]}],[\"$\",\"li\",null,{\"children\":[\"For each file, the master stores a mapping of the file name to an \",[\"$\",\"strong\",null,{\"children\":\"array of chunk handles\"}],\". Each chunk handle corresponds to a 64 MB chunk of the file.\",[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Example:\"}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":[\"A file like \",[\"$\",\"code\",null,{\"children\":\"/data/logs/logfile.txt\"}],\" could map to chunk handles [chunkHandle1, chunkHandle2, chunkHandle3], where each handle represents a 64 MB chunk of the file.\"]}]}]]}]}]]}],[\"$\",\"li\",null,{\"children\":\"This structure allows the master to keep track of which file corresponds to which chunks, facilitating data location and retrieval.\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Chunk Handle Information:\"}]}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":[\"Each chunk handle in the array contains several key pieces of metadata that describe the state and location of the chunk in the system:\",[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"List of Chunkservers:\"}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":[\"The master keeps a list of \",[\"$\",\"strong\",null,{\"children\":\"chunkservers\"}],\" that store replicas of the chunk. This list allows the master to direct clients to specific chunkservers for reading or writing.\"]}]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Chunk Version Number:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The \",[\"$\",\"strong\",null,{\"children\":\"version number\"}],\" of the chunk is critical for ensuring data consistency. If a chunkserver goes down and misses some updates (mutations), its version number will lag behind the up-to-date replicas. When the chunkserver comes back online, the master uses the version number to detect if the chunk is \",[\"$\",\"strong\",null,{\"children\":\"stale\"}],\" and to prevent stale data from being used.\"]}],[\"$\",\"li\",null,{\"children\":\"The master increments the version number whenever a new lease is granted for the chunk to ensure all replicas are synchronized.\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Primary Chunkserver:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"For each chunk, the master identifies which \",[\"$\",\"strong\",null,{\"children\":\"chunkserver is the primary\"}],\" for mutation (write) operations. The primary is responsible for ordering writes and ensuring consistency across replicas.\"]}],[\"$\",\"li\",null,{\"children\":[\"The \",[\"$\",\"strong\",null,{\"children\":\"primary\"}],\" is selected when a client writes to the chunk, and this information is cached by the client to avoid repeated interactions with the master.\"]}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Lease Expiration Time:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The master grants a \",[\"$\",\"strong\",null,{\"children\":\"lease\"}],\" to one of the chunk replicas (the primary) for coordinating writes. The lease ensures that all mutations to the chunk are ordered consistently. Leases typically last for \",[\"$\",\"strong\",null,{\"children\":\"60 seconds\"}],\", but they can be extended as long as the chunk is being actively written.\"]}],[\"$\",\"li\",null,{\"children\":[\"The master tracks the \",[\"$\",\"strong\",null,{\"children\":\"lease expiration\"}],\" time, and if the lease expires or needs to be revoked (e.g., for a snapshot operation), the master will update the lease information.\"]}]]}]]}]]}]]}]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Replication Information:\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"For each chunk, the master stores information about the \",[\"$\",\"strong\",null,{\"children\":\"replication level\"}],\" (default is three replicas) and the \",[\"$\",\"strong\",null,{\"children\":\"current locations of the replicas\"}],\" (the chunkservers storing them). This allows the master to:\",[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"Ensure that the correct number of replicas are maintained.\"}],[\"$\",\"li\",null,{\"children\":\"Respond to client requests by directing them to the appropriate chunkservers holding valid replicas of a chunk.\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[\"If a chunk becomes under-replicated (due to a chunkserver failure), the master initiates a \",[\"$\",\"strong\",null,{\"children\":\"re-replication process\"}],\" by copying the chunk to other chunkservers.\"]}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Chunk Placement and Load Balancing:\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The master keeps track of how chunks are distributed across chunkservers. It uses this information to make \",[\"$\",\"strong\",null,{\"children\":\"chunk placement decisions\"}],\" (e.g., when creating a new chunk) to ensure that chunks are evenly spread across different machines and racks for both performance and reliability.\"]}],[\"$\",\"li\",null,{\"children\":[\"The master periodically \",[\"$\",\"strong\",null,{\"children\":\"rebalances\"}],\" chunk replicas if it detects that some chunkservers are overloaded or underutilized.\"]}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Operation Log:\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The master maintains an \",[\"$\",\"strong\",null,{\"children\":\"operation log\"}],\" of all critical metadata updates (file creations, deletions, chunk allocations, etc.). This log is \",[\"$\",\"strong\",null,{\"children\":\"persisted\"}],\" on the master’s local disk and \",[\"$\",\"strong\",null,{\"children\":\"replicated\"}],\" on remote machines for fault tolerance.\"]}],[\"$\",\"li\",null,{\"children\":[\"The operation log serves as the \",[\"$\",\"strong\",null,{\"children\":\"only persistent record\"}],\" of metadata. In case of a failure, the master can recover by replaying the log.\"]}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Chunk Garbage Collection and Orphaned Chunks:\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The master keeps track of \",[\"$\",\"strong\",null,{\"children\":\"orphaned chunks\"}],\"—chunks that are no longer associated with any files (due to file deletions) and need to be garbage collected.\"]}],[\"$\",\"li\",null,{\"children\":[\"Orphaned chunks are identified through periodic \",[\"$\",\"strong\",null,{\"children\":\"namespace scans\"}],\", and the master informs chunkservers to delete them when they are no longer needed.\"]}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Checkpointing for Faster Recovery:\"}]}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":[\"To avoid replaying the entire operation log after a failure, the master periodically creates \",[\"$\",\"strong\",null,{\"children\":\"checkpoints\"}],\" of its in-memory metadata. These checkpoints are stored on disk and contain the latest version of the file namespace and chunk mapping.\"]}]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"how-the-master-uses-metadata\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#how-the-master-uses-metadata\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"How the Master Uses Metadata\"}]]}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"File Operations:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"When a client performs an operation like opening a file, the master consults its \",[\"$\",\"strong\",null,{\"children\":\"file-to-chunk mapping\"}],\" to find the relevant chunk handles.\"]}],[\"$\",\"li\",null,{\"children\":[\"For each chunk handle, the master retrieves the \",[\"$\",\"strong\",null,{\"children\":\"list of chunkservers\"}],\" storing replicas of the chunk and returns this information to the client.\"]}],[\"$\",\"li\",null,{\"children\":\"The master may update the metadata if new chunks are created or if the file is renamed or deleted.\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Reading Data:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The client first asks the master for the \",[\"$\",\"strong\",null,{\"children\":\"chunk locations\"}],\" corresponding to the file. The master retrieves the \",[\"$\",\"strong\",null,{\"children\":\"list of chunkservers\"}],\" storing the chunk replicas and directs the client to one of the chunkservers (typically the closest one based on network proximity).\"]}],[\"$\",\"li\",null,{\"children\":\"After this initial request, the client caches the chunk locations, reducing the load on the master for subsequent reads.\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Writing Data (Mutation Order):\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"For writes or record appends, the client requests the \",[\"$\",\"strong\",null,{\"children\":\"lease\"}],\" for the relevant chunk from the master. The master grants a lease to one of the replicas, making it the \",[\"$\",\"strong\",null,{\"children\":\"primary chunkserver\"}],\".\"]}],[\"$\",\"li\",null,{\"children\":[\"The \",[\"$\",\"strong\",null,{\"children\":\"primary chunkserver\"}],\" is responsible for serializing write operations, and it replicates the writes to other chunkservers in the order it receives them, ensuring that all replicas remain consistent.\"]}],[\"$\",\"li\",null,{\"children\":[\"The master keeps track of the \",[\"$\",\"strong\",null,{\"children\":\"lease expiration\"}],\" and \",[\"$\",\"strong\",null,{\"children\":\"primary status\"}],\" for each chunk, ensuring orderly writes and preventing conflicting operations.\"]}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Fault Detection and Recovery:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The master uses \",[\"$\",\"strong\",null,{\"children\":\"heartbeat messages\"}],\" to continuously monitor the health of chunkservers. If a chunkserver becomes unavailable or reports a \",[\"$\",\"strong\",null,{\"children\":\"stale chunk\"}],\", the master uses the \",[\"$\",\"strong\",null,{\"children\":\"version number\"}],\" to detect which replicas are up-to-date and to initiate the necessary \",[\"$\",\"strong\",null,{\"children\":\"re-replication\"}],\" to restore the required number of replicas.\"]}],[\"$\",\"li\",null,{\"children\":[\"The master handles \",[\"$\",\"strong\",null,{\"children\":\"garbage collection\"}],\" by marking chunks that are no longer referenced in the namespace for deletion.\"]}]]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"master-recovery-mechanisms\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#master-recovery-mechanisms\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"Master Recovery Mechanisms\"}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"1-operation-log-and-checkpointing\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#1-operation-log-and-checkpointing\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"1. Operation Log and Checkpointing\"}]]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Operation Log:\"}]}],[\"$\",\"p\",null,{\"children\":[\"The \",[\"$\",\"strong\",null,{\"children\":\"operation log\"}],\" is a sequential record of all critical metadata changes in the system. Each entry records an operation that modifies the file system's state. The log entries might include operations like file creation, deletion, chunk creation, and replica updates.\"]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Example of Operation Log Entries:\"}]}],[\"$\",\"p\",null,{\"children\":\"Imagine the master node's operation log contains entries like the following (simplified for illustration):\"}],[\"$\",\"$L17\",null,{\"className\":\"language-yaml\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Timestamp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number datetime\",\"children\":\"2023-10-17 10:00:00\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Operation\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" Create File\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"File Path\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" /data/logs/logfile.txt\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Assigned Chunk Handles\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"CHUNK_001\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Timestamp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number datetime\",\"children\":\"2023-10-17 10:05:00\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Operation\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" Create Chunk\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Chunk Handle\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" CHUNK_001\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Replica Locations\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"ChunkServer1\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" ChunkServer2\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" ChunkServer3\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Timestamp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number datetime\",\"children\":\"2023-10-17 10:10:00\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Operation\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" Append Data\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"File Path\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" /data/logs/logfile.txt\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Chunk Handle\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" CHUNK_001\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Data Size\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" 64 MB\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Client ID\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" Client_123A\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Timestamp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number datetime\",\"children\":\"2023-10-17 10:15:00\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Operation\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" Create Chunk\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Chunk Handle\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" CHUNK_002\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Replica Locations\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"ChunkServer2\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" ChunkServer3\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" ChunkServer4\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Timestamp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number datetime\",\"children\":\"2023-10-17 10:20:00\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Operation\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" Delete File\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"File Path\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" /data/logs/oldlog.txt\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Timestamp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number datetime\",\"children\":\"2023-10-17 10:25:00\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Operation\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" Lease Granted\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Chunk Handle\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" CHUNK_002\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Primary ChunkServer\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" ChunkServer2\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Lease Expiration\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number datetime\",\"children\":\"2023-10-17 10:30:00\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":\"In this example:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"The master logs the creation of a new file and assigns it a chunk handle.\"}],[\"$\",\"li\",null,{\"children\":\"It records the creation of chunks and their replica locations.\"}],[\"$\",\"li\",null,{\"children\":\"Append operations are logged with details like file path, chunk handle, data size, and client ID.\"}],[\"$\",\"li\",null,{\"children\":\"Deletions and lease grants are also recorded with relevant details.\"}]]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Checkpointing:\"}]}],[\"$\",\"p\",null,{\"children\":[\"A \",[\"$\",\"strong\",null,{\"children\":\"checkpoint\"}],\" is a snapshot of the master node's in-memory metadata at a specific point in time. It includes the current state of the file system namespace, the mapping of files to chunks, chunk version numbers, lease information, and other necessary metadata.\"]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Example of a Checkpoint Content:\"}]}],[\"$\",\"$L17\",null,{\"className\":\"language-yaml\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Checkpoint Timestamp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number datetime\",\"children\":\"2023-10-17 10:30:00\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"File Namespace\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" /data/logs/logfile.txt\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Chunks\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"CHUNK_001\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" CHUNK_002\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" /data/logs/oldlog.txt (marked for deletion)\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Chunks\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"CHUNK_000\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Chunk Information\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" CHUNK_000\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Replica Locations\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"ChunkServer1\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" ChunkServer2\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" ChunkServer3\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Version\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" CHUNK_001\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Replica Locations\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"ChunkServer1\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" ChunkServer2\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" ChunkServer3\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Version\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" CHUNK_002\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Replica Locations\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"ChunkServer2\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" ChunkServer3\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" ChunkServer4\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Version\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Lease Info\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Primary\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" ChunkServer2\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Lease Expiration\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number datetime\",\"children\":\"2023-10-17 10:30:00\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Deleted Files\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" /data/logs/oldlog.txt\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Deletion Timestamp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number datetime\",\"children\":\"2023-10-17 10:20:00\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Pending Deletion after\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" 3 days (garbage collection)\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Additional Metadata\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Next Chunk Handle ID\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" CHUNK_003\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Active Leases\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" CHUNK_002\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Primary\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" ChunkServer2\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Lease Expiration\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number datetime\",\"children\":\"2023-10-17 10:30:00\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":\"The checkpoint captures:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"The file namespace and mappings to chunks.\"}],[\"$\",\"li\",null,{\"children\":\"Chunk information, including replica locations and version numbers.\"}],[\"$\",\"li\",null,{\"children\":\"Lease information for chunks with active leases.\"}],[\"$\",\"li\",null,{\"children\":\"Metadata about deleted files pending garbage collection.\"}],[\"$\",\"li\",null,{\"children\":\"A record of the next available chunk handle ID.\"}]]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Master Recovery Using Operation Log and Checkpoint:\"}]}],[\"$\",\"p\",null,{\"children\":\"When the master node needs to recover (e.g., after a failure), it performs the following steps:\"}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Load the Most Recent Checkpoint\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Replay the Operation Log\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Re-initialize State\"}]}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"2-replication-of-master-metadata\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#2-replication-of-master-metadata\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"2. Replication of Master Metadata\"}]]}],[\"$\",\"p\",null,{\"children\":\"To ensure durability and availability, the master replicates its operation log and checkpoints to multiple remote machines.\"}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Example of Replication Process:\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Operation Log Replication:\"}]}],[\"$\",\"p\",null,{\"children\":\"Each time the master appends a new entry to the operation log, it writes the entry to its local disk and sends it to multiple remote replicas.\"}],[\"$\",\"$L17\",null,{\"className\":\"language-markdown\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-markdown\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"Operation Log Entry Replication:\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation list\",\"children\":\"-\"}],\" Local Write: Append new log entry to local operation log file.\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation list\",\"children\":\"-\"}],\" Remote Replication:\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation list\",\"children\":\"-\"}],\" Send log entry to ReplicaServer1.\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation list\",\"children\":\"-\"}],\" Send log entry to ReplicaServer2.\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation list\",\"children\":\"-\"}],\" Confirmation: Wait for acknowledgments from replicas before considering the operation committed.\\n\"]}]]}]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Checkpoint Replication:\"}]}],[\"$\",\"p\",null,{\"children\":\"When the master creates a new checkpoint, it saves it locally and sends copies to replica servers.\"}],[\"$\",\"$L17\",null,{\"className\":\"language-markdown\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-markdown\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"Checkpoint Replication:\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation list\",\"children\":\"-\"}],\" Local Save: Write checkpoint file to local disk.\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation list\",\"children\":\"-\"}],\" Remote Replication:\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation list\",\"children\":\"-\"}],\" Send checkpoint file to ReplicaServer1.\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation list\",\"children\":\"-\"}],\" Send checkpoint file to ReplicaServer2.\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation list\",\"children\":\"-\"}],\" Confirmation: Verify successful receipt at replicas.\\n\"]}]]}]}]]}]]}],[\"$\",\"p\",null,{\"children\":\"This replication ensures that if the master node's local storage fails, a new master can be started using the replicated logs and checkpoints.\"}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"3-fast-recovery-of-the-master-node\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#3-fast-recovery-of-the-master-node\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"3. Fast Recovery of the Master Node\"}]]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Example of Master Recovery Steps:\"}]}],[\"$\",\"p\",null,{\"children\":\"Suppose the master node crashes at 10:35:00. Upon detection, the system initiates recovery:\"}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Startup:\"}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":\"A new master process is started on the same or a different machine.\"}]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Load Checkpoint:\"}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":\"The master loads the last checkpoint created at 10:30:00.\"}]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Replay Operation Log:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"p\",null,{\"children\":\"The master reads the operation log entries from 10:30:00 to 10:35:00.\"}]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":\"Example of entries to replay:\"}],[\"$\",\"$L17\",null,{\"className\":\"language-yaml\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Timestamp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number datetime\",\"children\":\"2023-10-17 10:31:00\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Operation\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" Append Data\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"File Path\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" /data/logs/logfile.txt\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Chunk Handle\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" CHUNK_002\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Data Size\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" 32 MB\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Client ID\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" Client_124\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Timestamp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number datetime\",\"children\":\"2023-10-17 10:33:00\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Operation\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" Lease Renewal\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Chunk Handle\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" CHUNK_002\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token atrule key\",\"children\":\"Lease Expiration\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number datetime\",\"children\":\"2023-10-17 10:38:00\"}],\"\\n\"]}]]}]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":\"The master applies these operations to update the in-memory metadata:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"Update chunk data for \",[\"$\",\"code\",null,{\"children\":\"CHUNK_002\"}],\".\"]}],[\"$\",\"li\",null,{\"children\":[\"Extend the lease expiration for \",[\"$\",\"code\",null,{\"children\":\"CHUNK_002\"}],\".\"]}]]}]]}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Communicate with Chunkservers:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"The master sends heartbeat messages to all chunkservers to collect the latest state of chunk replicas.\"}],[\"$\",\"li\",null,{\"children\":\"Chunkservers respond with their current chunk inventory, including any updates that occurred during the master's downtime.\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Update Chunk Replica Locations:\"}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":\"The master updates its metadata with the current locations of chunk replicas as reported by the chunkservers.\"}]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Resume Operations:\"}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":\"The master is now ready to handle client requests.\"}]}]]}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"4-shadow-masters-for-read-only-access\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#4-shadow-masters-for-read-only-access\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"4. Shadow Masters for Read-Only Access\"}]]}],[\"$\",\"p\",null,{\"children\":[\"While the primary master is recovering, \",[\"$\",\"strong\",null,{\"children\":\"shadow masters\"}],\" can provide read-only access to clients.\"]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Example of Shadow Master Functionality:\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The shadow master maintains a copy of the metadata by:\",[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"Periodically reading the replicated operation log and checkpoints.\"}],[\"$\",\"li\",null,{\"children\":\"Applying updates to its in-memory metadata structures.\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[\"During master downtime:\",[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"Clients can send read requests to the shadow master.\"}],[\"$\",\"li\",null,{\"children\":\"The shadow master uses its metadata to direct clients to chunkservers holding the requested data.\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Limitation:\"}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":\"Shadow masters cannot process metadata mutations (e.g., file creations, deletions, or writes) since they are not authorized to modify the file system state.\"}]}]]}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"5-client-resilience-to-master-failures\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#5-client-resilience-to-master-failures\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"5. Client Resilience to Master Failures\"}]]}],[\"$\",\"p\",null,{\"children\":\"Clients are designed to handle temporary master unavailability gracefully.\"}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Example of Client Behavior:\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Caching Metadata:\"}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":\"Clients cache file-to-chunk mappings and chunk replica locations.\"}]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Handling Master Unavailability:\"}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":[\"If the master is unavailable when a client needs to access metadata:\",[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"The client waits and retries the request after a short delay.\"}],[\"$\",\"li\",null,{\"children\":\"For read operations, if the client has cached metadata, it can continue accessing data directly from chunkservers.\"}]]}]]}]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Example Scenario:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"A client wants to read from \",[\"$\",\"code\",null,{\"children\":\"/data/logs/logfile.txt\"}],\".\"]}],[\"$\",\"li\",null,{\"children\":[\"The client has cached that \",[\"$\",\"code\",null,{\"children\":\"CHUNK_002\"}],\" is part of the file and knows the locations of its replicas.\"]}],[\"$\",\"li\",null,{\"children\":[\"The client sends a read request directly to one of the chunkservers holding \",[\"$\",\"code\",null,{\"children\":\"CHUNK_002\"}],\".\"]}],[\"$\",\"li\",null,{\"children\":\"If the client's cached metadata expires or is invalid (e.g., due to a chunkserver failure), and the master is down, the client waits until the master is back online to refresh the metadata.\"}]]}]]}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"6-fault-detection-and-monitoring\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#6-fault-detection-and-monitoring\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"6. Fault Detection and Monitoring\"}]]}],[\"$\",\"p\",null,{\"children\":\"External monitoring systems detect master failures and initiate recovery.\"}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Example of Monitoring Process:\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Heartbeat Monitoring:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"A monitoring service periodically sends heartbeat messages to the master.\"}],[\"$\",\"li\",null,{\"children\":\"If the master does not respond within a specified timeout, it is considered down.\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Automated Recovery Actions:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"The monitoring system starts a new master process on the same or a different machine.\"}],[\"$\",\"li\",null,{\"children\":\"Updates the system's configuration or DNS entries to point clients to the new master.\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Notification:\"}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":\"Administrators are notified of the master failure and recovery actions taken.\"}]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"question-what-will-happen-when-a-user-sends-a-write-operation-to-the-gfs-and-the-server-receives-the-request-but-hasnt-executed-it-yet\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#question-what-will-happen-when-a-user-sends-a-write-operation-to-the-gfs-and-the-server-receives-the-request-but-hasnt-executed-it-yet\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Question: What will happen when a user sends a \",[\"$\",\"strong\",null,{\"children\":\"write operation\"}],\" to the GFS and the server \",[\"$\",\"strong\",null,{\"children\":\"receives the request but hasn't executed it yet?\"}]]}],[\"$\",\"p\",null,{\"children\":\"In GFS, write operations go through multiple stages before they are committed. The steps typically include:\"}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Client sends a write request\"}],\" to the master to identify which chunkservers hold replicas of the relevant chunk.\"]}],[\"$\",\"li\",null,{\"children\":[\"The \",[\"$\",\"strong\",null,{\"children\":\"master grants a lease\"}],\" to one of the chunk replicas, designating it as the \",[\"$\",\"strong\",null,{\"children\":\"primary chunkserver\"}],\" for that chunk.\"]}],[\"$\",\"li\",null,{\"children\":[\"The \",[\"$\",\"strong\",null,{\"children\":\"primary chunkserver orders the writes\"}],\" and forwards them to other replicas.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Replicas acknowledge the write\"}],\", and once the primary receives acknowledgments from all replicas, the write is considered complete.\"]}],[\"$\",\"li\",null,{\"children\":[\"After the primary receives all the acknowledgments from the secondaries, \",[\"$\",\"strong\",null,{\"children\":\"it sends a success confirmation directly to the client\"}],\".\"]}]]}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":[\"IMPORTANT: In \",[\"$\",\"strong\",null,{\"children\":\"Google File System (GFS)\"}],\", the primary chunkserver does not send a confirmation message back to the \",[\"$\",\"strong\",null,{\"children\":\"master node\"}],\" after it receives acknowledgment from the other replicas for a write operation.\"]}]}],[\"$\",\"p\",null,{\"children\":\"The master is not involved in the step 5. The master’s role is limited to granting the lease and informing the client of the chunkservers that hold the replicas.\"}],[\"$\",\"blockquote\",null,{}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"question-what-happens-if-the-master-node-fails-between-step-1-and-step-2\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#question-what-happens-if-the-master-node-fails-between-step-1-and-step-2\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Question: What happens if the \",[\"$\",\"strong\",null,{\"children\":\"master node fails\"}],\" between \",[\"$\",\"strong\",null,{\"children\":\"step 1\"}],\" and \",[\"$\",\"strong\",null,{\"children\":\"step 2\"}]]}],[\"$\",\"p\",null,{\"children\":[\"If the \",[\"$\",\"strong\",null,{\"children\":\"master node fails\"}],\" after the client has received the chunk locations and lease information (Step 1), but \",[\"$\",\"strong\",null,{\"children\":\"before the client sends data to the chunkservers\"}],\" (Step 2), the following key points apply:\"]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"1-the-master-is-no-longer-involved-in-the-write-operation\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#1-the-master-is-no-longer-involved-in-the-write-operation\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"1. \",[\"$\",\"strong\",null,{\"children\":\"The Master Is No Longer Involved in the Write Operation:\"}]]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"After the client has received the chunkserver locations and the lease information, \",[\"$\",\"strong\",null,{\"children\":\"the master node's job is done\"}],\" for this particular write request. The client already knows:\",[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"Which chunkserver is the \",[\"$\",\"strong\",null,{\"children\":\"primary\"}],\".\"]}],[\"$\",\"li\",null,{\"children\":[\"Which chunkservers are holding the \",[\"$\",\"strong\",null,{\"children\":\"replicas\"}],\".\"]}]]}]]}],[\"$\",\"li\",null,{\"children\":[\"The \",[\"$\",\"strong\",null,{\"children\":\"write operation\"}],\" itself does not require further communication with the master at this point, as the client directly communicates with the chunkservers.\"]}]]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Effect:\"}]}],[\"$\",\"p\",null,{\"children\":\"The failure of the master node will not immediately impact the write operation, as the client has all the information it needs to proceed.\"}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"2-client-sends-data-to-chunkservers-as-usual\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#2-client-sends-data-to-chunkservers-as-usual\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"2. \",[\"$\",\"strong\",null,{\"children\":\"Client Sends Data to Chunkservers as Usual:\"}]]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The client will proceed with \",[\"$\",\"strong\",null,{\"children\":\"Step 2\"}],\", which involves sending the data to the \",[\"$\",\"strong\",null,{\"children\":\"primary chunkserver\"}],\" and the secondary replicas.\"]}],[\"$\",\"li\",null,{\"children\":[\"The \",[\"$\",\"strong\",null,{\"children\":\"primary chunkserver\"}],\" will still coordinate the write operation and forward it to the secondaries. Once the primary receives acknowledgments from the replicas, it will send a confirmation back to the client.\"]}]]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Effect:\"}]}],[\"$\",\"p\",null,{\"children\":\"The write operation can still proceed normally without the master being online, provided that the lease is still valid and the chunkservers involved in the write are functional.\"}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"3-lease-expiration-and-the-role-of-the-master\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#3-lease-expiration-and-the-role-of-the-master\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"3. \",[\"$\",\"strong\",null,{\"children\":\"Lease Expiration and the Role of the Master:\"}]]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The lease granted by the master to the \",[\"$\",\"strong\",null,{\"children\":\"primary chunkserver\"}],\" has a \",[\"$\",\"strong\",null,{\"children\":\"limited duration\"}],\" (typically 60 seconds). During this period, the primary chunkserver is authorized to handle writes for that chunk.\"]}],[\"$\",\"li\",null,{\"children\":[\"Since the master node is down, the lease cannot be \",[\"$\",\"strong\",null,{\"children\":\"renewed\"}],\" if it expires, and the master won't be able to \",[\"$\",\"strong\",null,{\"children\":\"grant new leases\"}],\" for subsequent writes to that chunk until it recovers.\"]}]]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Effect:\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"The current write can proceed as long as the lease is valid and hasn't expired.\"}],[\"$\",\"li\",null,{\"children\":\"If the lease expires during or after the write, any subsequent write requests to the same chunk will fail until the master node recovers and can issue a new lease.\"}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"4-client-side-impact-if-the-write-completes-successfully\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#4-client-side-impact-if-the-write-completes-successfully\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"4. \",[\"$\",\"strong\",null,{\"children\":\"Client-Side Impact If the Write Completes Successfully:\"}]]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"If the write completes successfully (i.e., the primary chunkserver receives acknowledgments from all secondary replicas), the \",[\"$\",\"strong\",null,{\"children\":\"client receives a confirmation\"}],\" directly from the primary.\"]}],[\"$\",\"li\",null,{\"children\":\"The master is not needed to confirm that the write was successful, so the client will not experience an issue unless there is a further problem (e.g., a failure of the primary chunkserver).\"}]]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Effect:\"}]}],[\"$\",\"p\",null,{\"children\":\"The client will receive a confirmation of success even though the master is down, assuming the write completes before the lease expires.\"}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"5-what-if-the-write-fails-chunkserver-failure-or-lease-expiry\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#5-what-if-the-write-fails-chunkserver-failure-or-lease-expiry\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"5. \",[\"$\",\"strong\",null,{\"children\":\"What If the Write Fails (Chunkserver Failure or Lease Expiry)?\"}]]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"If, during the process, the \",[\"$\",\"strong\",null,{\"children\":\"primary chunkserver\"}],\" or one of the \",[\"$\",\"strong\",null,{\"children\":\"secondary replicas\"}],\" fails, the client will not receive a confirmation that the write succeeded.\"]}],[\"$\",\"li\",null,{\"children\":[\"If the \",[\"$\",\"strong\",null,{\"children\":\"lease expires\"}],\" while the master is down, the write will not be retried by the client automatically, as the lease would need to be renewed by the master.\"]}],[\"$\",\"li\",null,{\"children\":\"In these cases, the client may retry the write after a timeout, but the write will not succeed until the master node is back online to handle lease management.\"}]]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Effect:\"}]}],[\"$\",\"p\",null,{\"children\":\"If any failures occur in the chunkservers or the lease expires, the client’s write operation will fail. The client will have to retry after the master recovers and issues a new lease.\"}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"conclusion\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#conclusion\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Conclusion\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"The write operation can proceed\"}],\" even if the master node fails, as the client already has the necessary lease and chunkserver information to complete the write.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"The master is not involved in the actual write operation\"}],\", so its failure does not immediately affect the success of the write, as long as the lease is still valid.\"]}],[\"$\",\"li\",null,{\"children\":[\"If the \",[\"$\",\"strong\",null,{\"children\":\"lease expires\"}],\" or a \",[\"$\",\"strong\",null,{\"children\":\"chunkserver failure\"}],\" occurs before the write completes, the client will need to retry the operation after the master recovers.\"]}],[\"$\",\"li\",null,{\"children\":\"Once the master recovers, it will reestablish leases, check for stale replicas, and allow any failed operations to be retried.\"}]]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"question-does-masternode-track-content-changes-in-chunkservers\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#question-does-masternode-track-content-changes-in-chunkservers\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Question: Does masternode track content changes in chunkservers?\"]}],[\"$\",\"p\",null,{\"children\":[\"No, the \",[\"$\",\"strong\",null,{\"children\":\"master node\"}],\" in \",[\"$\",\"strong\",null,{\"children\":\"Google File System (GFS)\"}],\" does \",[\"$\",\"strong\",null,{\"children\":\"not track the actual content changes\"}],\" to a file or directly log every modification made by clients. Instead, the master’s role is primarily focused on \",[\"$\",\"strong\",null,{\"children\":\"metadata management\"}],\", which includes tasks such as maintaining the file-to-chunk mappings, granting leases for write operations, and managing chunk replication.\"]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"question-but-the-masternode-has-append-data-logs-are-they-write-operations-that-masternode-stored\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#question-but-the-masternode-has-append-data-logs-are-they-write-operations-that-masternode-stored\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Question: But the masternode has \",[\"$\",\"code\",null,{\"children\":\"Append Data\"}],\" logs, are they write operations that masternode stored?\"]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Append Data\"}],\" is indeed a \",[\"$\",\"strong\",null,{\"children\":\"write operation\"}],\", but there's a key distinction in how \",[\"$\",\"strong\",null,{\"children\":\"append\"}],\" operations are handled by the \",[\"$\",\"strong\",null,{\"children\":\"master node\"}],\" in GFS compared to regular writes.\"]}],[\"$\",\"p\",null,{\"children\":[\"The append process involves several key steps that include the master node, but the role of the master is limited to \",[\"$\",\"strong\",null,{\"children\":\"metadata management\"}],\", not tracking the exact data being written.\"]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"step-1-client-requests-the-chunk-locations\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#step-1-client-requests-the-chunk-locations\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"Step 1: Client Requests the Chunk Locations\"}]]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"When a client initiates an append operation, it sends a request to the \",[\"$\",\"strong\",null,{\"children\":\"master node\"}],\" for the location of the \",[\"$\",\"strong\",null,{\"children\":\"last chunk\"}],\" in the file.\"]}],[\"$\",\"li\",null,{\"children\":\"The master responds with the list of chunkservers that hold replicas of the last chunk.\"}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"step-2-check-for-chunk-space\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#step-2-check-for-chunk-space\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"Step 2: Check for Chunk Space\"}]]}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":[\"The \",[\"$\",\"strong\",null,{\"children\":\"primary chunkserver\"}],\" (for the last chunk) checks if there is enough space in the chunk to accommodate the append operation.\",[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"If there \",[\"$\",\"strong\",null,{\"children\":\"is space\"}],\", the primary handles the append, and the data is written.\"]}],[\"$\",\"li\",null,{\"children\":[\"If there is \",[\"$\",\"strong\",null,{\"children\":\"no space\"}],\" (because GFS chunks are fixed-size, typically 64MB), the client will need to request a new chunk from the master.\"]}]]}]]}]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"step-3-new-chunk-allocation-if-necessary\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#step-3-new-chunk-allocation-if-necessary\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"Step 3: New Chunk Allocation (If Necessary)\"}]]}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":[\"If a new chunk is required, the client asks the \",[\"$\",\"strong\",null,{\"children\":\"master\"}],\" to allocate a new chunk.\",[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":\"The master logs the creation of the new chunk and updates the file's chunk list in its metadata.\"}]}]]}]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"step-4-append-to-the-chunk\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#step-4-append-to-the-chunk\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"Step 4: Append to the Chunk\"}]]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The client sends the data to the chunkservers, and the \",[\"$\",\"strong\",null,{\"children\":\"primary chunkserver\"}],\" assigns a serial order to the write and forwards the data to the \",[\"$\",\"strong\",null,{\"children\":\"secondary replicas\"}],\".\"]}],[\"$\",\"li\",null,{\"children\":\"Once all replicas have acknowledged the append, the primary confirms the success of the operation to the client.\"}]]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"question-what-happens-if-the-master-node-is-down-when-the-client-needs-a-new-chunk\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#question-what-happens-if-the-master-node-is-down-when-the-client-needs-a-new-chunk\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Question: What Happens If the Master Node Is Down When the Client Needs a New Chunk?\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"The client cannot create a new chunk without the master node\"}],\" because the master is responsible for allocating chunks and assigning chunkservers to store replicas.\"]}],[\"$\",\"li\",null,{\"children\":[\"If the master node is down, the client’s request to create a new chunk will fail, and the client will \",[\"$\",\"strong\",null,{\"children\":\"retry\"}],\" the operation until the master node recovers.\"]}],[\"$\",\"li\",null,{\"children\":[\"The system will be in a \",[\"$\",\"strong\",null,{\"children\":\"blocked state\"}],\" for any new chunk creation or append operations that require additional space until the master node is back online and able to process chunk allocation requests.\"]}]]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"question-what-happens-if-the-primary-chunkserver-fails-after-step-1\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#question-what-happens-if-the-primary-chunkserver-fails-after-step-1\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Question: What Happens If the Primary Chunkserver Fails after Step 1\"]}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Client Tries to Write to the Primary\"}],\":\",[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The client attempts to send the write or append operation to the \",[\"$\",\"strong\",null,{\"children\":\"primary chunkserver\"}],\", but since the primary is down, the client will not receive an acknowledgment from the primary or the secondary replicas.\"]}],[\"$\",\"li\",null,{\"children\":[\"After a \",[\"$\",\"strong\",null,{\"children\":\"timeout period\"}],\", the client will retry the write operation.\"]}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Client Recognizes the Primary Is Unresponsive\"}],\":\",[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":[\"The client will attempt to communicate with the primary chunkserver multiple times, but if it detects that the \",[\"$\",\"strong\",null,{\"children\":\"primary is unresponsive\"}],\" (e.g., after retrying a few times or after the network connection fails), it recognizes that the write cannot proceed.\"]}]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Client Recontacts the Master\"}],\":\",[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"Once the client detects that the \",[\"$\",\"strong\",null,{\"children\":\"primary chunkserver is down\"}],\", it contacts the \",[\"$\",\"strong\",null,{\"children\":\"master node\"}],\" to report the failure.\"]}],[\"$\",\"li\",null,{\"children\":\"The client essentially asks the master to check the lease and potentially designate a new primary chunkserver.\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Master Node Detects Primary Failure\"}],\":\",[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The \",[\"$\",\"strong\",null,{\"children\":\"master node\"}],\", through its regular \",[\"$\",\"strong\",null,{\"children\":\"heartbeat messages\"}],\" with the chunkservers, will likely have already detected that the \",[\"$\",\"strong\",null,{\"children\":\"primary chunkserver has failed\"}],\".\"]}],[\"$\",\"li\",null,{\"children\":[\"Once the failure is confirmed, the master \",[\"$\",\"strong\",null,{\"children\":\"revokes the lease\"}],\" from the failed primary.\"]}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Master Reassigns a New Primary\"}],\":\",[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The master node selects one of the \",[\"$\",\"strong\",null,{\"children\":\"secondary replicas\"}],\" and assigns it as the new \",[\"$\",\"strong\",null,{\"children\":\"primary chunkserver\"}],\".\"]}],[\"$\",\"li\",null,{\"children\":\"The master then notifies the client of the new primary chunkserver and updates the lease information.\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Client Retries the Write with the New Primary\"}],\":\",[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"After receiving the information about the \",[\"$\",\"strong\",null,{\"children\":\"new primary chunkserver\"}],\", the client \",[\"$\",\"strong\",null,{\"children\":\"retries the write operation\"}],\".\"]}],[\"$\",\"li\",null,{\"children\":\"The new primary chunkserver takes over the responsibility of ordering the writes and coordinating with the other replicas to ensure consistency.\"}]]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"question-what-happens-if-the-primary-chunkserver-fails-between-step-3-and-step-4\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#question-what-happens-if-the-primary-chunkserver-fails-between-step-3-and-step-4\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"Question: What Happens If the Primary Chunkserver Fails Between Step 3 and Step 4?\"}]]}],[\"$\",\"p\",null,{\"children\":[\"If the \",[\"$\",\"strong\",null,{\"children\":\"primary chunkserver\"}],\" fails after it has ordered the write and forwarded it to the secondaries (Step 3) but \",[\"$\",\"strong\",null,{\"children\":\"before receiving acknowledgments\"}],\" from all secondary chunkservers (Step 4), the system will follow a well-defined failure recovery process.\"]}],[\"$\",\"p\",null,{\"children\":\"Here’s what happens in detail:\"}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"1-secondary-chunkservers-are-waiting-for-confirmation\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#1-secondary-chunkservers-are-waiting-for-confirmation\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"1. Secondary Chunkservers Are Waiting for Confirmation\"}]]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"After the \",[\"$\",\"strong\",null,{\"children\":\"primary chunkserver\"}],\" forwards the write to the secondary chunkservers, the secondaries apply the write and send back an acknowledgment to the primary.\"]}],[\"$\",\"li\",null,{\"children\":[\"However, in this scenario, the \",[\"$\",\"strong\",null,{\"children\":\"primary chunkserver fails\"}],\" before receiving acknowledgments from the secondaries.\"]}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"2-secondary-chunkservers-cannot-confirm-write-completion\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#2-secondary-chunkservers-cannot-confirm-write-completion\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"2. Secondary Chunkservers Cannot Confirm Write Completion\"}]]}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":[\"Since the primary chunkserver has failed, the \",[\"$\",\"strong\",null,{\"children\":\"secondary chunkservers\"}],\" are unable to confirm the successful completion of the write. They can apply the write to their local data, but the final confirmation to the client cannot be sent, as this requires coordination from the primary.\"]}]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"3-client-does-not-receive-write-confirmation\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#3-client-does-not-receive-write-confirmation\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"3. Client Does Not Receive Write Confirmation\"}]]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The \",[\"$\",\"strong\",null,{\"children\":\"client\"}],\" is waiting for a confirmation from the primary chunkserver that the write was successful. Since the primary chunkserver has failed and cannot send this confirmation, the client will \",[\"$\",\"strong\",null,{\"children\":\"timeout\"}],\" after waiting for a response.\"]}],[\"$\",\"li\",null,{\"children\":[\"Once the client \",[\"$\",\"strong\",null,{\"children\":\"times out\"}],\", it will retry the write operation, but before retrying, it will need to verify the state of the primary chunkserver and ensure that it is communicating with the correct chunkserver.\"]}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"4-master-node-detects-primary-failure\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#4-master-node-detects-primary-failure\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"4. Master Node Detects Primary Failure\"}]]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The \",[\"$\",\"strong\",null,{\"children\":\"master node\"}],\" detects the failure of the primary chunkserver through its \",[\"$\",\"strong\",null,{\"children\":\"heartbeat mechanism\"}],\". The master sends periodic heartbeats to all chunkservers to ensure they are alive.\"]}],[\"$\",\"li\",null,{\"children\":[\"Upon detecting the failure, the master will \",[\"$\",\"strong\",null,{\"children\":\"revoke the lease\"}],\" from the failed primary chunkserver and \",[\"$\",\"strong\",null,{\"children\":\"assign a new primary\"}],\" from the remaining secondary replicas.\"]}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"5-master-assigns-a-new-primary-chunkserver\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#5-master-assigns-a-new-primary-chunkserver\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"5. Master Assigns a New Primary Chunkserver\"}]]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The master promotes one of the \",[\"$\",\"strong\",null,{\"children\":\"secondary chunkservers\"}],\" (which already has the data) to the role of the \",[\"$\",\"strong\",null,{\"children\":\"new primary\"}],\" chunkserver.\"]}],[\"$\",\"li\",null,{\"children\":[\"The master also updates the \",[\"$\",\"strong\",null,{\"children\":\"lease information\"}],\" to reflect the new primary and informs the client about the new primary chunkserver.\"]}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"6-client-retries-the-write-operation-with-the-new-primary\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#6-client-retries-the-write-operation-with-the-new-primary\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"6. Client Retries the Write Operation with the New Primary\"}]]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"Once the client is aware that the \",[\"$\",\"strong\",null,{\"children\":\"primary has changed\"}],\", it will \",[\"$\",\"strong\",null,{\"children\":\"retry the write operation\"}],\" with the new primary chunkserver.\"]}],[\"$\",\"li\",null,{\"children\":\"Since the secondaries already have the data (from Step 3), the new primary will ensure that any partially applied write data is completed and that all replicas remain consistent.\"}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"7-consistency-and-data-recovery\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#7-consistency-and-data-recovery\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"7. Consistency and Data Recovery\"}]]}],[\"$\",\"h5\",null,{\"className\":\"content-header\",\"id\":\"handling-incomplete-writes\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#handling-incomplete-writes\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"Handling Incomplete Writes\"}],\":\"]}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Version Numbers\"}],\": GFS uses \",[\"$\",\"strong\",null,{\"children\":\"version numbers\"}],\" for each chunk to track consistency between replicas. When a write operation is initiated, the primary increments the chunk’s version number. If the new primary chunkserver detects that one of the replicas has an older version of the chunk (because it didn’t complete the write), the system will flag that replica as \",[\"$\",\"strong\",null,{\"children\":\"stale\"}],\" and initiate re-replication.\"]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Example:\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"The failed primary sent the write to all secondaries, but one of the secondaries failed to fully apply the write.\"}],[\"$\",\"li\",null,{\"children\":[\"The new primary will check the version numbers of the replicas and detect if any of the replicas have a \",[\"$\",\"strong\",null,{\"children\":\"stale version\"}],\" of the chunk.\"]}],[\"$\",\"li\",null,{\"children\":[\"The master initiates \",[\"$\",\"strong\",null,{\"children\":\"re-replication\"}],\" to bring all replicas up to the current version of the chunk.\"]}]]}]]}]}],[\"$\",\"h5\",null,{\"className\":\"content-header\",\"id\":\"atomicity-of-writes\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#atomicity-of-writes\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"Atomicity of Writes\"}],\":\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"If the write operation was not fully completed by the time the primary failed, the system ensures \",[\"$\",\"strong\",null,{\"children\":\"atomicity\"}],\". That is, the write is either fully completed across all replicas or it is discarded, and the client retries the operation.\"]}],[\"$\",\"li\",null,{\"children\":\"The new primary ensures that the operation is applied correctly and that no incomplete or inconsistent data remains.\"}]]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"primary-election-procedure-during-write-request\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#primary-election-procedure-during-write-request\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Primary Election procedure during write request\"]}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"No primary\"}],[\"$\",\"li\",null,{\"children\":\"Find the most up-to-date replicas → Compare the version number in the chunk handler(on master) with the version number of each chunk server → Wait until find a up-to-date replica\"}],[\"$\",\"li\",null,{\"children\":\"Pick new replicas as primary, secondary chunk servers\"}],[\"$\",\"li\",null,{\"children\":\"Master Increment Version Number → Chunk servers store new Version Number\"}],[\"$\",\"li\",null,{\"children\":\"Master gives the lease to the primary\"}],[\"$\",\"li\",null,{\"children\":\"Master write the Version Number to the disk\"}]]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"question-how-to-ensure-that-the-system-time-on-all-the-chunk-server-are-the-same-if-not-how-can-we-make-sure-there-is-no-two-primary-which-both-hold-the-lease-and-think-that-they-are-both-the-primary-servers\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#question-how-to-ensure-that-the-system-time-on-all-the-chunk-server-are-the-same-if-not-how-can-we-make-sure-there-is-no-two-primary-which-both-hold-the-lease-and-think-that-they-are-both-the-primary-servers\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Question: How to ensure that the system time on all the chunk server are the same? If not, how can we make sure there is no two primary which both hold the lease and think that they are both the primary servers?\"]}],[\"$\",\"p\",null,{\"children\":[\"That's the key safeguard in \",[\"$\",\"strong\",null,{\"children\":\"Google File System (GFS)\"}],\"—the \",[\"$\",\"strong\",null,{\"children\":\"primary chunkserver\"}],\" (A in this case) doesn’t act alone. Whenever a client sends a write request to the primary, the primary chunkserver (A) must replicate that write to the \",[\"$\",\"strong\",null,{\"children\":\"secondary chunkservers\"}],\". This replication process plays a crucial role in preventing conflicting primary chunkservers, especially in scenarios like \",[\"$\",\"strong\",null,{\"children\":\"time skew\"}],\".\"]}],[\"$\",\"p\",null,{\"children\":\"So even though, there might be a time period that both chunk server A and B are thinking that they are all the primary chunk servers, however, when the old primary A sends write requests to the secondary servers, A will realize the lease has already expired.\"}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"question-will-the-new-primary-chunk-server-b-latest-data-at-offset-100-ask-other-secondary-chunk-servers-latest-data-at-offset-200-to-overwrite-inconsistent-data-at-offset-100\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#question-will-the-new-primary-chunk-server-b-latest-data-at-offset-100-ask-other-secondary-chunk-servers-latest-data-at-offset-200-to-overwrite-inconsistent-data-at-offset-100\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Question: Will the new primary chunk server B (latest data at offset 100) ask other secondary chunk servers (latest data at offset 200) to overwrite inconsistent data at offset 100?\"]}],[\"$\",\"p\",null,{\"children\":\"I think Yes. (Not sure, it is not explained in the paper)\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"Before \",[\"$\",\"strong\",null,{\"children\":\"chunkserver B\"}],\" (the new primary) starts writing data, it communicates with all the \",[\"$\",\"strong\",null,{\"children\":\"secondary replicas\"}],\" (including chunkserver A) to ensure the system is in a \",[\"$\",\"strong\",null,{\"children\":\"consistent state\"}],\".\"]}],[\"$\",\"li\",null,{\"children\":[\"This process involves verifying the current \",[\"$\",\"strong\",null,{\"children\":\"chunk version number\"}],\" and the \",[\"$\",\"strong\",null,{\"children\":\"offset\"}],\" at which the most recent successful write occurred.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Chunkserver A\"}],\", as a secondary now, would report the state of the data it holds. If A had previously written data at offset 100, this information would be part of the state verification.\"]}],[\"$\",\"li\",null,{\"children\":[\"If chunkserver A had written data at offset 100 but it wasn’t fully replicated and acknowledged before its lease expired, that data is considered \",[\"$\",\"strong\",null,{\"children\":\"uncommitted\"}],\" and effectively invalid.\"]}],[\"$\",\"li\",null,{\"children\":[\"When \",[\"$\",\"strong\",null,{\"children\":\"chunkserver B\"}],\" takes over and starts writing from offset 50, the data at offset 100 on chunkserver A is \",[\"$\",\"strong\",null,{\"children\":\"ignored\"}],\" and treated as \",[\"$\",\"strong\",null,{\"children\":\"stale\"}],\".\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Chunkserver A\"}],\" will overwrite its stale data at offset 100 with new data as soon as chunkserver B reaches and writes to that offset.\"]}]]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"question-how-does-gfs-chunk-server-handle-write-failure\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#question-how-does-gfs-chunk-server-handle-write-failure\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Question: How does GFS chunk server handle write failure?\"]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"duplicated-data-in-gfs\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#duplicated-data-in-gfs\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Duplicated Data in GFS:\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"In \",[\"$\",\"strong\",null,{\"children\":\"GFS\"}],\", the system is designed to handle potential \",[\"$\",\"strong\",null,{\"children\":\"partial writes\"}],\" or \",[\"$\",\"strong\",null,{\"children\":\"write failures\"}],\". If a write request is interrupted (e.g., due to a network issue or client failure) after some data has already been written to the chunk, but before the client receives confirmation, the client may retry the write.\"]}],[\"$\",\"li\",null,{\"children\":[\"This retry could result in \",[\"$\",\"strong\",null,{\"children\":\"duplicate data\"}],\" being written to the chunk, but GFS is designed to \",[\"$\",\"strong\",null,{\"children\":\"append\"}],\" data rather than overwrite it. So even if the same data is written again, it will be added to the end of the chunk, leading to \",[\"$\",\"strong\",null,{\"children\":\"duplicated writes\"}],\" at different positions.\"]}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"handling-duplicate-writes\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#handling-duplicate-writes\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Handling Duplicate Writes:\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"GFS doesn't automatically remove duplicate data because the file system is optimized for \",[\"$\",\"strong\",null,{\"children\":\"sequential appends\"}],\" rather than overwrites.\"]}],[\"$\",\"li\",null,{\"children\":\"If duplication occurs, the client application or higher-level systems typically need to handle detecting and eliminating duplicates during data processing or reading.\"}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"frequency-of-duplicated-writes\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#frequency-of-duplicated-writes\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Frequency of Duplicated Writes:\"]}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":[\"This situation is relatively uncommon in normal operation but can occur when there are \",[\"$\",\"strong\",null,{\"children\":\"network failures\"}],\" or \",[\"$\",\"strong\",null,{\"children\":\"timeouts\"}],\" during the writing process, causing the client to resend the write request. GFS ensures that, in case of failure, the system remains consistent, but the possibility of redundant data still exists due to retries.\"]}]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"question-how-does-gfs-handle-duplicated-data-or-padding\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#question-how-does-gfs-handle-duplicated-data-or-padding\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Question: How does GFS handle duplicated data or padding?\"]}],[\"$\",\"p\",null,{\"children\":[\"In \",[\"$\",\"strong\",null,{\"children\":\"Google File System (GFS)\"}],\", the handling of \",[\"$\",\"strong\",null,{\"children\":\"duplicated data\"}],\" generated by failed write requests involves several key behaviors, but \",[\"$\",\"strong\",null,{\"children\":\"GFS itself does not automatically detect or mark duplicated data\"}],\" at the chunk server level. Here's how the process generally works:\"]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"1-client-or-library-awareness-of-duplicates\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#1-client-or-library-awareness-of-duplicates\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"1. Client or Library Awareness of Duplicates:\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"GFS clients or libraries are responsible\"}],\" for tracking the success of write requests.\"]}],[\"$\",\"li\",null,{\"children\":[\"If a write fails and the client retries, the \",[\"$\",\"strong\",null,{\"children\":\"client does not automatically know\"}],\" if the previous data was already successfully written to the chunk server. The client typically resends the write request, potentially causing duplicated data.\"]}],[\"$\",\"li\",null,{\"children\":[\"The GFS system is optimized for append operations, meaning that even if the same data is written twice, it will be appended rather than overwritten. Therefore, GFS itself \",[\"$\",\"strong\",null,{\"children\":\"does not recognize or remove\"}],\" duplicates within the chunk.\"]}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"2-marking-duplicated-or-invalid-data\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#2-marking-duplicated-or-invalid-data\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"2. Marking Duplicated or Invalid Data:\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The \",[\"$\",\"strong\",null,{\"children\":\"chunk server does not explicitly mark duplicated or invalid data\"}],\" resulting from failed write requests.\"]}],[\"$\",\"li\",null,{\"children\":[\"GFS stores data in a \",[\"$\",\"strong\",null,{\"children\":\"sequential, append-only manner\"}],\", meaning that even if a failed write results in duplicated data, it’s just written again without any indication in the chunk metadata that it is a duplicate.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Duplicate data will exist as valid entries\"}],\" in the chunk unless explicitly removed or filtered by higher-level systems.\"]}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"3-reading-data-from-the-chunk-server\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#3-reading-data-from-the-chunk-server\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"3. Reading Data from the Chunk Server:\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"When the client reads data from a chunk, \",[\"$\",\"strong\",null,{\"children\":\"the chunk server sends back all the data\"}],\" in that chunk, including any duplicates caused by failed writes.\"]}],[\"$\",\"li\",null,{\"children\":[\"It is up to the \",[\"$\",\"strong\",null,{\"children\":\"client or application\"}],\" to manage and filter out duplicate data, if necessary, after retrieving it.\"]}],[\"$\",\"li\",null,{\"children\":[\"GFS itself \",[\"$\",\"strong\",null,{\"children\":\"does not differentiate\"}],\" between valid and duplicated data during the reading process. The chunk server treats all written data as valid unless explicitly deleted.\"]}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"handling-duplicates-in-applications\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#handling-duplicates-in-applications\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Handling Duplicates in Applications:\"]}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":[\"Many applications built on top of GFS are designed to work with \",[\"$\",\"strong\",null,{\"children\":\"append-only logs\"}],\", where duplicates might not cause major issues. For applications where duplicated data could be problematic, the application layer must implement logic to:\",[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Detect and filter duplicates\"}],\".\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Validate data integrity\"}],\" using mechanisms like checksums, timestamps, or version numbers.\"]}]]}]]}]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"question-how-does-the-gfs-handle-outdated-chunks\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#question-how-does-the-gfs-handle-outdated-chunks\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Question: How does the GFS handle outdated chunks?\"]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"1-handling-stale-chunks\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#1-handling-stale-chunks\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"1. \",[\"$\",\"strong\",null,{\"children\":\"Handling Stale Chunks\"}],\":\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Stale chunks are not directly updated\"}],\". Instead, the master treats stale replicas as \",[\"$\",\"strong\",null,{\"children\":\"invalid\"}],\" and \",[\"$\",\"strong\",null,{\"children\":\"ignores them\"}],\". The master does not attempt to synchronize them with the latest version.\"]}],[\"$\",\"li\",null,{\"children\":\"The master considers the stale replica to be non-existent during normal operations. It will not instruct clients to read from or write to stale replicas.\"}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"2-re-replication\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#2-re-replication\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"2. \",[\"$\",\"strong\",null,{\"children\":\"Re-replication\"}],\":\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"Once a stale replica is detected, the master triggers a \",[\"$\",\"strong\",null,{\"children\":\"re-replication process\"}],\" to ensure that the required number of valid replicas are available.\"]}],[\"$\",\"li\",null,{\"children\":[\"The master instructs a \",[\"$\",\"strong\",null,{\"children\":\"valid chunkserver\"}],\" (i.e., one with an up-to-date replica) to \",[\"$\",\"strong\",null,{\"children\":\"clone\"}],\" its chunk to another chunkserver.\"]}],[\"$\",\"li\",null,{\"children\":[\"This cloning creates a \",[\"$\",\"strong\",null,{\"children\":\"new, valid replica\"}],\" on a different chunkserver, bringing the number of replicas back to the desired replication level.\"]}]]}],[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"3-garbage-collection-of-stale-replicas\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#3-garbage-collection-of-stale-replicas\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"3. \",[\"$\",\"strong\",null,{\"children\":\"Garbage Collection of Stale Replicas\"}],\":\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"The master \",[\"$\",\"strong\",null,{\"children\":\"periodically removes stale replicas\"}],\" during \",[\"$\",\"strong\",null,{\"children\":\"garbage collection\"}],\". These stale replicas are eventually deleted from the chunkservers to free up space.\"]}],[\"$\",\"li\",null,{\"children\":\"Before garbage collection, the master effectively treats stale replicas as if they do not exist, meaning they are not part of the active replication set for any chunk.\"}]]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"question-what-does-incrementally-update-the-checksum-mean-how-does-the-checksum-work\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#question-what-does-incrementally-update-the-checksum-mean-how-does-the-checksum-work\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Question: What Does \\\"Incrementally Update the Checksum\\\" Mean? How does the checksum work?\"]}],[\"$\",\"p\",null,{\"children\":[\"When you \",[\"$\",\"strong\",null,{\"children\":\"append data\"}],\" to a chunk, the existing chunk may have a \",[\"$\",\"strong\",null,{\"children\":\"partial block\"}],\" at the end (a block that hasn't been completely filled). Instead of recalculating the checksum for the entire block from scratch, GFS \",[\"$\",\"strong\",null,{\"children\":\"updates the existing checksum\"}],\" by processing only the \",[\"$\",\"strong\",null,{\"children\":\"newly appended data\"}],\".\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"GFS \",[\"$\",\"strong\",null,{\"children\":\"divides the data\"}],\" in each chunk into \",[\"$\",\"strong\",null,{\"children\":\"checksum blocks\"}],\" (typically 64 KB each).\"]}],[\"$\",\"li\",null,{\"children\":[\"Each checksum block has its own \",[\"$\",\"strong\",null,{\"children\":\"checksum value\"}],\", which is stored separately from the data. When the data in a block changes, GFS updates the checksum for that specific block.\"]}],[\"$\",\"li\",null,{\"children\":[\"If you append data to a chunk, it will only affect the checksum of the \",[\"$\",\"strong\",null,{\"children\":\"last partial checksum block\"}],\" (if there is one) or create new checksum blocks for newly added data.\"]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"new checksum=func(old checksum,new data)\"}]}]]}],[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"paper-reading\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#paper-reading\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Paper reading:\"]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"$Le\",null,{\"className\":\"break-words\",\"href\":\"/assets/gfs.pdf\",\"children\":\"GFS\"}]}]]}]}],[\"$\",\"footer\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y\",\"children\":[[\"$\",\"div\",null,{\"className\":\"py-4 xl:py-8\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400\",\"children\":\"Tags\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap\",\"children\":[[\"$\",\"$Le\",null,{\"href\":\"/tags/distributed-systems\",\"className\":\"mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"children\":\"distributed-systems\"}],[\"$\",\"$Le\",null,{\"href\":\"/tags/systems\",\"className\":\"mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"children\":\"systems\"}]]}]]}],[\"$\",\"div\",null,{\"className\":\"flex justify-between py-4 xl:block xl:space-y-8 xl:py-8\",\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400\",\"children\":\"Previous Article\"}],[\"$\",\"div\",null,{\"className\":\"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"children\":[\"$\",\"$Le\",null,{\"className\":\"break-words\",\"href\":\"/blog/programming-basic/programming-languages/late-static-binding\",\"children\":\"Late Static Binding\"}]}]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400\",\"children\":\"Next Article\"}],[\"$\",\"div\",null,{\"className\":\"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"children\":[\"$\",\"$Le\",null,{\"className\":\"break-words\",\"href\":\"/blog/distributed-systems/algorithms/mapreduce\",\"children\":\"MapReduce\"}]}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"pt-4 xl:pt-8\",\"children\":[\"$\",\"$Le\",null,{\"className\":\"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"href\":\"/blog\",\"aria-label\":\"Back to the projects\",\"children\":\"← Back to the projects\"}]}]]}]]}]]}]}]]}]]\n"])</script><script>self.__next_f.push([1,"12:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"GFS | CodeWisdom\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Explores the GFS.\"}],[\"$\",\"meta\",\"4\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"5\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"6\",{\"rel\":\"canonical\",\"href\":\"https://codewisdom.io/blog/distributed-systems/systems/GFS\"}],[\"$\",\"link\",\"7\",{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"https://codewisdom.io/feed.xml\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:title\",\"content\":\"GFS\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:description\",\"content\":\"Explores the GFS.\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:url\",\"content\":\"https://codewisdom.io/blog/distributed-systems/systems/GFS\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:site_name\",\"content\":\"CodeWisdom\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:image\",\"content\":\"https://codewisdom.io/static/images/logo-round.png\"}],[\"$\",\"meta\",\"14\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"15\",{\"property\":\"article:published_time\",\"content\":\"2024-10-31T00:00:00.000Z\"}],[\"$\",\"meta\",\"16\",{\"property\":\"article:modified_time\",\"content\":\"2024-10-31T00:00:00.000Z\"}],[\"$\",\"meta\",\"17\",{\"property\":\"article:author\",\"content\":\"Bowen Y\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:title\",\"content\":\"GFS\"}],[\"$\",\"meta\",\"20\",{\"name\":\"twitter:description\",\"content\":\"Explores the GFS.\"}],[\"$\",\"meta\",\"21\",{\"name\":\"twitter:image\",\"content\":\"https://codewisdom.io/static/images/logo-round.png\"}],[\"$\",\"meta\",\"22\",{\"name\":\"next-size-adjust\"}]]\n6:null\n"])</script></body></html>